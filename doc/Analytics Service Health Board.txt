Introduction
This page is to document the Analytics Services requirement to push the New Relic Aggregated data into data warehouse. The below document explains the tables that need to be used to fetch the data and the NRQL queries to fetch the aggregated data and push it to the data warehouse
Metrics 
A dimensional table that fetches metrics based on metrics and attributes.
sql
SELECT average(`apm.service.transaction.duration`) FROM Metric FACET appName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60  MINUTES AGO 
SELECT count(`apm.service.transaction.error.count`) FROM Metric FACET appName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60  MINUTES AGO

FROM Metric SELECT uniques(entity.guid) WHERE appName='Azure - Biller Portal'
MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx
MTQ5OTcwNHxCUk9XU0VSfEFQUExJQ0FUSU9OfDExMDMwOTU4MTc
Transaction 
An event table that logs the transaction
SELECT count(*) FROM Transaction FACET request.uri WHERE entityGuid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx' SINCE 60  MINUTES AGO
TransactionError 
An event table that logs transaction errors
SELECT count(*) FROM TransactionError FACET request.uri WHERE entityGuid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx' SINCE 120  MINUTES AGO
General Notes
sql
--Metric 

--Response Time
SELECT average(apm.service.transaction.duration * 1000) AS 'Response time' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') AND (transactionType = 'Web') LIMIT MAX SINCE 1800 seconds AGO 

--Througput
SELECT rate(count(apm.service.transaction.duration), 1 minute) as 'Web throughput' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') AND (transactionType = 'Web') LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 

--Error Rate
SELECT count(apm.service.error.count) / count(apm.service.transaction.duration) AS 'All errors' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') LIMIT MAX SINCE 1800 seconds AGO TIMESERIES

--Logs
SELECT filter(count(apm.service.logging.lines), where severity like 'ERROR') as ERROR , filter(count(apm.service.logging.lines), where severity like 'INFORMATION') as INFORMATION FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 

--Appdex Score
SELECT apdex(apm.service.apdex) as 'App server', apdex(apm.service.apdex.user) as 'End user' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 


------------------------------------------------------------------------------------------------------------------------------------

--Throuput per TransactionName
SELECT rate(count(apm.service.transaction.duration), 1 minute) FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') AND (transactionName = 'WebTransaction/ASP/billercustomerprofile.aspx') FACET `transactionName` LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 

-- Response Time per TransactionName
SELECT average(apm.service.transaction.duration * 1000)  as 'Response time' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') AND (transactionName = 'WebTransaction/ASP/billercustomerprofile.aspx') LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 

--Error rate per TransactionName
SELECT count(apm.service.transaction.error.count) / count(apm.service.transaction.duration) as 'Error rate' FROM Metric WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') AND ((transactionType = 'Web' AND transactionName = 'WebTransaction/ASP/billercustomerprofile.aspx')) LIMIT MAX SINCE 1800 seconds AGO TIMESERIES 



--------------------------------------------------------------------------------------------------------------------------------

-- Good Vs Bad

FROM Transaction SELECT count(*) as 'Valid' WHERE entityGuid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx' TIMESERIES 2 HOUR SINCE 15 DAYS AGO
FROM TransactionError SELECT count(*) as 'Bad' WHERE entityGuid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx' AND error.expected IS FALSE TIMESERIES 2 HOUR SINCE 15 DAYS AGO

----------------------------------------------------------------------------------------

FROM Metric SELECT keyset() WHERE metricName = 'apm.service.transaction.duration'

SELECT average(`apm.service.transaction.duration`) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO 
SELECT count(apm.service.transaction.error.count) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO 

SELECT average(`apm.service.transaction.duration`) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName, metricTimesliceName, metricUnit WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO 
SELECT count(apm.service.transaction.error.count) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName, metricTimesliceName, metricUnit WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO

SELECT average(`apm.service.transaction.duration`) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName, metricTimesliceName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO 

SELECT count(apm.service.transaction.error.count) FROM Metric FACET appName, host,host.displayName ,instanceName, metricName, metricTimesliceName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60 MINUTES AGO 


SELECT average(`apm.service.transaction.duration`) FROM Metric FACET appName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60  MINUTES AGO 
SELECT count(`apm.service.transaction.error.count`) FROM Metric FACET appName, metricUnit, transactionName, transactionType, subtype  WHERE (entity.guid = 'MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx') SINCE 60  MINUTES AGO 



FROM Metric SELECT uniques(entity.guid) WHERE appName='Azure - Biller Portal'
MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MDk5NTUx
MTQ5OTcwNHxCUk9XU0VSfEFQUExJQ0FUSU9OfDExMDMwOTU4MTc
 URL:/spaces/DS/pages/2585231392/Analytics+Service+Health+Board
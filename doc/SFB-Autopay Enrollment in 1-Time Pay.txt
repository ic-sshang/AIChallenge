2
6
true
default
list
true
Problem Description & Background
Southern Farm Bureau (SFB) has several requirements that are causing conflict with our current Autopay design.
CC payments are allowed for non-recurring payments (aka-1 time payment)
Some states they service DO NOT allow a payer to enroll in Autopay with a CC
The payer must Enroll in Autopay during the initial payment of new & renewal policies that received a discount for the policy with Autopay.
SFB plans to use the CloudPay v2 1-time pay flow after a payer has  confirmed their new insurance policy.
However, the current 1-time pay flow will NOT work because we only allow 1 payment method for both the payment and enrollment in Autopay.
This would be very confusing for the payer who may try to enter in a CC first, but then cannot Enroll in Autopay because of the state restriction requirement.
SFB’s requirements imply that TWO must be allowed because:
A payer CAN pay for a deposit with a CC, BUT
A payer CANNOT enroll in Autopay with that same CC
Current Experience (SFB home-grown Payment Center)
Current Experience
SFB Autopay Demo 9/5/24 (start at 6min30s) 
https://invoicecloud.box.com/s/d76o295csgt5egs12989r268ccxeln6t
 
Discovery & Option Exploration
Meeting with SFB 9/5/24 (4:48:00’ish timeframe) 
https://us-21061.app.gong.io/call?id=8882149068682414251
 
Internal Meeting 9/11/24 
https://invoicecloud.zoom.us/rec/share/1IO8KCO7bo2y6GBngj_es3HF7UA7GqKryanHkEvcvZqIPjJzApQwRnRmOiiVdPMx.X37O429SiAenptfV
 
SFB Autopay Demo 9/5/24 
https://invoicecloud.box.com/s/d76o295csgt5egs12989r268ccxeln6t
 
Options
SFB removes requirement #2 (some states do not allow CC to be used for Autopay enrollment)
Benefit: SFB can use the existing 1-time pay flow with no changes for IC
SFB forces Autopay Enrollment first using iFrame CP first
User must enroll in Autopay in iFrame
SFB waits for API response that Autopay enroll is complete
User gets moved forward to 1-Time Pay
Enroll in Autopay FIRST in 1-Time Pay
IF we used Option 2, here are the proposed changes:
EBPP-22326
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System Jira
 
IF we used Option 3, here are the proposed changes:
https://www.figma.com/design/Efa1tU2eNVGgnOI4SYT4Vb/SFB%3A-Block-CC-on-AutoPay-payments?node-id=1-74&t=m09IGbdE5ZWL1CWQ-1
 
Scenarios to Prioritize
Scenario
Must have
Session Type
Authenticated
  - this is primary use case for SFB
Session Type
Non-Authenticated
 
Customers
Single
 
Customers
Multiple
 - deprioritized. not planned for SFB
Invoice Types
Single
 
Invoice Types
Multiple
Blocks
Delivery
Invoicetype Settings
Scenario 1: Different invoicetypes enrolling in Autopay and making the payment (SFB)
Scenario 2: Same invoicetype enrolling in Autopay and making the payment (normal case)
Authenticated Users
Scenario 1: Authenticated (remote auth token) (SFB primary use case)
Scenario 2: Non-Authenticated
Customers
Scenario 1: Single (SFB, most common)
Blocks
Scenario 1: ACH block set on Customer, CC block set on Autopay (SFB Florida example) – this should result in an API response error
Scenario 2: No blocks on Customer, CC block set on Autopay (SFB Florida example)
Scenario 3: CC block set on Customer, no CC block set on Autopay (SFB other state example)
Story Outline
Section
Description
Stories
New CPv2 Parameter
API
New “RequireAutoPayEnroll” parameter within the Customer Object
Data Object (InvoiceTypeIDs as a list)
Optional
Example:
“RequireAutoPayEnroll”: [166, 168]
QUESTIONS: will there be multiple customers that are 
not
 linked? how do you handle assigning the Payment Method to which login? are they passing in a remote auth token?
Questions for Bill to SFB Integration Team:
Single or Multiple Customers expected?
Authenticated?
Payment Blocks on ACH possible?
Multiple Customers: 
Either all the Customers in the request object should be tied to the same owner login, OR they should be all tied to the same login determined by the remote auth token
Validation Requests
Autopay Payment Method will be tied to the owner login or remote auth token
Invoicetypes are eligible for Autopay Enroll
If a customer has a blocked payment method type that conflicts with the Autopay block settings, then send an invalid response (e.g., CC Autopay blocked, but ACH Payment Blocked)
Payment Methods
Page Load
Check CRM Autopay block settings for invoicetypes
Add new CPv2 parameter “RequireAutopayEnroll” 
https://invoicecloud.atlassian.net/browse/EBPP-24045
 
Single customer only
Validation checks:
Invoicetype IDs exist
Invoicetype IDs are eligible for Autopay
Invoicetype IDs are NOT already enrolled in Autopay
Both ACH+CC Blocks are set (Customer + Autopay level)
Single customer only (multiple customers not supported at this time)
End Result: Valid URL response
Skip if Autopay already enrolled
Update ICDocs
Doc
AutoPay base page
Base page display logic
Enroll does not work yet
Assumes no blocks + no saved payment method
Base layout
Include updated progress indicator
Display invoice box
Show each invoicetype as a single line
Note: there is only 1 customer, so there can only be 1 policy total but can be many invoicetypes
Policy header is not custom text, but is driven by the vertical
Insurance = Policy
Government & Utility = Account
Only show invoice types that are: 
Eligible for AutoPay
Not already enrolled
Partial still show the ones not enrolled
Skip if ALL already enrolled
Show 1 line per Customer/Account per InvoiceType
Use custom wording for account label
Note: Account # = Policy #
AutoPay Enroll
Payment Method dropdown with Credit+Bank
Only Bank works
Assumes no blocks + no saved payment method
Show Payment Method dropdown
2 options
Add a new bank account
Add new credit/debit card
Default to TBD (Bank or CC) 
 
When adding a new bank account
Same fields (except Check Number) as the Payment Route
Add ability to copy/paste into the first Bank Account Number field, but still block it for the 2nd Bank Account number field
Use same validation as the payment route (e.g., using Certegy)
Autopopulate the customer billing address if available
Do not update the customer record if the billing address is changed
AutoPay Enroll
Add credit/debit
Assumes no blocks + no saved payment method
Show Payment Method dropdown
Two options
Add a new bank account
Add new credit/debit card
Default to TBD (Bank or CC)
When adding a new credit/debit card
Same fields as Payment Route
Do not autopopulate the Expiration Month and Year
Use same dynamic label logic if there are no ‘debit’ options available (changes from “credit/debit” to “credit”)
Autopopulate the customer billing address if available
Do not update the customer record if the billing address is changed
Keep the same information entered if you flip back and forth between Credit & Bank selection
E.g., if someone enters CC info then flips to Bank, then back to CC, it should keep the original data entered
There is only 1 set of Billing Information
Email Address 
 
Need to discuss with SFB ?
Do we just let it be handled later in the payment route?
AutoPay Enroll
New Bank
No saved payment method
Payment Route UI
Assumes no blocks + no saved payment method
Do not autoselect an option in dropdown
Treat the same as existing ACH forms
Same validators (e.g., Certigy)
Autopopulate Billing Info if available
Don’t duplicate existing payment methods if same info entered
Success message after Enroll
Considerations
BO 154 (Hide Payment Summary)
AutoPay Enroll
New CC
No saved payment method
Payment Route UI
Assumes no blocks + no saved payment method
Do not autoselect an option in the dropdown
Treat the same as existing CC forms
Same validators
Autopopulate Billing Info if available
Don’t duplicate existing payment methods if same info entered
Success message after Enroll
Considerations
BO 154 (Hide Payment Summary)
AutoPay Enroll
Block CC
New Bank
No Saved Payment Method
Payment Route UI
BlockPaymentType=CC is passed
Payer is only presented ability to enter a new bank info
AutoPay CPv2 Page
BlockACH
No Saved Payment Method
Payment Route UI
BlockPaymentType=ACH is passed
Payer is only presented ability to enter new CC info
AutoPay CPv2 Page
Saved Payment Method
Mixed BlockCC / BlockACH
Payment Route UI
Saved payment method is auto selected
New CC or Bank are available depending on whether Blocks are passed
 URL:/spaces/PE/pages/3556212739/SFB-Autopay+Enrollment+in+1-Time+Pay
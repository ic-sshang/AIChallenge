1
7
RTDR Definition
RTDR - Real Time Data Refresh, is a very extensively used functionality to get a real-time data update from the Biller via web service calls. 
To triage we rely on the information in the Biller Portal and some of the common sql’s executed in our DB
Biller Portal
Common SQL's
sql
–- To get the CustomerID from the account number
select* from customers where AccountNumber='A 0613493'
select * from invoices where customerid = 18942 order by autopaycollectiondate
--and invoicenumber='A 0613493-2022-08-15'


-- To get the invoice details
select * from invoices where customerid = 18942 order by autopaycollectiondate
--and invoicenumber='A 0613493-2022-08-15'


-- To get the RTDR request time and logs
select * from RTDRrequestlogs where customerid=18942


–- To get the adjustments and realtimebalance 
select * from adjustments where customerid=82233354 and invoiceid in (383041627)
select * from realtimebalance where invoiceid in (158871,159008,174796)


–- To get the payments details
select * from payments where customerid=18942 and invoicenumber='A 0613493-2022-08-15'


-- To get the table change details to correlate the timing. 
select * from changelogs where tablename = 'invoices' and fkid = 158871


-- To get the change requestor code
select * from tblchangerequestor


## Sql Calls #
--Table will record the method used and the log for the entire run.</u></h3>
SELECT TOP 1 WebProcessLogID,BillerID,ProcessName,MethodName,MachineName,IPAddress,
  ProcessLog,StartDate,CompleteDate,DateRecAdded FROM webprocesslogs WHERE ProcessName ='RTDRTransactions' ORDER BY 1 DESC


--This table holds information about the request made to a software partner 
--and will tie in to the RTDRRequestLog table for Biller and CustomerInfo.
SELECT TOP 1 WebProcessLogAPIDetailID, WebProcessLogID, ServiceURL, MethodName, BillerAPIStartTime, 
BillerAPIEndTime, RTDRRequestLogID FROM WebProcessLogAPIDetails ORDER BY 1 DESC


--Original RTDR Logging table for RefreshCustomerByCustomerID and RefreshCustomerByCustomerIDV2.</u></h3> 
SELECT TOP 1 RTDRRequestLogID, BillerID, CustomerID, ServerName, StartDate, EndDate, DateRecAdded FROM RTDRRequestLogs  ORDER BY 1 DESC


--Check Elapsed Time for web related rtdr processes over 5 seconds example
SELECT wpl.*, DATEDIFF(second, wpl.startdate, wpl.completedate) AS ElapsedTimeInSeconds FROM webprocesslogs AS wpl
WHERE DATEDIFF(second, wpl.startdate, wpl.completedate) > 5 AND ProcessName ='RTDRTransactions' ORDER BY 1 DESC


--Sample Query to diagnose issues</u></h3>
DECLARE @CustomerID INT = (SELECT TOP  1 CustomerID FROM mcl.Customers WHERE AccountNumber = '[Your AccountNumber]')
SELECT   *
FROM WebProcessLogs AS WPL 
INNER JOIN 
    WebProcessLogAPIDetails AS WPLAD ON WPLAD.WebProcessLogID = WPL.WebProcessLogID
INNER JOIN  
    RTDRRequestLogs AS RRL ON RRL.RTDRRequestLogID = WPLAD.RTDRRequestLogID
WHERE CustomerID = @CustomerID
ORDER BY WPL.DateRecAdded Desc

Code Repo’s
Running ICRTDRService
Open [ICRTDRService], verify your on the Main Branch and Pull all for all updates
in the windowsat the top click windows and a side bar will show up with all the test functions
Right click the test you want to run, in this case its Method [GreenTestRefreshCustomerByCustomerIDV2()] and click debug
Ignore the error pop-up
Go to [ICRTDRService] Page [TeamGreenTest.vb] and Method [GreenTestRefreshCustomerByCustomerIDV2()]
Fill in the Values under 
Dim myReq As New RealTimeDataRefresh.RTDRRequest With {.BillerID = XXX, .CustomerID = XXX, .ForceRefresh = True}
Press Run, Ignore the bug popup
Get the software partner ID for the Biller in question 
Get the Billers Integration Partner under CRM under Profile > Integration Partner, 
Integration Partner under their Profile > Integrator ID
In ICRTDRService under RealTimeDataRefresh.vb Line (1059) look for the Partner ID in the Case statment
Notes: Every class will run [PreformDataRefresh.vb] so a break point there is a good idea
Training and Knowledge Materials
2017-09-01 10.04 Real Time Data Refresh Training.mp4
RTDR Debugging Tutorial
 URL:/spaces/DS/pages/2401402886/RTDR
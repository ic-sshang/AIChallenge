Included starting with version 2.7, is a component that allows Stratus to automatically update on client machines. The auto update feature is built into a new windows service Stratus.AutoUpdateService that manages the workflow of checking available and the existing version, downloading the update and installing it. Built into the auto update process is verification to check if tasks are currently running and if they will kick off in the next 3 minutes. If either is true, the update process will be delayed.
Requirements
The assembly versions of the following components should all match.
Stratus.Service
Stratus.Engine
Stratus.UI
Stratus.AutoUpdateService
When running the installer that includes the autoupdate service (2.7 or later), the autoupdate service must be installed as LocalSystem.
When packaging the update.zip archive, the update.bat file must be included.
Update prerequisites
The version presented in the autoupdate.xml must be different than the version of Stratus.AutoUpdateService currently running on the machine.
In the event the mandatory flag in the autoupdate.xml is set to true, the update process will proceed if the local running version is not the same as the one presented by the autoupdate.xml.
If the mandatory flag to false, the update process will only proceed if the server version is newer than the current local version.
2.7.0.1 > 2.7.0.0
2.7.1.0 > 2.7.0.0
2.8.0.0 > 2.7.0.0
Stratus.AutoUpdateService will pull all tasks from Stratus.Service. If any tasks are currently running or any active tasks are scheduled to run with a next run time in the next 3 minutes, the update will be delayed.
Update process
Stratus.AutoUpdateService sets up a timer to run the update check every 32 minutes by default. This is configurable via the app.config and requires a service restart when changed.
The auto update service calls Stratus.Service to verify prerequisites 3 and 4.
The auto update service will download the autoupdate.xml and compare the version specified vs the assembly version of itself and satisfy prerequisites 1 and 2.
The update service will download the update.zip file specified in the autoupdate.xml to the %TEMP%\InvoiceCloud directory on the local machine. C:\Windows\Temp\InvoiceCloud
The update service will extract the contents of the zip file.
The update service invokes the update.bat file.
The batch file goes through the following steps.
Closes any instances of the Stratus.UI
Stops the Stratus.AutoUpdateService and Stratus.Service.
Copies the existing files in C:\Program Files (x86)\InvoiceCloud\Stratus and C:\ProgramData\InvoiceCloud\Stratus to C:\Windows\Temp\InvoiceCloud_Temp as a back up of the current installation.
Deletes the files in C:\Program Files (x86)\InvoiceCloud\Stratus and C:\ProgramData\InvoiceCloud\Stratus.
Moves extracted files C:\Windows\Temp\InvoiceCloud\update\stratus to C:\Program Files (x86)\InvoiceCloud\Stratus.
Moves extracted files C:\Windows\Temp\InvoiceCloud\update\Tasks to C:\ProgramData\InvoiceCloud\Stratus.
Starts the Stratus.AutoUpdateService and Stratus.Service.
If the services are unable to start, the new files are deleted, the backup is copied back into the program files directories and the services are restarted. - Rollback
The backup directory C:\Windows\Temp\InvoiceCloud_Temp is deleted.
Package generation
Clone the stratus repo locally.
To build, follow the instructions in 
Readme
. The build should be run in the release configuration. The password for the zip file in the scripts directory is 
crUstie$!1!
Once successfully built, run the generate-package.ps1 script in the \Scripts directory with the optional command line parameter “preview” to target the preview environment.
Publish the artifacts directory into the artifact feed:
az artifacts universal publish --organization https://dev.azure.com/invoicecloud/ --feed test-feed --name stratus-au --version {VERSION} --description "update package-preview" --path {STRATUS_REPO}\artifacts
Once uploaded, the package should be available here: 
https://dev.azure.com/invoicecloud/Src/_artifacts/feed/test-feed/UPack/stratus-au/overview/2.7.0
Environments
https://preview.invoicecloud.com/StratusInstall/auto-update/alpha/autoupdate.xml
QA Web Preview 1 (10.0.1.13)
QA Web Preview 2 (10.0.1.14)
https://stratus.invoicecloud.com/StratusInstall/auto-update/autoupdate.xml
IC Web 1 (10.0.1.4)
IC Web 2 (10.0.1.5)
IC Web 3 (10.0.1.6) 
IC Web 4 (10.0.1.7)
IC Web 5 (10.0.1.8)
IC Web 6 (10.0.1.9)
IC Web 7 (10.0.1.10)
IC Web 8 (10.0.1.11)
IC Web 9 (10.0.1.12)
IC Web 10 (10.0.1.15)
Environment Artifact Locations
The package will have 3 files in it regardless of whether the preview parameter is used.
autoupdate.xml
setup.exe
update.zip
The files need to be deployed to the following locations based on whether the 
package 
was created for the preview environment:
File name
Environment
Location
autoupdate.xml
Preview
C:\Data\WWW\StratusInstall_Beta\auto-update\alpha
update.zip
Preview
C:\Data\WWW\StratusInstall_Beta\auto-update\alpha
setup.exe
Preview
C:\Data\WWW\StratusInstall\2
autoupdate.xml
Production (Web Servers)
C:\Data\WWW\StratusInstall\auto-update\
update.zip
Production (Web Servers)
C:\Data\WWW\StratusInstall\auto-update\
setup.exe
Production (Web Servers)
C:\Data\WWW\StratusInstall\2
 URL:/spaces/IM/pages/2211610625/Stratus+Auto+Update
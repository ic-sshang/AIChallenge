POSPay is our latest cloud-based EMV point of sale product. It offers billers two new fully wireless and contactless EMV devices to choose from. These devices can be used either with the Biller Portal or integrated with the biller's Customer Information System (CIS).
POSPay also introduces cashiering enhancements such as the ability to pay multiple invoices in a single transaction, integrated voids and refunds, Cloud Store payments and more.
Importantly, POSPay is Point-to-Point Encryption (P2PE) compliant, which significantly reduces the Payment Card Industry (PCI) compliance scope for 'card present' transactions. This is achieved through our partnership with Bluefin Payment Systems, using their proprietary PayConex gateway.
The P2PE process encrypts credit card data at the moment of swipe or key-in, and it remains encrypted until it reaches Bluefin's offsite Hardware Security Module (HSM). The data is then tokenized into a unique code that can be securely stored and used for reissuing or refunding transactions.
By using P2PE and tokenization, credit card data never enters the InvoiceCloud network, effectively outsourcing credit card data security to Bluefin and removing the InvoiceCloud processing environment from PCI compliance scope.
Please note: A biller is never 100% out of scope of PCI compliance for card present transactions.
POSPay terminology
EMV
: Is
 
a secure payment technology used in credit and debit cards with an embedded chip. This technology, developed in 1994 by Europay, Mastercard, and Visa (hence "EMV"), allows cardholders to make transactions more securely. Today, EMV technology is managed by EMVCo, an organization that includes major card networks like Mastercard, Visa, American Express, Discover, JCB, and UnionPay. This makes EMV a global standard for "smart" payment cards with embedded chips.
EMV technology supports two types of payment interfaces: contact and contactless.
The key advantage of an EMV chip is its enhanced security. The chip's unique method of storing, encrypting, and transmitting financial data makes it extremely difficult for identity thieves to create counterfeit cards.
PCI Scope
: Billers don’t want to see 
or touch 
customer cards
Security: 
Billers want to prevent any data breaches as much as possible
The following devices are approved for use in the InvoiceCloud/Bluefin integration
Countertop devices
PAX80 Features:
The PAX A80 is Smart Desktop payment terminal powered by the Android operating system. The A80 is a PCI P2PE device and is integrated with InvoiceCloud, providing clients with a seamless processing option backed by the highest level of security with our PCI-validated Point-to-Point Encryption (P2PE) solution.
PCI PTS 5.x certified•
Credit, EMV, Swipe, NFC (Contactless), ApplePay, GooglePay
Built-in thermal printer
4-inch touchscreen display
Ethernet and Wireless (2.4 GHz) Connectivity
TCP/IP Only, No USB option
Mobile devices
PAX920 Features:
The PAX A920 is an elegantly designed and compact secure electronic payment terminal powered by the Android operating system. The A920 is a PCI P2PE device and is integrated with InvoiceCloud, providing our clients with a seamless processing option backed by the highest level of security with our PCI-validated Point-to-Point Encryption (P2PE) solution.
PCI PTS 5.x certified
Credit, EMV, Swipe, NFC (Contactless), ApplePay, GooglePay
Built-in 2” thermal printer
5-inch touchscreen display
Long Lasting Li-Ion Battery, 5250mAH Mini-USB Rechargeable Battery - Rated to last a full day
Charging & communication dock (optional) Wireless Only (2.4 GHz), Bluetooth, or 4G Cellular Connectivity
InvoiceCloud Technical Documentation
Common Error handling (Customer and Biller Portal)
Error Handling Workflow
Conditions Checked
:
IsEMVCardReaderPayment = True
hdSaasConexErrorCode.Value
 is not null/empty
Process
:
If both conditions are met:
Show the error panel (
pnlErrorMessage.Visible = True
).
Set error text using 
BluefinErrorCodes.BluefinErrorMessage(hdSaasConexErrorCode.Value)
.
Log informational message including:
Session ID
Biller ID
Customer ID
Error Code
Reset error code → 
hdSaasConexErrorCode.Value = String.Empty
.
If a response exists (
hdSaasConexRes.Value
 not null/empty):
Attempt to deserialize into 
List(Of SaasConexAuthResponse)
.
Log start of 
refund process
.
If deserialization succeeds:
Create 
DatabaseInstance
 + 
EMVRepository
.
Attempt refund of previous EMV payments.
Append refund result message to error text.
If exception occurs during refund:
Log informational message: 
"Exception during refund backout"
.
If exception occurs during deserialization or refund:
Log error with event details + exception.
Reset response value → 
hdSaasConexRes.Value = String.Empty
.
Exit subroutine.
Result
:
Errors are surfaced to the user.
Refunds are attempted automatically when applicable.
All key details are logged for 
debugging & auditing
.
Common functionality (Customer and Biller Portal)
IsEMVCardReaderPayment
Type
: Boolean property / variable.
Purpose
: Indicates if the 
current payment method
 uses an EMV card reader.
Client Script Registration
Check
:
Page.ClientScript.IsClientScriptIncludeRegistered("bluefin-saasconex")

Determines if the Bluefin SaasConex script has already been registered on the page.
Process
:
If 
IsEMVCardReaderPayment = True
 
and
 
"bluefin-saasconex"
 is not registered:
Register 
required JS files
:
saasconex-sdk-v1.0.js
ic-bluefinemvmultiterminal.js
Result
:
Ensures required Bluefin SDK scripts are loaded only once.
Enables proper integration with Bluefin EMV card readers.
Javascript file - ic-bluefinemvmultiterminal.js
Bluefin Payment System JavaScript Code Overview
This JavaScript code handles payment transactions using the 
Bluefin payment system
, supporting both 
regular payments
 and 
digital wallet payments
 (e.g., Apple Pay, Google Pay).
1. Initialization
Defines variables and a 
EmvTransactionDetails
 class for storing transaction details.
2. Radio Button Change Event
Listens for changes in payment option selection (full, partial, or minimum payment).
On change, triggers a 
postback
 to refresh the page.
3. Button Click Events
Two event listeners:
Regular payment button
Digital wallet payment button
Actions when clicked:
Prevent default action
Show processing window
Call 
runBluefinEmvTransaction()
 with appropriate parameters
4. 
runBluefinEmvTransaction
Retrieves 
device and payment info
 from hidden input 
#hdSaasConexReq
 (JSON parsed).
Creates an 
EmvTransactionDetails
 instance with:
Payload
Payment counter = 0
Trigger button
Boolean flag (digital wallet or not)
Flow:
Digital wallet:
 calls 
multitransactionprocessing()
Regular payment:
 initializes 
SaaSConex SDK
 with:
Device info
Key
Debug/SSL/TLS flags
Environment
5. 
makePayment
Resets any previous error codes.
Checks if a 
service fee message
 needs to be displayed on the card reader:
Uses 
showMultilineMessage()
 → displays total, subtotal, and fee.
On success: calls 
showAcceptance()
On failure: resets SDK and throws error
6. 
showAcceptance
Displays a 
confirmation dialog
 on the card reader:
Title: "Do you accept?"
Buttons: 
Confirm $...
 / 
Decline
Outcomes:
Confirm:
 calls 
processPayment()
Decline:
 resets SDK, shows decline message
Failure/Timeout:
 resets SDK, shows error
7. 
multitransactionprocessing
Handles 
multiple transaction flows
 for digital wallets.
Checks if all transactions are processed:
If yes → store response data in hidden field and trigger postback.
If no → reinitialize SDK and call 
makePayment()
.
8. 
processPayment
Retrieves merchant 
group tag
 from payload.
Uses SDK 
transaction()
 and 
processTransaction()
 methods.
Flow:
On success:
Store terminal info in response data
Regular payment:
 trigger postback
Digital wallet:
 increment counter and re-call 
multitransactionprocessing()
On failure:
Extract error code
Reset SDK
Call 
throwErrorMessage()
9. 
throwErrorMessage
Handles error codes and triggers postback after 500ms delay.
Steps:
Set hidden field 
#hdSaasConexErrorCode
 with error code
Call 
submit_postback()
 with button reference
10. 
submit_postback
Triggers a postback after 100ms delay.
Steps:
Get button ID, replace 
_
 with 
$
 (
ASP.NET
 formatting)
Call 
__doPostBack()
 with button ID
11. 
isValidContent
Validates strings to prevent injection of HTML/iframes.
Returns 
false
 if:
Value contains 
<
 and 
>
Matches an iframe regex pattern
Returns 
true
 otherwise.
Card Reader Repository – Method Overview
Constructor
CardReaderRepository(IDatabaseWrapper database)
Purpose
: Initializes the repository with a database wrapper.
Parameters
:
IDatabaseWrapper database
 – abstraction for database interactions.
Behavior
: Stores the wrapper in a private, read-only 
_database
 field.
Public Methods
GetCardReaderByBillerEquipmentID(int billerCardReaderID)
Purpose
: Retrieves a single card reader by its biller equipment ID.
Process
:
Calls 
GetCardReaderDetails(billerCardReaderID)
 to fetch database results.
Returns the first matching row as a 
CardReader
 object using 
ReturnEmvCardReaderInformationFromDataRow
.
If no rows found → returns a new default 
CardReader
.
IsCardReaderInProduction(int terminalID)
Purpose
: Determines if a card reader is in production mode.
Process
:
Calls 
GetLiveTerminalSettingParameterByTerminalID(terminalID)
.
Returns a boolean (
true
 if live, otherwise 
false
).
GetEmvPrintingInformation(...)
Purpose
: Builds a Bluefin authorization request for a transaction.
Parameters
:
bool isLive
DataTable paymentDetails
string billerDBA
CardReader cardReader
decimal totalPaymentAmount
decimal totalConvenienceFeeAmount
DataSet payments
Process
:
Creates and returns a 
BluefinAuthorization.AuthorizeRequest
 based on inputs and database data.
GetCardReadersByLocationID(int locationID)
Purpose
: Retrieves all card readers for a given location.
Process
:
Calls 
GetCardReaderDetails(locationID)
.
Converts result set into a list of 
CardReader
 objects.
SetDefaultCardReaderByBillerUserID(int userID, int cardReaderID)
SetDefaultCardReaderTerminalID(int terminalID, int cardReaderID)
Purpose
: Assigns a default card reader to a user or terminal.
Process
: Both call the private method 
SetDefaultCardReader
.
GetCardReaderIDByBillerUserID(int userID)
GetBillerCardReaderIDByBillerUserTerminalID(string terminalID)
Purpose
: Fetches default card reader IDs.
Process
: Both call 
GetUserDefaultCardReaderDetails
.
Private Methods
ReturnEmvCardReaderInformationFromDataRow(DataRow row)
Purpose
: Constructs a 
CardReader
 from a single DataRow.
GetUserDefaultCardReaderDetails(int userID | string apiOption)
Purpose
: Retrieves a default card reader either by biller portal user ID or via CloudPayments API option.
GetLiveTerminalSettingParameterByTerminalID(int terminalID)
Purpose
: Checks if a terminal ID corresponds to a live (production) environment.
SetDefaultCardReader(int userID | int agentID, int cardReaderID)
Purpose
: Persists a default card reader for a specific user or agent.
GetCardReaderDetails(int cardReaderID | int locationID)
Purpose
: Retrieves card reader(s) by either ID or location.
Card Reader Location Repository methods
Constructor
CardReaderLocationRepository(IDatabaseWrapper database)
Purpose
: Initializes the repository with a database wrapper.
Parameters
:
IDatabaseWrapper database
 – abstraction for database interactions.
Behavior
: Stores the wrapper in a private, read-only 
_database
 field.
Public Methods
GetBillerCardReaderLocation(int billerID)
Purpose
: Retrieves all card reader locations for a biller.
Process
:
Executes stored procedure 
selBillerEquipmentLocation
 with 
BillerID
.
Loads results into a 
DataTable
.
Converts rows into a list of 
CardReaderLocation
 objects.
GetBillerCardReaderLocationByStatus(int equipmentStatusID)
Purpose
: Retrieves card reader locations filtered by equipment status.
Process
:
Executes stored procedure 
selBillerEquipmentLocationByStatus
 with 
EquipmentStatusID
.
Loads results into a 
DataTable
.
Converts rows into a list of 
CardReaderLocation
 objects.
GetCardReaderLocationIDByBillerUserID(int userID)
GetCardReaderLocationIDByBillerUserTerminalID(string terminalGuid)
GetCardReaderLocationIDByBillerUserLocationGuid(string locationGuid)
Purpose
: Retrieves the 
default card reader location
 for a user.
Process
:
Depending on the parameter, calls either:
GetEquipmentDefaultLocation(userID)
GetUserEmvLocation(locationGuid)
Private Methods
ReturnEmvCardReaderLocationFromDataRow(DataRow row)
Purpose
: Constructs a 
CardReaderLocation
 object from a single 
DataRow
.
Usage
: Utility method used by public methods to map DB results to domain objects.
GetEquipmentDefaultLocation(int billerID, int? userID = null)
Purpose
: Retrieves the default location for a user.
Process
:
Executes stored procedure 
selBillerEquipmentDefault
 with 
BillerID
 (and optionally 
BillerUserID
).
Loads results into a 
DataTable
.
Returns the 
BillerEquipmentLocationID
 from the first row.
GetUserEmvLocation(int billerID, string locationGuid)
Purpose
: Retrieves the location ID for a specific EMV device.
Process
:
Executes stored procedure 
selBillerEquipmentLocation
 with 
BillerID
 and 
LocationGUID
.
Loads results into a 
DataTable
.
Returns the 
BillerEquipmentLocationID
 from the first row.
Biller Portal Payment Process
Biller Portal - ctrlCreditCardEntry page:
PopulateBluefinEmvCardReaders
Purpose
: Populates the 
card reader dropdown list (
ddlCardReaderList
)
 with Bluefin EMV card readers.
Process
:
Creates a 
CardReaderRepository
 instance with a 
DatabaseInstance
 tied to the 
BillerID
.
Retrieves the 
default card reader ID
 for the current user via 
GetCardReaderIDByBillerUserID
.
Clears existing items in the dropdown and sets visibility.
If multiple card readers exist → adds a default 
"Select Card Reader"
 option.
Iterates over each 
CardReader
:
Creates a 
ListItem
 (
Value
 = 
BillerCardReaderID
, 
Text
 = card reader 
Name
).
Marks as 
selected
 if it matches the default ID.
Adds the item to the dropdown.
Result
: Dropdown displays all available card readers, with the user’s default pre-selected.
PopulateCardReaderLocation
Purpose
: Populates the 
location dropdown list (
ddlCardReaderLocationList
)
 with active card reader locations, sets defaults, and initializes card reader visibility.
Process
:
Clears existing location list items.
Creates a 
CardReaderLocationRepository
 → calls 
GetBillerCardReaderLocationByStatus
 to fetch active locations.
If locations exist:
Retrieves default location via 
GetCardReaderLocationIDByBillerUserID
.
Adds 
"Select a Location"
 option.
Iterates through locations → creates 
ListItem
 for each.
If location matches the default → marks as 
selected
, sets 
hasDefaultLocation = True
, and shows the 
phSetCardReaderDefault
 placeholder.
If default location exists:
Creates a 
CardReaderRepository
 → calls 
GetCardReadersByLocationID
.
Calls 
ShowCardReaderVisibility
 to adjust UI.
If readers exist → sets 
SelectedPaymentInfoTab = EMVCardReader
 and calls 
PopulateBluefinEmvCardReaders
.
Result
: Dropdown lists active locations, selects defaults, and conditionally loads card readers.
ShowCardReaderVisibility
Purpose
: Controls the 
UI visibility
 of card reader elements.
Parameters
:
showCardReaderArea (bool)
 – show/hide card reader section.
showCardReaderList (bool)
 – show/hide available readers.
Behavior
:
phCardReader
 placeholder → visible if 
showCardReaderArea = True
.
If 
showCardReaderList = True
:
Hides 
lblNoCardReaders
 (no-reader message).
Shows 
phSetCardReaderDefault
 (set default section).
Else:
Shows 
lblNoCardReaders
.
Hides 
phSetCardReaderDefault
.
ddlCardReaderLocationList_SelectedIndexChanged
Purpose
: Handles 
dropdown change events
 for selecting a location.
Process
:
Checks if selected index > 0 (ignores 
"Select a Location"
).
If valid location selected:
Creates a 
CardReaderRepository
.
Calls 
GetCardReadersByLocationID
.
Calls 
ShowCardReaderVisibility
 (adjust UI).
If readers exist → calls 
PopulateBluefinEmvCardReaders
.
If none → clears and hides 
ddlCardReaderList
.
If no valid location selected → hides card reader area via 
ShowCardReaderVisibility
.
SelectedPaymentInfoTab (Property)
Purpose
: Controls 
which payment tab is visible
 (EMV Card Reader vs. Enter Card).
Behavior
:
Getter
:
Returns 
EMVCardReader
 if 
phEMVCardReader
 placeholder is visible.
Else returns 
EnterCard
.
Setter
:
If 
EMVCardReader
:
Makes 
phEMVCardReader
 visible.
Calls 
ShowCardReaderVisibility
 to hide unused areas.
If 
EnterCard
:
Makes 
phEnterCardInformation
 visible.
Updates CSS classes of 
lnkEnterCardReader
 / 
lnkEnterCardInformation
 to reflect selection.
Toggles visibility of required field labels (name, address, city, state, zip).
Calls 
ResetControlsToValid
.
Hides 
pnlErrorMessage
.
Biller Portal - BillerManualPaymentSelectPayment page:
Transaction Processing Flow (Authorized / Sale Response)
Purpose
: Handles 
post-authorization
 processing after an EMV device returns a successful 
Authorized
 or 
Sale
 response (including Google Pay / Apple Pay).
Process
:
Validation
:
Ensures 
PaymentEmvObject
 is not 
Nothing
.
Verifies current payment method is EMV (
IsEMVCardReaderPayment
).
Payment Type Setup
:
Sets 
paymentType = PaymentType.CreditCard
.
If sender is 
btnProcessBluefinPaymentDigitalWallet
 → marks as 
digital wallet payment
 (
IsEmvDigitalWalletPayment
).
Request Preparation
:
Creates a new 
EmvSaleRequest
 for the transaction.
Converts 
PaymentEmvObject
 to 
EmvSaleRequest
.
Attempts to deserialize 
hdSaasConexRes.Value
 into 
List(Of SaasConexAuthResponse)
.
On failure → log error, show error panel, display message.
Transaction Request Building
:
If deserialization succeeds → build list of 
EmvSaleRequest
 objects via 
CreateEmvSaleTransactionRequests
.
If fails → log error, show error panel.
Transaction Execution
:
Logs 
start
 of 
EmvSaleTransaction
.
Calls 
EmvSaleTransaction(hardcoded GUID, emvSaleRequestArray)
.
Logs 
end
 of 
EmvSaleTransaction
.
Result Handling
:
Stores response in 
EmvSaleResponse
.
Extracts and assigns 
ReceiptGuids
.
If 
duplicate transaction
 → updates 
PaymentID
, 
PaymentGUID
, and marks 
isDuplicate = True
.
If 
validation error
 → show error message.
Else → redirect to 
confirmation page
 with query parameters.
Error Handling
: If 
PaymentEmvObject
 or 
IsEMVCardReaderPayment
 not valid → throws exception.
CreateEmvSaleTransactionRequests
Purpose
: Builds a list of 
EmvSaleRequest
 objects based on 
auth responses, charge batches, and terminal data
.
Parameters
:
saasconexResponseList
 – List of 
SaasConexAuthResponse
.
chargeBatches
 – Collection of batch charges.
clsBillers
 – Biller information object.
isDigitalWalletPayment (bool)
 – Determines if processing Google/Apple Pay.
emvSaleRequestBase
 – Base request object.
Process
:
Initialize variables (
EmvSaleRequestList
, 
EmvSaleRequestSupplementalDetails
, encryption key from first invoice GUID).
Digital Wallet Path
:
Get terminal ID.
Set 
convenienceFeeTransactionID
 if matching terminal found.
Loop through 
saasconexResponseList
:
Skip fallback or missing EMV data.
Capture 
chipCardAID
 and 
applicationLabel
.
Populate supplemental details.
Loop through matching batches → for each invoice:
Clone 
emvSaleRequestBase
.
Create 
EmvSaleRequest
.
Log info, add to list.
Non-Digital Wallet Path
:
Get EMV terminal list.
For each terminal → loop through matching batches.
For each invoice: clone base, create request, log, add to list.
Return
: List of populated 
EmvSaleRequest
 objects.
CreateEmvSaleRequest
Purpose
: Builds a 
single 
EmvSaleRequest
 object
.
Parameters
:
invoice
 – Target invoice.
emvSaleRequest
 – Existing base request.
saasConexInformation
 – Auth response data.
emvRequestSupplementalDetails
 – Supplemental transaction details.
Behavior
:
Populates request with biller, card, transaction, and invoice data.
Sets 
CloudPortals = True
 and 
RemoteIP
 via 
clsUtilities.GetRemoteIP()
.
If no customer validation required → auto-populates customer fields (name, address, city, state, zip).
Return
: Completed 
EmvSaleRequest
.
InitializeBluefinDevice
Purpose
: Sets up the 
Bluefin payment device
 before transaction execution.
Process
:
Get 
InvoicePaymentAmounts
 control from 
phInvoiceAmounts
.
Validate input: if invalid → disable payment buttons, clear hidden field, exit.
If valid → show 
btnProcessPaymentBluefin
.
Get 
CardReaderRepository
 and retrieve current biller’s card reader + EMV object.
Build invoice type ID list.
Get 
TerminalRepository
, retrieve EMV terminals + submitter terminal.
Validate 
live/UAT terminal consistency
. If mismatch → show error and exit.
Initialize 
BluefinAuthorization
 and 
ICSaasConexPaymentInformation
.
Save payment amounts to session, calculate convenience fee.
Populate 
bluefinPaymentSettings
 (confirmation window flag, totals, service fees, group tag details).
Serialize 
BluefinAuthorizationRequestMulti
 → assign JSON to 
hdSaasConexReq.Value
.
GetTerminalGroupInformation
Purpose
: Prepares 
terminal group data
 for multi-terminal payment scenarios.
Process
:
Initialize 
List(Of TerminalGroupTagDetails)
 and fee variables.
Generate encryption key from first invoice GUID.
If submitter terminal valid → calculate its convenience fee.
If fee > 0 → create 
TerminalGroupTagDetails
 and add to list.
For each terminal in 
emvTerminalList
:
Calculate total payment per invoice in matching charge batches.
Create 
TerminalGroupTagDetails
 and add to list.
If multiple terminals OR one terminal with fees →
Show 
btnProcessBluefinPaymentDigitalWallet
.
Update 
btnProcessPaymentBluefin
 text → 
"Pay with Physical Card"
.
Return
: List of 
TerminalGroupTagDetails
.
Customer (CIS) Payment Process (Work in progress)
Quick Links:
POS Partial Refund - Process
CloudPayments API CIS Partner Process Diagram
Biller Portal Process Diagram
Biller Portal Code Flow
Customer Portal Code Flow
Card Reader Repository Methods
Card Reader Location Repository Methods
Client JS SDK documentation
 URL:/spaces/ED/pages/2693136389/Point+of+Sale+Products
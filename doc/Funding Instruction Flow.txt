none
1. Identify Eligible Billers
Only include 
billers using the 
PayFac system
.
2. Collect Payments for Each Biller
a. ACH Payments - Payer
Gather all ACH payments.
Each payment becomes its own funding instruction.
Flow: Debit payer → Credit IC Chase FBO account.
IC is collecting money first from payer.
b. Other Payment Types
Collect and aggregate:
Captured Credit Card payments
PayPal payments
OBD (Cass) payments
ACH Payments sum of ones into IC Chase FBO Account
Each aggregate becomes a funding instruction.
Flow: Credit biller → Debit IC Chase FBO account.
c. Apply Filters
Exclude payments that are on 
Payment Hold
 (Payment Holds table).
Exclude payments that have not yet been 
exported to the biller’s CIS
 (Payment Exports table).
d. Service Fees
Any 
IC service fees
 are credited back to the IC Chase FBO account (not the biller).
Typically handled by creating a “settled batch” under 
BID 1
, which still closes out in the funding instruction process. (What we will end up doing here is the funding instruction for “fees” should be credited to IC Chase account) 
3. Batch and Settlement Processing
a. 
Batch Assignments
Payments are tagged with a 
SettledBatchId
 and 
expected deposit date
 on the biller shard.
b. Payment Service Sync
Update Payment Service database to mark payments as:
Pending Funding
Funded
Ensure sync between 
Payment Service
 and 
Biller Shard
 so only in-sync payments are funded.
Funding Instruction Diagram
 
Graphviz Code
wide
760
digraph FundingFlowClean {
  rankdir=TB;
  splines=ortho;
  fontname="Inter";
  node [shape=box, style="rounded,filled", fillcolor=white, fontname="Inter"];

  // --- Swimlanes ---
  subgraph cluster_payer {
    label="Payer";
    color="#e5e7eb";
    P_ACH   [label="ACH Payment"];
    P_Agg   [label="CC / PayPal / OBD Payment"];
  }

  subgraph cluster_payfac {
    label="PayFac / IC";
    color="#c7d2fe";
    F_FilterBillers [label="Filter billers\n(PayFac-enabled only)", fillcolor="#f3f4f6"];
    F_ApplyExcl     [label="Apply Exclusions:\n- Payment Holds\n- Not exported to CIS", fillcolor="#f3f4f6"];
    F_FI_ACH        [label="Funding Instruction (ACH)\nDebit Payer ➜ Credit IC FBO", fillcolor="#dcfce7"];
    F_FI_Agg        [label="Funding Instruction (Aggregates)\nDebit IC FBO ➜ Credit Biller", fillcolor="#dcfce7"];
    F_ServiceFees   [label="Service Fees ➜ IC FBO (BID 1)", fillcolor="#fde68a"];
    F_AssignBatch   [label="Assign SettledBatchId &\nExpected Deposit Date", fillcolor="#fef3c7"];
    F_UpdateStatus  [label="Update Payment Service:\nPending / Funded", fillcolor="#fef3c7"];
    F_SyncCheck     [label="Sync Check:\nPayment Service ↔ Biller Shard", fillcolor="#f3f4f6"];
    F_FBO           [label="IC Chase FBO Account", shape=folder, fillcolor="#eef2ff"];
  }

  subgraph cluster_db {
    label="Databases";
    color="#bbf7d0";
    D_PaySvc [label="Payment Service DB"];
    D_BShard [label="Biller Shard DB"];
  }

  subgraph cluster_biller {
    label="Biller";
    color="#fde68a";
    B_Account [label="Biller Deposit Account", shape=folder, fillcolor="#fffbeb"];
  }

  // --- Flows ---
  P_ACH -> F_FilterBillers;
  P_Agg -> F_FilterBillers;

  F_FilterBillers -> F_ApplyExcl;
  F_ApplyExcl -> F_FI_ACH;
  F_ApplyExcl -> F_FI_Agg;

  // Money movement
  F_FI_ACH -> F_FBO [penwidth=2, color="green"];
  F_FI_Agg -> F_FBO [penwidth=2, color="green", label="Debit"];
  F_FI_Agg -> B_Account [penwidth=2, color="green", label="Credit"];
  F_ServiceFees -> F_FBO [penwidth=2, color="orange"];

  // Batch + statuses
  {F_FI_ACH F_FI_Agg} -> F_AssignBatch;
  F_AssignBatch -> D_BShard;
  F_UpdateStatus -> D_PaySvc;

  // Sync check gating
  F_AssignBatch -> F_SyncCheck;
  F_UpdateStatus -> F_SyncCheck;
  F_SyncCheck -> F_FI_ACH [style=dashed];
  F_SyncCheck -> F_FI_Agg [style=dashed];
}

 URL:/spaces/EA/pages/4687528075/Funding+Instruction+Flow
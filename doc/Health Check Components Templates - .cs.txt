1
6
false
none
list
false
Database:
Health Check - IC.Database 
using System;
using System.Linq;
using IC.Interfaces;
using IC.Database;
using IC.Database.Authentication.AzureFunctions;
using IC.Interfaces.Database.Enums;
using Microsoft.Extensions.Logging;  


public partial class HealthCheck
{
    public static bool DatabaseHealthCheck(ILogger logger, IKeyVaultReader keyVaultClient, ISettingsService settingsService, string applicationName, DatabaseName databaseName)
{

    logger.Information("DatabaseHealthCheck: Started");
    bool result = false;

    try
    {
        var query = "Select 1";

        var dbProxy = GetDatabaseProxy(keyVaultClient, settingsService, applicationName, databaseName)
        var dataTable = dbProxy.GET_DATASET(query, 0).Tables[0];
        if (dataTable.Rows.Count > 0)
        {
            logger.Information("DatabaseHealthCheck: Passed");
            result = true;
        }

        else
            logger.Error("DatabaseHealthCheck: Finished with GET_DATASET returning invalid value {result}", result);


    }
    catch (Exception ex)
    {
        logger.Error(ex, "DatabaseHealthCheck: GET_DATASET Failed");
        result = false;
    }

    return result;
}

private DatabaseProxy GetDatabaseProxy(IKeyVaultReader keyVaultClient, ISettingsService settingsService, string applicationName, DatabaseName databaseName)
{
    DatabaseOptions dbOptions = new DatabaseOptions()
    {
        AzureSqlAuthTokenService = new IC.Database.Authentication.AzureFunctions.DatabaseTokenProvider(String.Empty),
        KeyvaultClient = keyVaultClient,
        SettingsService = settingsService
    };
    var proxy = new DatabaseProxy(dbOptions);
    proxy.ApplicationName = applicationName;
    proxy.DefaultDatabase = databaseName;
    return proxy;
}

}


Health Check -  
IC.MicroService.DAL.EntityFramework
using IC.MicroService.DAL.EntityFramework;
using Microsoft.EntityFrameworkCore;

public partial class HealthCheck
{
    // IDbContextProvider instance
    private readonly IDbContextProvider _dbContextProvider;


    public HealthCheck(IDbContextProvider dbContextProvider)
    {
        _dbContextProvider = dbContextProvider;
    }

    /// <summary>
    /// This method checks the health of the IDbContextProvider
    /// </summary>
    /// <returns>Returns true if the connection to the database is successful, false otherwise</returns>
    public bool DatabaseHealthCheck(int billerId)
    {

        try
        {
            // Use the IDbContextProvider to get the DbContext
            var dbContext = _dbContextProvider.GetBillerDbContext<DbContext>(billerId).Result;

            // If no exception is thrown, the health check is successful
            return dbContext != null;
        }
        catch
        {
            // If an exception was thrown, the database connection failed
            return false;
        }
    }
}

KeyVault
HealthCheck - 
EnvironmentVariableReader
using System;
using IC.Interfaces;
using IC.Database.Authentication.AzureFunctions;
using Microsoft.Extensions.Logging;  


public partial class HealthCheck
{

    public bool KeyvaultHealthCheck(ILogger logger, IKeyVaultReader keyVaultClient, string secretKey)
    {
        logger.Information("KeyvaultHealthCheck: Started");

        bool result = false;

        try
        {
            string secret;
            
			keyVaultClient.TryGetSecret(secretKey, out secret);


            if (secret != null)
            {
                logger.Information("KeyvaultHealthCheck: Passed");
                result = true;
            }
            else
            {
                logger.Error("KeyvaultHealthCheck: TryGetSecret Failed returning empty value");
            }
        }

        catch (Exception ex)
        {
            logger.Error(ex, "KeyvaultHealthCheck: TryGetSecret Failed");
        }

        return result;
    }
	
	
}
Queue
HealtCheck - 
ICAzureMessageQueue
using System;
using IC.Interfaces;
using ICAzureMessageQueue;
using Microsoft.Extensions.Logging;


public partial class HealthCheck
{

    public bool QueueHealthCheck(ILogger logger, string queueNameStorageName, QueueType queueType)
    {
        logger.Information("QueueHealthCheck: Started");

        bool result = false;

        try
        {
            IKeyVaultReader keyVaultClient = GetKeyVaultClient();
			var factory = new AzureMessageQueueFactory(keyVaultClient);
			var queueName = keyVaultClient.GetSecret(queueNameStorageName).ToString();
			var client = factory.CreateQueueClient(queueType, queueName);
			client.PeekMessages(1);
			
			logger.Information("QueueHealthCheck: Passed");
            result = true;
        }

        catch (Exception ex)
        {
            logger.Error(ex, "QueueHealthCheck: PeekMessages Failed");
        }

        return result;
    }
}
Email
Health Check
ICFramework.Utilities.Email

will have some placeholders for email parameters

using System;
using System.Linq;

public partial class HealthCheckService
{
    public static bool EmailHealthCheck()
    {
	 
	  SL.Log.Information("EmailHealthCheck: Started");
        bool result = false;

	 
        MailMessage msg = new MailMessage();

    msg.From = new MailAddress("no-reply@invoicecloud.net", "IT Processes");
    msg.To.Add("x-MMaldonado@invoicecloud.com");
    msg.To.Add("x-CResendiz@invoicecloud.com");
    msg.To.Add("x-SCastro@invoicecloud.com");
    msg.Body = $"This email was send from ICSkybotJobMonitor";
    msg.IsBodyHtml = false;
    msg.Subject = "SKYBOT HEALTH CHECK";

    if(Email.SendEmailWithMailGun(msg, true))
    {
        SL.Log.Information("ICSkybotJobMonitor - Health Check sent email Successfull");
        result=  true;
    }
    else
    {
        SL.Log.Information("ICSkybotJobMonitor - Health Check sent email Failed.");
        result= false;
    }
	
	return result;
	
    }
}
DI Health Check:
c#
using System;  
using System.Linq;  
using System.Net.Mail;  
using ICFramework.Utilities.Email;
using Microsoft.Extensions.Logging;  
  
public partial class HealthCheckService  
{  
    public bool EmailHealthCheck(IEmailService emailService, ILogger loggerService)  
    {
        try
        {
            MailMessage msg = new MailMessage();  
            msg.From = new MailAddress("no-reply@invoicecloud.net", "IT Processes");  
            msg.To.Add("jgonzalez@invoicecloud.com");  
            msg.Body = $"This email was sent from HealthCheckService";  
            msg.IsBodyHtml = false;  
            msg.Subject = "HEALTH CHECK";  
      
            if(emailService.SendEmailWithMailGun(msg, true))  
            {  
                loggerService.LogInformation("Triggered By: {Event}, Message: {Message.}", "EmailHealthCheck", "Health Check Success");
                return true;  
            }  
            else  
            {  
                loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "EmailHealthCheck", "Health Check Failed);  
            }
        }
        catch (Exception ex)
        {
            loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "EmailHealthCheck", "Health Check Failed);
        }  
        return false;  
    }  
}  
IC.Logins
HealthCheck
 Dim loginID = dt.Rows(0)("LoginID")
        Dim login = IC.Logins.Login.FromLoginID(1146, loginID)
        Dim result As Boolean = login.LoginID > 0

        If dbPass AndAlso result Then
            Console.WriteLine(Now.ToString & " - HealthCheck Passed")
        Else
            Console.WriteLine(Now.ToString & " - HealthCheck Failed")
            Throw New Exception("HealthCheck Failed. No rows returned")
        End If
DI Health Check:
c#
using System;
using Microsoft.Extensions.Logging;  
  
public partial class HealthCheckService  
{  
    public bool ICLoginsHealthCheck(ILogger loggerService)  
    {
        try
        {
            IC.Logins.LoginNotify(58395, 123251, 213141).EmailAddressesToNotify();
            loggerService.Information("Triggered By: {Event}, Message: {Message.}", "ICLoginsHealthCheck", "Health Check Success");
            return true;
        }
        catch (Exception ex)
        {
            loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "ICLoginsHealthCheck", "Health Check Failed);
        }  
        return false;  
    }  
}  
CloudCrypto
Health Check
  Try
            Dim temp = "HealthCheck"
            Dim salt = Guid.NewGuid().ToString()
            Dim encrypted = CloudCrypto.AES.Encrypt(temp, salt)
            Dim decrypted = CloudCrypto.AES.Decrypt(encrypted, salt)
            result = temp.Equals(decrypted)
        Catch ex As Exception
            result = False
            Serilog.Log.Error("Triggered By {0} - Check Failed {1}", "Health Check", "Vault Connectivity")
            Return New HttpResponseMessage() With {.Content = New StringContent(result.ToString)}
        End Try
		
DI Health Check:
c#
using System;
using Microsoft.Extensions.Logging;   
  
public partial class HealthCheckService  
{  
    public bool CloudCryptoHealthCheck(ILogger loggerService)  
    {
        try
        {
            var temp = "HealthCheck"
            var salt = Guid.NewGuid().ToString();
            var encrypted = CloudCrypto.AES.Encrypt(temp, salt);
            var decrypted = CloudCrypto.AES.Decrypt(encrypted, salt);
            result = temp.Equals(decrypted);
            loggerService.LogInformation("Triggered By: {Event}, Message: {Message.}", "CloudCryptoHealthCheck", "Health Check Success");
            return true;
        }
        catch (Exception ex)
        {
            loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "CloudCryptoHealthCheck", "Health Check Failed);
        }  
        return false;  
    }  
}  
SFTP
HealthCheck
  Public Sub CheckSFTPHealth()
        Dim log As String
        Dim ftp As New SFTP(SFTP.Profile.MASTERCARD)

        Try
            Serilog.Log.Information("Triggered By: {Event}, Message: {Message.}", "CheckSFTPHealth", "SFTP Connectivity Check")
            log = ftp.TestSFTPConnectivity()

            Serilog.Log.Information("Triggered By: {Event}, Message: {Message}.", "CheckSFTPHealth", "SFTP Connectivity Passed")
        Catch ex As Exception
            Serilog.Log.Error(ex, "Triggered By: {Event}, Message: {Message}.", "CheckSFTPHealth", "SFTP Connectivity Failed")

            Environment.ExitCode = -1

        End Try
    End Sub
	
DI Health Check:
c#
using System;
using Chilkat;
using Microsoft.Extensions.Logging;   
  
public partial class HealthCheckService  
{  
    public bool ChilkatSFTPHealthCheck(ILogger loggerService)  
    {
        try
        {
            var sFtp = new SFtp();
            if (sFtp.UnlockComponent("NVCCLDSSH_duvJcQx49Xne"))
            {
                loggerService.LogInformation("Triggered By: {Event}, Message: {Message.}", "ChilkatSFTPHealthCheck", "Health Check Success");
                return true;
            }
            loggerService.LogError("Triggered By: {Event}, Message: {Message.}", "ChilkatSFTPHealthCheck", "Health Check Failed");
        }
        catch (Exception ex)
        {
            loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "ChilkatSFTPHealthCheck", "Health Check Failed);
        }  
        return false;  
    }  
}  
Azure Blob
HealthCheck

using System;
using System.Linq;
using SL = Serilog;

public partial class HealthCheckService
{
    public static bool AzureBlobServiceHealthCheck()
    {
         SL.Log.Information("AzureBlobServiceHealthCheck: Started");
        bool result = false;

        try
        {
            var list = IC.Azure.Blob.AzureBlobService.RetrieveStorageFileList(IC.Azure.Blob.StorageType.Generic, "webservice-traffic", "221");
			
			 if (list.Count > 0)
            {
                SL.Log.Information("AzureBlobServiceHealthCheck: Passed");
                result = true;
            }
			
			else
			 SL.Log.Error("AzureBlobServiceHealthCheck: Finished with RetrieveStorageFileList returning invalid value {result}", result);
        }
        catch (Exception ex)
        {
             SL.Log.Error(ex, "AzureBlobServiceHealthCheck: RetrieveStorageFileList Failed");
            result = false;
        }
		
		return result;
    }
}

DI Health check:
c#
using System;
using System.Linq;
using Microsoft.Extensions.Logging;

public partial class HealthCheckService
{
    public static bool AzureBlobServiceHealthCheck(ILogger loggerService)
    {
        try
        {
            var list = IC.Azure.Blob.AzureBlobService.RetrieveStorageFileList(IC.Azure.Blob.StorageType.Generic, "webservice-traffic", "221");
			if (list.Count > 0)
            {
                loggerService.Information("Triggered By: {Event}, Message: {Message.}", "AzureBlobServiceHealthCheck", "Health Check Success");
                return true;
            }
			else
			 	loggerService.LogError("Triggered By: {Event}, Message: {Message.}", "AzureBlobServiceHealthCheck", "Health Check Failed);
        }
        catch (Exception ex)
        {
            loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message.}", "AzureBlobServiceHealthCheck", "Health Check Failed);
        }
		return false;
    }
}
ICBusinessService
HealthCheck
using System;
using System.Linq;
using SL = Serilog;

public partial class HealthCheckService
{
    public static bool ICBusinessServiceHealthCheck()
  {
		try  
		{  
			// Business may need to be changed to correct class name
			Business.CallService(client => client.GetServiceVersion());
			return true;
		}  
		catch (Exception ex)  
		{  
			SL.Log.Error(ex, "Triggered By: {Event}, Message: {Message}.", "ICBusinessServiceHealthCheck", "ICBusinessService Connectivity Failed");
		}
		return false;
  }
}  
DI Health check:
c#
using System;
using System.Linq;
using Microsoft.Extensions.Logging;

public partial class HealthCheckService
{
    public static bool ICBusinessServiceHealthCheck(ILogger loggerService)
  {
		try  
		{  
			// Business may need to be changed to correct class name
			Business.CallService(client => client.GetServiceVersion());
			loggerService.Information("Triggered By: {Event}, Message: {Message.}", "ICBusinessServiceHealthCheck", "Health Check Success");
			return true;
		}  
		catch (Exception ex)  
		{  
			loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message}.", "ICBusinessServiceHealthCheck", "Health Check Failed");
		}
		return false;
  }
}  
IC.ServiceProxies/CryptoService Health Check
HealthCheck- Console
using System;
using SL = Serilog;

public partial class HealthCheck
{
    public static bool CryptoServiceHealthCheck()
  {
        bool result = false;
		try  
		{ 			
			string serviceVersion = IC.ServiceProxies.Services.CryptoService.GetServiceVersion();
            result = !String.IsNullOrEmpty(serviceVersion);
		}  
		catch (Exception ex)  
		{ 
			result = false;
			SL.Log.Error(ex, "Triggered By: {0}-Check Failed: { 1}", "Health Check", "CryptoService"); 		
		}
		return result;
  }
}
DI Health Check:
c#
using System;
using System.Linq;
using Microsoft.Extensions.Logging;

public partial class HealthCheckService
{
    public static bool CryptoServiceHealthCheck(ILogger loggerService)
  {
		try  
		{  
			IC.ServiceProxies.Services.CryptoService.GetServiceVersion();
			loggerService.Information("Triggered By: {Event}, Message: {Message.}", "CryptoServiceHealthCheck", "Health Check Success");
			return true;
		}  
		catch (Exception ex)  
		{  
			loggerService.LogError(ex, "Triggered By: {Event}, Message: {Message}.", "CryptoServiceHealthCheck", "Health Check Failed");
		}
		return false;
  }
}  
HealthCheck- API
using System;
using System.Net.Http;
using System.Web.Http.Cors;
using System.Web.Http;
using SL = Serilog;

[EnableCors("*", "*", "*")]
public partial class HealthCheckController : ApiController
{
    [Route("healthcheck")]
    [HttpGet]
    public HttpResponseMessage CryptoServiceHealthCheck()
    {
        bool result = false;
        try
        {
            string serviceVersion = IC.ServiceProxies.Services.CryptoService.GetServiceVersion();
            result = !String.IsNullOrEmpty(serviceVersion);
        }
        catch (Exception ex)
        {
            result = false;
            SL.Log.Error(ex, "Triggered By: {0}-Check Failed: { 1}", "Health Check", "CryptoService");
            return new HttpResponseMessage()
            {
                Content = new StringContent(result.ToString())
            };
        }

        return new HttpResponseMessage()
        {
            Content = new StringContent(result.ToString())
        };
    }
}
NewRelic
HealthCheck - Console
using System;
using SL = Serilog;

public partial class HealthCheck
{
    public static bool NewRelicHealthCheck()
    {
        bool result = false;
        try
        {
            Exception customException = new Exception("Ignore-This is a test exception.");
            NewRelic.Api.Agent.NewRelic.NoticeError(customException);
            result = true;
        }
        catch (Exception ex)
        {
            result = false;
            SL.Log.Error(ex, "Triggered By: {0}-Check Failed: { 1}", "Health Check", "NewRelic");
        }
        return result;
    }
}
HealthCheck - API
using System;
using System.Net.Http;
using System.Web.Http.Cors;
using System.Web.Http;
using SL = Serilog;

[EnableCors("*", "*", "*")]
public partial class HealthCheckController : ApiController
{
    [Route("healthcheck")]
    [HttpGet]
    public HttpResponseMessage NewRelicHealthCheck()
    {
        bool result = false;
        try
        {
            Exception customException = new Exception("Ignore-This is a test exception.");
            NewRelic.Api.Agent.NewRelic.NoticeError(customException);
            result = true;
        }
        catch (Exception ex)
        {
            result = false;
            SL.Log.Error(ex, "Triggered By: {0}-Check Failed: { 1}", "Health Check", "NewRelic");
            return new HttpResponseMessage()
            {
                Content = new StringContent(result.ToString())
            };
        }

        return new HttpResponseMessage()
        {
            Content = new StringContent(result.ToString())
        };
    }
}
Serilog
HealthCheck - Console
using System;
using System.Xml.Linq;
using SL = Serilog;

public partial class HealthCheck
{
    public static bool SerilogHealthCheck()
    {
        bool result = false;
        try
        {
            SL.Log.Information("Ignore - This is a test message.");
            result = true;
        }
        catch (Exception ex)
        {
            result = false;
            Console.WriteLine("Triggered by: Health Check - Check Failed: Serilog - Exception: {0} ", ex.ToString());
        }
        return result;
    }
}

HealthCheck - API
using System;
using System.Net.Http;
using System.Web.Http.Cors;
using System.Web.Http;
using SL = Serilog;

[EnableCors("*", "*", "*")]
public partial class HealthCheckController : ApiController
{
    [Route("healthcheck")]
    [HttpGet]
    public HttpResponseMessage SerilogHealthCheck()
    {
        bool result = false;
        try
        {
            SL.Log.Information("Ignore - This is a test message.");
            result = true;
        }
        catch (Exception ex)
        {
            result = false;
            Console.Write($"Triggered by: Health Check - Check Failed: Serilog - Exception: {ex.Message} ");       
            return new HttpResponseMessage()
            {
                Content = new StringContent(result.ToString())
            };
        }

        return new HttpResponseMessage()
        {
            Content = new StringContent(result.ToString())
        };
    }
}
Microsoft.Extensions.Logging
HealthCheck
using Microsoft.Extensions.Logging;
using System;

public partial class HealthCheck
{
    private readonly ILogger<HealthCheck> _logger;


    public HealthCheck(ILogger<HealthCheck> logger)
    {
        _logger = logger;
    }
    public bool LoggingHealth(out string logerror)
    {
        try
        {
            _logger.LogInformation("Performing health check for the logging system...");
            logerror = string.Empty;
            return true;
        }
        catch (Exception ex)
        {
            logerror= "An error occurred while performing health check for the logging system" + ex.ToString();
           return false;
        }
    }
}

IC.Azure.Batch
HealthCheck - Console
using System;
using System.Collections.Generic;
using System.Xml.Linq;
using SL = Serilog;

public partial class HealthCheck
{
    public static bool AzureBatchHealthCheck()
    {
        bool result = false;
        try
        {
            // Provide the resourceGroup and batchAccountName parameters for GetOrCreateAzureBatchClient method
            // Optionally instead of creating a new client, use the batch client already existing in your application
            IC.Azure.Batch.AzureBatchClient client = IC.Azure.Batch.AzureBatchClient.GetOrCreateAzureBatchClient("", "");
            List<Microsoft.Azure.Batch.CloudPool> existingPools = client.GetAllPools().Result;
            result = existingPools.Count > 0;

        }
        catch (Exception ex)
        {
            result = false;
            SL.Log.Error(ex, "Triggered By: {0}-Check Failed: { 1}", "Health Check", "AzureBatch");
        }
        return result;
    }
}
 URL:/spaces/EN/pages/3063971867/Health+Check+Components+Templates+-+.cs
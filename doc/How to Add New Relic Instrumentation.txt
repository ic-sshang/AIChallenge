Note
This page is semi-transcribed from the 
Development Standards Training on EngageSmart University
. Please follow the embedded link to view the videos for more information. 
Initial Configuration
Step 1: Downloading the NewRelic.Agent NuGet Package
Download the latest version of the NewRelic.Agent NuGet Package (at the time of this article that is Version 10.5.1). This NuGet Package will create a “newrelic” folder in the base directory of the project that contains extensions and config files that we will use later. 
How to Download the NewRelic.Agent NuGet Package
Clone the repository you want to add the package to.
Open the solution by double-clicking on the solution file (file extension .sln) in the Solution Explorer.
Right-click on the project.
For VB projects, the logo beside it is a rectangle with the letters “VB” inside.
For VB test projects, the logo beside it is a Window icon with a flask icon in front. 
Select the Option “Manage NuGet Packages…” option. 
Select Browse.
Search for the NewRelic.Agent package using the search bar. 
Click on the package.
Select the version and click “Install”.
Step 2: Adding the newrelic.config File to the Base Directory 
There are 2 ways to do this, one for more experienced developers and the other for those new to New Relic instrumentation:
(Experienced) Copy the newrelic.config file from the newrelic folder that was created from the NuGet Package and paste it in the base directory of your project. From here, edit the file to use the configurations that are required.
(New to New Relic Instrumentation - Recommended for most developers) Copy and paste the newrelic.config file from the newrelic folder that was created from the NuGet Package into base directory of your project. Replace the text with the following: 
xml
<?xml version="1.0"?>
<!-- Copyright (c) 2008-2020 New Relic, Inc.  All rights reserved. -->
<!-- For more information see: https://docs.newrelic.com/docs/agents/net-agent/configuration/net-agent-configuration/ -->
<configuration xmlns="urn:newrelic-config" agentEnabled="true">
  <service licenseKey="[See New Relic Documentation for License Key]" 
           completeTransactionsOnThread="True"
           forceNewTransactionOnNewThread="True"
           sendDataOnExit="True"
           autoStart="True"
           sendEnvironmentInfo="True"
           />
  <application>
    <name>XXXXX</name>
  </application>
  <log level="info" />
  <allowAllHeaders enabled="true" />
  <attributes enabled="true">
    <exclude>request.headers.cookie</exclude>
    <exclude>request.headers.authorization</exclude>
    <exclude>request.headers.proxy-authorization</exclude>
    <exclude>request.headers.x-*</exclude>
    <include>request.headers.*</include>
  </attributes>
  <transactionTracer enabled="true" transactionThreshold="apdex_f" stackTraceThreshold="500" recordSql="obfuscated" explainEnabled="false" explainThreshold="500" />
  <distributedTracing enabled="true" />
  <errorCollector enabled="true">
    <ignoreClasses>
      <errorClass>System.IO.FileNotFoundException</errorClass>
      <errorClass>System.Threading.ThreadAbortException</errorClass>
    </ignoreClasses>
    <ignoreStatusCodes>
      <code>401</code>
      <code>404</code>
    </ignoreStatusCodes>
  </errorCollector>
  <browserMonitoring autoInstrument="true" />
  <threadProfiling>
    <ignoreMethod>System.Threading.WaitHandle:InternalWaitOne</ignoreMethod>
    <ignoreMethod>System.Threading.WaitHandle:WaitAny</ignoreMethod>
  </threadProfiling>
  <instrumentation>
    <applications>
      <application name="XXXXX.exe" />
    </applications>
  </instrumentation>
</configuration>
Replace the XXXX characters in the file above with the name of the application you are instrumenting. Make sure that the second set of XXXXX characters is the name of the executable for this app. This file contains some configurations that are commonly used. 
Step 3: Adding the appSettings.json File to the Base Directory 
From the base directory, create a new file called “appSettings.json”. In this file, paste the following:
{
  "NewRelic.AppName": "XXXXX",
  "NewRelic.AgentEnabled": true,
  "ClientId": ""
}
Again, make sure to replace the XXXXX with the application’s name. 
Step 4: Downloading the NewRelic.Agent.Api NuGet Package
The second NuGet Package that is required is the Api variant of the NewRelic Agent. This NuGet package will allow us to use some additional functionality. At the time of this article’s writing, the version we are using is 8.20.262. 
Instrumentation
Step 1: Add the Namespace
For VB.NET applications, use the “Imports NewRelic.Api.Agent” statement to ensure that we can use the API’s functionality. 
Step 2: Add the Method Attribute 
VB.NET
Use the <NewRelic.Api.Agent.Transaction> or the <NewRelic.Api.Agent.Trace> attribute above the method that you want to instrument. 
C#
Use the [NewRelic.Api.Agent.Transaction] or the [NewRelic.Api.Agent.Trace] attribute above the method that you want to instrument. 
Troubleshooting
New Relic Connection Logs
Make sure you are running your code on a server with the .NET Agent installed (such as IC-Term-01).
Navigate to the default location for the New Relic Transaction connection logs (C:\ProgramData\New Relic\.NET Agent\Logs) and search for the Application Name that was setup in the newrelic.config file. The filename is in the format newrelic_agent_[ApplicationName].log (e.g. 
newrelic_agent_DataPump.log
). 
The contents of this file are sorted by the timestamp descending, so the latest record is at the bottom of the file. 
If you see the phrase “Agent fully connected.” then the Agent has successfully connected to New Relic. 
New Relic Profiler Logs
In the New Relic Connection logs, copy the value of the pid. Paste this value in to the search bar of the default location for the New Relic Transaction connection logs (C:\ProgramData\New Relic\.NET Agent\Logs). The filename of the file you are looking for is in the format NewRelic.Profiler.[pid].log. 
 URL:/spaces/DS/pages/2640871425/How+to+Add+New+Relic+Instrumentation
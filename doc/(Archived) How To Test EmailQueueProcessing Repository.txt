Refer to the following page for the updated process
: 
https://invoicecloud.atlassian.net/wiki/pages/resumedraft.action?draftId=3960373249&draftShareId=47d0c23a-6495-4cdf-abb4-ce98b1f73ac9
 
This document will detail the steps for running the EmailQueueProcessing repository. You will need to have inserted an email into the email queue table of your biller beforehand. You will also need the email queue type ID you are using.
Running EmailQueueProcessing 
Clone the EmailQueueProcessing repository
Go to 
Module1.vb
Switch the following code from TERM to AVD
If Environment.MachineName.ToUpper().Contains("APP").Equals(False) AndAlso Environment.MachineName.ToUpper().Contains("AVD").Equals(False) Then
    Throw New Exception("billerid environment variable is not an integer")
End If
Go to the EmailQueueProcessing project-> Properties
Go to Debug-> in Command line argument put the email queue type ID you’re working with
SELECT * FROM tblEmailQueueType ORDER BY 1 ASC
Note: Some Email Queue Types require a second number. Review 
Module1.vb’s 
function called StartProcessingEmail. For example, Credit Card Expiration Notifications requires the command line arguments to be the following: “30 -MonthlyBatch”
 
Go to the EmailQueue folder in Solution Explorer and select the queue you want to run. (using consolidated Receipt Queue as an example)
Go to the GetEmailQueueItemsSql() function of your queue and specify the BID
Go to the constructor and set AvailabeForAzureBatch to false
  Public Sub New()
      Me.AvailableForAzureBatch = FALSE
  End Sub
Go to the Nuget package manager -> Installed -> Search database -> click on IC.Database -> Change version to 1.0.7947.27924
Package Source must be set to “All” 
Go to the file 
DatabaseHandlerV2
 and replace the code with the code at the end of this doc
Go to EmailQueueProcessing’s 
app.config
 and replace the value of RunAsyncThreadCount to 1
Go to EmailQueue.vb -> ProcessRow-> insert the email address you want to test with
item.EmailAddressCC = "YOUR_EMAIL@invoicecloud.com"
Run
DatabaseHandlerV2 code
Imports IC.Database

Imports IC.Database.Databases

Imports IC.Database.Factories

Public Class DatabaseHandlerV2

    Implements IEmailQueueDatabase

    Private Shared _masterDb As DatabaseProxy = Nothing

    Private Shared ApplicationName As String = "IC.EmailQueue"

    Public Sub New()

        _masterDb = New DatabaseProxy()

    End Sub

    Private Shared Function CallDB(Of TResult)(BillerID As Integer, MethodCall As Func(Of DatabaseBase, TResult)) As TResult

        Return _masterDb.CallService(BillerID, String.Empty, MethodCall)

    End Function

    Public Function EXECUTE_COMMAND_NONQUERY(sql As String, billerid As Integer) As Integer Implements IEmailQueueDatabase.EXECUTE_COMMAND_NONQUERY

        Return CallDB(Of Integer)(billerid, Function(client) client.EXECUTE_COMMAND_NONQUERY(DatabaseBase.DatabaseName.DBDynamic, sql, 300))

    End Function

    Public Function EXECUTE_COMMAND_NONQUERY(databaseName As String, sql As String, billerid As Integer) As Integer Implements IEmailQueueDatabase.EXECUTE_COMMAND_NONQUERY

        Return CallDB(billerid, Function(c) c.EXECUTE_COMMAND_NONQUERY(GetDatabaseName(databaseName), sql, 300))

    End Function

    Public Function EXECUTE_COMMAND_SINGLE_RESULT(sql As String, billerid As Integer) As String Implements IEmailQueueDatabase.EXECUTE_COMMAND_SINGLE_RESULT

        Return CallDB(Of String)(billerid, Function(client) client.EXECUTE_COMMAND_SINGLE_RESULT(DatabaseBase.DatabaseName.DBDynamic, sql, 300))

    End Function

    Public Function EXECUTE_COMMAND_SINGLE_RESULT(databaseName As String, sql As String, billerid As Integer) As String Implements IEmailQueueDatabase.EXECUTE_COMMAND_SINGLE_RESULT

        Return CallDB(billerid, Function(c) c.EXECUTE_COMMAND_SINGLE_RESULT(GetDatabaseName(databaseName), sql, 300))

    End Function

    Private Shared Function GetDatabaseName(databaseName As String) As Object

        Return [Enum].Parse(GetType(IC.Database.DatabaseBase.DatabaseName), databaseName)

    End Function

    Public Function GET_DATASET(sql As String, billerid As Integer) As DataSet Implements IEmailQueueDatabase.GET_DATASET

        Return CallDB(Of DataSet)(billerid, Function(client) client.GET_DATASET(DatabaseBase.DatabaseName.DBDynamic, sql, 300))

    End Function

    Public Function GET_DATATABLE(sql As String, billerid As Integer) As DataTable Implements IEmailQueueDatabase.GET_DATATABLE

        Return CallDB(Of DataTable)(billerid, Function(client) client.GET_DATATABLE(DatabaseBase.DatabaseName.DBDynamic, sql, 300))

    End Function

    Public Function GET_DATATABLE_MULTISHARD(sql As String, billerList As List(Of Integer)) As DataTable Implements IEmailQueueDatabase.GET_DATATABLE_MULTISHARD

        Return CallDB(0, Function(client) client.GET_DATATABLE_MULTISHARD(sql, 300, billerList))

    End Function

End Class
EQP Test Notes
Identify the Stored Procedure Call
:
Check the "base" method of each queue.
If the stored procedure call is 
selemailqueue
, you can insert directly into the 
EmailQueue
 table.
Ensure the data is getting picked up by testing the SP in SSMS under your Biller shard
Ensure you have the relevant data (e.g., payment receipts, AP/SP reminders) for correct processing.
Handle Different Stored Procedures
:
If the stored procedure differs, stage additional data tailored for that specific call.
Verify and Create Jobs in DevTest
:
QA has attempted to create all jobs in 
devtest
 that exist in 
prod
, but some queues may be missing.
If you're working on a queue without a job, copy an existing job:
Right-click on the job.
Change the name/description.
Modify the command argument to pass a different 
emailqueuetypeid
.
Ensure your Biller has RTDR disabled:
Can be found in CRM under Invoicing → Advanced Configuration → Disable “Real Time Data Refresh“ checkbox
 
 URL:/spaces/PE/pages/2890399904/Archived+How+To+Test+EmailQueueProcessing+Repository
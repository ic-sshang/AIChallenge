Summary of Planned Changes
Barracuda to App Gateway
 switchover in Production Network Lane
GoDaddy DNS Entry switch to go thru Cloudflare for the following hostnames:
icg-reporting.invoicecloud.com
icg-boarding.invoicecloud.com
icg-payments.invoicecloud.com
ncf.invoicecloud.com
web1 thru 10
test1sms
The 
icg
 hostnames are already going thru Cloudflare in all NonProd Environments (DevTest(s), Cert, QA-Regression, and Preview)
 to run tests during the week of 7/8/2024 leading up to 7/14/2024 to lower the risk of these changes in Production by identifying any Cloudflare WAF Blocks ahead of time, evaluating them, and creating WAF Exceptions in Cloudflare as needed. 
 
Whitelist Cloudflare IPs in the Production Palo Alto Firewall for Ports 80 and 443.  Block all other traffic coming in on those Ports.
 
(
  This activity is removed for this Maintenance Window)
 please do this in NonProd Palo Alto Firewall on Monday 7/8/2024 to ensure familiarity with the changes and to give the changes some time to bake in DevT
est Network Lane. 
 
Due to finds made by 
 , this item is being pulled from the maintenance window.  
 is working to get some clarifications from Cloudflare based on his findings.
Deploy App Gateway Access Log streaming to AlienVault’s EventHub for Prod and NonProd instances.
Pre-Steps
In sequence:
Put notification in DailyOps channel  
 
 
First Run the Load Against existing Network Stack (Barracuda) for 10 minutes for 2,100 Virtual Users 
 and 
 
Moved to 7/11/2024 Post Release
Stop the Jobs - 
Refer to Pre-maintenance steps related to Jobs here
 
 
 
Execution Plan
Enable all 
Prod NewRelic Alerts for App Gateway
 
 
 or 
 
Scale Up Production App Gateway Instances 
 
Forward all traffic from Prod Firewall to App Gateway 
 
 
Update Host Files on the Web Servers to point to App Gateway IP Address (
10.211.82.4
) instead of Barracuda (
10.0.3.20
)
 
IC-Web1 thru 10 
 
 
App Servers 1 thru 10 
 
 
Note, still need to analyze Host Files for:
Prod Proxy Servers 
 
Prod App Servers 
 
Preview Web Server(s) 
 
Preview Proxy Server(s) 
 
Preview App Server(s) 
 
QA-Regression Web Server(s) 
 
QA-Regression Proxy Server(s) 
 
QA-Regression App Servers(s) 
Test Proxy Server(s) 
 
Test App Server(s) 
 
IC-BuildAgents 
 
 
IC-PDFExtracts 
 
 
IC-Seleniums 
 
 
IC-Skybots 
 
 
 to do the analysis of the above Servers Host files
Update Cloudflare for the following hostnames:
icg-reporting.invoicecloud.com
 
 
icg-boarding.invoicecloud.com
 
 
icg-payments.invoicecloud.com
 
 
ncf.invoicecloud.com
 
 
web1 thru 10
 
 
test1sms
 
 
Update GoDaddy DNS Entry for the following hostnames:
icg-reporting.invoicecloud.com
 
 
icg-boarding.invoicecloud.com
 
 
icg-payments.invoicecloud.com
 
 
ncf.invoicecloud.com
 
 
web1 thru 10
 
 
test1sms
 
 
Run pipelines to Deploy the App Gateway Access Log streaming to AlienVault Event Hub for both NonProd and Prod
Testing Plan
Parallel activities:
Run the following set of K6 tests to test functional connectivity: 
prod - Repos (azure.com)
 
 
Run the following PowerShell based tests to test functional connectivity: 
prod - Repos (azure.com)
 
 
PSN Testing their Production App Servers executing against InvoiceCloud Production ICG Endpoints 
 
 
 
 
Run Regression testing for
 
www.invoicecloud.com
 
 
 
Run Regression testing for
 
my.invoicecloud.com
 
 
 
Run Regression testing for 
icg-payments.invoicecloud.com
 
 
Can run 
qa-regression
 tests
 
Run Regression testing for 
icg-boarding.invoicecloud.com
 
 
No Coverage in either Prod or 
qa-regression
 Test Suites
Manual Testing by 
Run Regression testing for 
icg-reporting.invoicecloud.com
 
 
www.invoicecloud.com
 Regression testing will cover in CRM
 
Run Regression testing for 
sms2.invoicecloud.com
 
No Automated Testing Coverage
Look for traffic patterns for this and if no traffic found remove with the other GoDaddy and Cloudflare DNS pruning planned for this year.
 to send 
 Traffic data from App Gateway after the Go-Live
 looking into 
sms
 and 
sms2
Validate Pay by Text Works
7/14 - TC - Received pay by text registration txt message as expected and received reply after response
Run Regression testing for 
sso.invoicecloud.com
 
 
May have some manual testing options
Validate it from the traffic side of things in NewRelic and/or App Gateway Metrics after Go-Live
Manual testing for 
stratus.invoicecloud.com
 
 
Simple Page Load
 
7/14 - TC - Experiences random 404s on WebResource.axd. It was determined on the call that Barracuda had sticky sessions turned on which enabled WebResource.axd to be found consistently on page load.  AppGW does not have sticky sessions enabled.  We talked through it and decided it was not a critical need.  The latest Stratus download links are provided out by Sean (CS) and that isn’t a 
stratus.invoicecloud.com
 link.  NR shows eerily consistent traffic to the page which indicates bot traffic.  Indeed we see gpt crawler traffic. To turn on sticky sessions on AppGW was going to require a full retest. We opted not to do it at this time and will be on the list for next maintenance.  
Run Regression testing for 
www.invoicecloud.com/stratuswebservices/stratus.asmx
 
 
 and 
 and 
Run Regression testing for 
qa-regression.invoicecloud.com
Run UI Portal Regression tests
 
Run Regression testing for UI and API Tests for Payer Next Gen 
Run ApplePay manual Test in Production  
 
Load Testing via JMeter Scripts run in Azure Load Testing instance exercising 3 scenarios: CRM, Biller Portal, Customer Portal
Run Load Test Again with App Gateway in the Network Stack for 10 minutes for 2,100 Virtual Users
Confirm Barracuda has no Traffic after the change 
 
Check to ensure no 404 are not showing up unexpected via Access Log in the Log Analytics Workspace 
 
IVR Tech Production to Production Testing 
 
Karthic
AlienVault Testing to ensure Logs still stream and the new App Gateway Access Logs are there 
 
 
Rollback Plan
Route the Traffic back to Barracuda WAF Load Balancer
Revert back Host file entries on the Web Servers, switching the App Gateway IP out for the previous Barracuda Load Balancer IP
Post-Steps
Start the Jobs - 
Refer to Post-maintenance steps related to Jobs here
 
 
Post finished message in DailyOps channel 
 
Deallocate the Barracuda WAF VMs
On Monday 7/15 or Tuesday 7/16
Maintenance Window Support Team
App Gateway SME: 
Palo Alto SME: 
Cloudflare SME: 
PSN: 
 
 
 
Operations Team Representative: 
Main Regression Tester: 
 
Payer Next Gen Regression Tester: 
ApplePay Tester: 
SRE Representative: 
Skybot Jobs SME: 
 and 
InvoiceCloud Web App SME: 
 and 
MCC Web App SME: 
Stratus Web App SME: 
 and 
Payer NextGen SME: 
 and 
ICG SME: 
SMS SME: 
SSO SME: 
IVR Tech: Karthic
 URL:/spaces/icinfradoc/pages/3370844320/7+14+2024+App+Gateway+Go+Live+and+WAF+Security+Vulnerability+Remediation
Scope and Purpose
This domain provisions one or more azure cache for redis instances to provide low latency, in-memory caching for the application. All instances are locked down to private networks and accessed via only private endpoints.
Detailed Architecture
Terraform Implementation
hcl
# 1. Redis cache instances
resource "azurerm_redis_cache" "redis" {
  for_each = var.redis_instances

  name                          = "redis-${var.region}-${each.key}${var.deployment_version}-${var.environment}"
  location                      = module.resource_group.resource_group.location
  resource_group_name           = module.resource_group.resource_group.name
  sku_name                      = each.value.sku_name
  family                        = each.value.family
  capacity                      = each.value.capacity
  minimum_tls_version           = "1.2"
  public_network_access_enabled = false
}

# 2. Private endpoint for each instance
module "nonprod_in_devtest_acr_private_endpoint_per_hub" {
  for_each = azurerm_redis_cache.redis
  source   = "git@ssh.dev.azure.com:v3/invoicecloud/Platform/terraform-azurerm-private-endpoint//?ref=platform-0/0.0.1"
  providers = { azurerm = azurerm.hub }

  target_resource_name      = each.key
  target_resource_id        = each.value.id
  target_subresource_names  = ["redisCache"]

  host_resource_group_name  = data.azurerm_virtual_network.hub.resource_group_name
  host_subnet_id            = data.azurerm_subnet.subnet_id.id
  host_private_dns_zone_ids = [ data.azurerm_private_dns_zone.redis.id ]

  tags = merge(var.tags, { "transition-global-infra-nonprod-to-devtest" = "true" })
}
Key Inputs & Outputs
Name
Type
Description
var.redis_instances
map(object({ sku_name=string, family=string, capacity=number }))
Defines each Redis instance
module.resource_group.resource_group.name
string
Resource Group
module.resource_group.resource_group.location
string
Azure region
data.azurerm_virtual_network.hub.resource_group_name
string
Hub VNet RG name
data.azurerm_subnet.subnet_id.id
string
Hub Redis subnet ID
data.azurerm_private_dns_zone.redis.id
string
Hub private DNS zone ID for Redis
var.tags
map(string)
Tag map
Output
Description
azurerm_redis_cache.redis[<key>].id
ID of each Redis instance
azurerm_redis_cache.redis[<key>].host_name
Host name for each Redis instance
azurerm_redis_cache.redis[<key>].port
Port (default 
6379
)
azurerm_redis_cache.redis[<key>].primary_access_key
Primary access key
module.nonprod_in_devtest_acr_private_endpoint_per_hub[<key>].id
Private endpoint IDs for each instance
module.nonprod_in_devtest_acr_private_endpoint_per_hub[<key>].private_ip_address
Private endpoint IP addresses
Security and Access Controls
TLS 1.2+
 enforced.  
Public network access disabled 
- all traffic via private endpoint.  
Private DNS zone
 linked into spoke VNet for name resolution; no external DNS exposure.
Operations and Runbook
Verify in Azure Portal under “Azure Cache for Redis”.  
To scale: update 
var.redis_instances[<key>].capacity
 and re-apply.
note
Troubleshoot:  
OperationNotAllowed
 → ensure subnet has service endpoint/delegation for Redis.  
DNS resolution failure
 → confirm private DNS zone link status.


Troubleshoot:  
OperationNotAllowed
 → ensure subnet has service endpoint/delegation for Redis.  
DNS resolution failure
 → confirm private DNS zone link status.


Links and References
Azure Redis docs.
Confluence labels: 
infra
 
cache
 
redis
 
terraform
 
Pipeline: 
 URL:/spaces/platform/pages/4264788003/Cache+Azure+Redis
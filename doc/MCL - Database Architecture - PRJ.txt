Database Table Relationships
Overview
The database schema implements a multi-tenant billing system (stored in a per biller database topology) with a hierarchical permission structure. The tables are organized to manage billers, customers, user logins, and their associated permissions.
Core Table Relationships
1. 
dbo.Billers
 (Master Table)
Primary Key
: 
BillerID
Purpose
: Represents billing companies/organizations
Key Fields
:
BillerID
 - Unique identifier
BillerGUID
 - Global unique identifier
BillerDBA
 - Business name
Active
 - Status flag
DemoAccount
 - Demo account indicator
2. 
mcl.Customers
 (Customer Management)
Primary Key
: 
CustomerID
Foreign Key
: 
BillerID
 → 
dbo.Billers.BillerID
Purpose
: Stores customer information for each biller
Key Fields
:
CustomerID
 - Unique customer identifier
BillerID
 - Links to biller
CustomerGUID
 - Global unique identifier
AccountNumber
 - Customer account number
CustomerName
 - Customer name
Active
 - Status flag
3. 
mcl.Logins
 (User Authentication)
Primary Key
: 
LoginID
Purpose
: Stores user login credentials and authentication data
Key Fields
:
LoginID
 - Unique login identifier
LoginGUID
 - Global unique identifier
EmailAddress
 - User email (unique)
CurrentPassword
 - Encrypted password
UserName
 - Username
Pin
 - PIN for additional authentication
4. 
mcl.LoginTypes
 (Role Definitions)
Primary Key
: 
LoginTypeID
Purpose
: Defines different types of user roles
Key Fields
:
LoginTypeID
 - Unique type identifier
LoginType
 - Role name (e.g., "Account Owner", "Authorized User")
LoginTypeDefinition
 - Description of the role
5. 
mcl.CustomerLogins
 (Customer-User Association)
Primary Key
: 
CustomerLoginID
Foreign Keys
:
CustomerID
 → 
mcl.Customers.CustomerID
LoginID
 → 
mcl.Logins.LoginID
LoginTypeID
 → 
mcl.LoginTypes.LoginTypeID
Purpose
: Links customers to users with specific roles
Key Constraints
:
Unique constraint on 
(CustomerID, LoginID)
Unique constraint on 
(CustomerID, LoginTypeID)
 where 
LoginTypeID = 1
 (Account Owner)
6. 
mcl.Permissions
 (Permission Definitions)
Primary Key
: 
PermissionID
Purpose
: Defines available system permissions
Key Fields
:
PermissionID
 - Unique permission identifier
PermissionDesc
 - Permission description
Active
 - Status flag
7. 
mcl.LoginTypePermissions
 (Role-Based Permissions)
Primary Key
: 
LoginPermissionTypeID
Foreign Keys
:
LoginTypeID
 → 
mcl.LoginTypes.LoginTypeID
PermissionID
 → 
mcl.Permissions.PermissionID
Purpose
: Defines which permissions are available to each login type
Constraint
: Unique constraint on 
(LoginTypeID, PermissionID)
8. 
mcl.CustomerLoginPermissions
 (User-Specific Permissions)
Primary Key
: 
CustomerLoginPermissionID
Foreign Keys
:
CustomerLoginID
 → 
mcl.CustomerLogins.CustomerLoginID
PermissionID
 → 
mcl.Permissions.PermissionID
Purpose
: Stores individual user permissions (can override role-based permissions)
Constraint
: Unique constraint on 
(CustomerLoginID, PermissionID)
Relationship Flow
2
1
0
0
4622582132
4623663184
1
Untitled Diagram-1756834643850.drawio
1
1
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1756834643850.drawio
0
701
368
Key Business Rules
One Account Owner Per Customer
: Each customer can have only one "Account Owner" (LoginTypeID = 1)
Permission Inheritance
: When a customer login is created, it automatically inherits permissions from the associated LoginType via LoginTypePermissions
Permission Override
: Individual CustomerLoginPermissions can override or add to the inherited permissions
Multi-Tenant
: Each customer belongs to a specific biller, creating data isolation
User Reuse
: A single login (user) can be associated with multiple customers, enabling linked accounts
Entity Relationship Descriptions
2
1
0
0
4622975242
4623663184
1
Untitled Diagram-1756834685342.drawio
1
1
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1756834685342.drawio
0
1517
4285
Core Entity Relationships
1. 
dbo.Billers ↔ mcl.Customers
 (One-to-Many)
Relationship
: A biller can have multiple customers, but each customer belongs to exactly one biller
Business Logic
: This creates the multi-tenant structure where each biller's data is isolated
Key Field
: 
mcl.Customers.BillerID
 references 
dbo.Billers.BillerID
2. 
mcl.Customers ↔ mcl.CustomerLogins
 (One-to-Many)
Relationship
: A customer can have multiple login associations, but each customer login record belongs to exactly one customer
Business Logic
: This allows customers to have multiple users with different roles
Key Field
: 
mcl.CustomerLogins.CustomerID
 references 
mcl.Customers.CustomerID
3. 
mcl.Logins ↔ mcl.CustomerLogins
 (One-to-Many)
Relationship
: A login (user) can be associated with multiple customers, but each customer login record references exactly one login
Business Logic
: This enables "linked accounts" where a single user can access multiple customer accounts
Key Field
: 
mcl.CustomerLogins.LoginID
 references 
mcl.Logins.LoginID
4. 
mcl.LoginTypes ↔ mcl.CustomerLogins
 (One-to-Many)
Relationship
: A login type can be used by multiple customer logins, but each customer login has exactly one login type
Business Logic
: This defines the role hierarchy (Account Owner, Authorized User, etc.)
Key Field
: 
mcl.CustomerLogins.LoginTypeID
 references 
mcl.LoginTypes.LoginTypeID
5. 
mcl.CustomerLogins ↔ mcl.CustomerLoginPermissions
 (One-to-Many)
Relationship
: A customer login can have multiple specific permissions, but each permission record belongs to exactly one customer login
Business Logic
: This allows for granular, user-specific permission overrides
Key Field
: 
mcl.CustomerLoginPermissions.CustomerLoginID
 references 
mcl.CustomerLogins.CustomerLoginID
6. 
mcl.Permissions ↔ mcl.CustomerLoginPermissions
 (One-to-Many)
Relationship
: A permission can be granted to multiple customer logins, but each customer login permission record references exactly one permission
Business Logic
: This creates the permission catalog that can be assigned to users
Key Field
: 
mcl.CustomerLoginPermissions.PermissionID
 references 
mcl.Permissions.PermissionID
7. 
mcl.LoginTypes ↔ mcl.LoginTypePermissions
 (One-to-Many)
Relationship
: A login type can have multiple default permissions, but each login type permission record belongs to exactly one login type
Business Logic
: This defines the default permission set for each role type
Key Field
: 
mcl.LoginTypePermissions.LoginTypeID
 references 
mcl.LoginTypes.LoginTypeID
8. 
mcl.Permissions ↔ mcl.LoginTypePermissions
 (One-to-Many)
Relationship
: A permission can be available to multiple login types, but each login type permission record references exactly one permission
Business Logic
: This creates the role-based permission matrix
Key Field
: 
mcl.LoginTypePermissions.PermissionID
 references 
mcl.Permissions.PermissionID
Complex Relationships
Many-to-Many Relationships
Logins ↔ Customers
 (Many-to-Many via CustomerLogins)
A user can access multiple customer accounts
A customer can have multiple users
Junction table: 
mcl.CustomerLogins
LoginTypes ↔ Permissions
 (Many-to-Many via LoginTypePermissions)
A role can have multiple permissions
A permission can be available to multiple roles
Junction table: 
mcl.LoginTypePermissions
CustomerLogins ↔ Permissions
 (Many-to-Many via CustomerLoginPermissions)
A user-customer association can have multiple specific permissions
A permission can be granted to multiple user-customer associations
Junction table: 
mcl.CustomerLoginPermissions
Business Rules Embedded in Relationships
Uniqueness Constraints
(CustomerID, LoginID)
 - A user can only be associated with a customer once
(CustomerID, LoginTypeID)
 where 
LoginTypeID = 1
 - Only one Account Owner per customer
(LoginTypeID, PermissionID)
 - No duplicate permissions per role
(CustomerLoginID, PermissionID)
 - No duplicate permissions per user-customer association
Permission Inheritance Flow
Role-Based
: 
LoginTypes
 → 
LoginTypePermissions
 → 
Permissions
User-Specific
: 
CustomerLogins
 → 
CustomerLoginPermissions
 → 
Permissions
Override Capability
: User-specific permissions can override role-based permissions
Data Isolation
All customer data is isolated by 
BillerID
Users can only access customers within their biller's scope
Permission checks ensure proper access control
Cardinality Summary
Entity A
Relationship
Entity B
Cardinality
Billers
has
Customers
1:N
Customers
has
CustomerLogins
1:N
Logins
associated with
CustomerLogins
1:N
LoginTypes
defines
CustomerLogins
1:N
CustomerLogins
has
CustomerLoginPermissions
1:N
Permissions
granted to
CustomerLoginPermissions
1:N
LoginTypes
has
LoginTypePermissions
1:N
Permissions
available to
LoginTypePermissions
1:N
 
Organization with Linked Accounts
  
2
1
0
0
4623302786
4623663184
1
Untitled Diagram-1756834797974.drawio
2
2
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1756834797974.drawio
0
1734
638
This diagram shows:
One Biller
 (ABC Company) with BillerID: 1
Two Customers
:
John Smith (CustomerID: 101, Account: 12345)
Jane Doe (CustomerID: 102, Account: 67890)
Four Logins
:
john.smith@email.com
 (Account Owner for John Smith)
jane.doe@email.com
 (Account Owner for Jane Doe)
shared.user@email.com
 (Guest for BOTH customers)
guest@email.com
 (Guest for John Smith only)
Five CustomerLogin Associations
:
CL1: John Smith's account owner login
CL2: Jane Doe's account owner login
CL3: Shared user access to John Smith's account
CL4: Shared user access to Jane Doe's account (same login as CL3)
CL5: Guest user access to John Smith's account
The key feature is that 
shared.user@email.com
 (LoginID: 1003) is associated with both customers through separate CustomerLogin records (CL3 and CL4), demonstrating the "linked accounts" functionality where one user can access multiple customer accounts.
 
 
Stored Procedures
mcl.AutopayRemovalofAccess
mcl.delCustomerBanks
mcl.delCustomerBanksAll
mcl.delCustomerCreditCards
mcl.delCustomerCreditCardsAll
mcl.delCustomerLogin
mcl.delInvalidLoginAttempts
mcl.delLogin
mcl.delLoginInviteCustomer
mcl.delTempLogin
mcl.ImportLoginFile
mcl.insChandlerCustomerAndInvoice
mcl.insCustomerAutoPay
mcl.insCustomerAutoPayV2
mcl.insCustomerBanks
mcl.insCustomerCreditCards
mcl.insCustomerLogin
mcl.insCustomerLoginAttempts
mcl.insCustomerRecurringScheduledPayments
mcl.insCustomerRegConfig
mcl.insFiles_Login
mcl.insLoginBanks
mcl.insLoginCreditCards
mcl.insLoginInvite
mcl.insLoginInviteCustomer
mcl.insLoginUserActivity
mcl.insPendingAutoPayRegistrations
mcl.insPendingPaperlessRegistrations
mcl.insRemoteAuthentication
mcl.insScheduledPayments
mcl.ivantest
mcl.ivantest2
mcl.keltondelete
mcl.lstAuthenticationType
mcl.MarionCountyCustomerLocator
mcl.MPW_selCustomerInvoiceSearchBP
mcl.resetCustomerDefaultPaymentOption
mcl.rptActiveAccounts
mcl.rptCustomerListByEmailAddress
mcl.rptDailyPaymentsCollectedDetail
mcl.rptInactiveAccounts
mcl.rptPaperlessWithAddressV2
mcl.rptStratusMiscReportEmailAddress
mcl.selAutoPayCustomerV2
mcl.selAutoPayProcessingListHighVolume
mcl.selAutoPayProcessingListV2
mcl.selAutoPayProcessingListV2ForMultiInvoiceDetail
mcl.selAutoPayProcessingListV3
mcl.selAutoPayProcessingListV3ForMultiInvoiceDetail
mcl.selAutoPayProcessingListV4ForMultiInvoiceDetail
mcl.selBillerCustomerSearch
mcl.selBillerCustomerSearchBP
mcl.selBillerEmailBouncedDetail
mcl.selBillerEmailNotSentDetail
mcl.selBillerPaperlessChangeLogsBoyceSystems
mcl.selBoyceEBilling
mcl.selChandlerCustom3
mcl.selChandlerCustomerData
mcl.selChangeLogsSoftwareSolutions
mcl.selChangeLogsSoftwareSolutions2
mcl.selChangeLogsSoftwareSolutionsAutoPay
mcl.selChangeLogsSoftwareSolutionsPaperless
mcl.selCloudInvoicesToEmail
mcl.selConveyedAccounts
mcl.selCustomerAutoPay
mcl.selCustomerAutoPayByPaymentMethodGUID
mcl.selCustomerBanks
mcl.selCustomerBanks_ISF
mcl.selCustomerBiller
mcl.selCustomerBlockList
mcl.selCustomerCreditCards
mcl.selCustomerGroupAutoPayWithNoPaymentMethod
mcl.selCustomerGroupInvoiceLedger
mcl.selCustomerGroupPaymentHistory
mcl.selCustomerGroupRSPWithMissingPaymentMethods
mcl.selCustomerGroupSPWithMissingPaymentMethods
mcl.selCustomerInvoiceSearch
mcl.selCustomerInvoiceSearch3
mcl.selCustomerInvoiceSearchBP
mcl.selCustomerInvoiceSearchBP_V2
mcl.selCustomerInvoiceSearchBPTest
mcl.selCustomerLinkedAccountMembers
mcl.selCustomerLinkedAccountMembers_Test
mcl.selCustomerLinkedAccountMembersDebug
mcl.selCustomerLinkedAccountMembersTest
mcl.selCustomerLogin
mcl.selCustomerLogin_BP
mcl.selCustomerLoginAttempts
mcl.selCustomerLoginHealthCheck
mcl.selCustomerLoginPaymentMethods
mcl.selCustomerLoginPermissions
mcl.selCustomerPaymentOptionCount
mcl.selCustomerPortalAtAGlance
mcl.selCustomerPortalAutoPayReport
mcl.selCustomerPortalGroupPendingRecurringScheduledPayments
mcl.selCustomerPortalGroupPendingScheduledPayments
mcl.selCustomerPortalPendingScheduledPayments2
mcl.selCustomerRegConfig
mcl.selCustomers
mcl.selCustomersAbsolute
mcl.selCustomersForRemoteAuth
mcl.selCustomersForRemoteAuth_v2
mcl.selcustomersForRemoteRegAuth
mcl.selCustomersSemcoBlocked
mcl.selCustomersWithPartialMatch
mcl.selDataForCreditCardExpirationNotification
mcl.selFiles_Login
mcl.selFlexPayPendingPayments
mcl.selInvoicesToEmail
mcl.selInvoicesToEmail_CustomerGroups
mcl.selInvoicesToEmail_CustomerGroups_QA
mcl.selInvoicesToEmail_CustomerGroupsTest
mcl.selInvoicesToEmail_DetermineBacklog
mcl.selInvoicesToEmail_QA
mcl.selInvoicesToEmailByDate
mcl.selInvoicesToEmailMultiInvoice
mcl.selInvoicesToEmailMultiInvoice_CustomerGroups
mcl.selInvoicesToEmailMultiInvoice_CustomerGroups_QA
mcl.selInvoicesToEmailMultiInvoice_CustomerGroupsTest2
mcl.selInvoicesToEmailMultiInvoice_QA
mcl.selInvoicesToEmailMultiInvoicePDF
mcl.selInvoicesToEmailMultiInvoicePDF_CustomerGroups
mcl.selInvoicesToEmailMultiInvoicePDF_CustomerGroups_QA
mcl.selInvoicesToEmailMultiInvoicePDF_CustomerGroupsTest
mcl.selInvoicesToEmailMultiInvoicePDF_QA
mcl.selInvoicesToEmailMultiInvoicePDFTest2
mcl.selInvoicesToEmailMultiInvoiceTest
mcl.selInvoicesToEmailPDF
mcl.selInvoicesToEmailPDF_CustomerGroups
mcl.selInvoicesToEmailPDF_CustomerGroups_QA
mcl.selInvoicesToEmailPDF_CustomerGroupsTest
mcl.selInvoicesToEmailPDF_QA
mcl.selInvoicesToEmailPDFTest
mcl.selInvoicesToEmailTest
mcl.selLinkingCustMatch
mcl.selLoginBanks
mcl.selLoginCreditCards
mcl.selLoginCustomers
mcl.selLoginDefaultPayMethod
mcl.selLoginInvite
mcl.selLoginInviteCustomers
mcl.selLoginLinkedCustomerMembers
mcl.selLogins
mcl.selLoginsByLoginID
mcl.selLoginUserActivity
mcl.SelPaymentMethodHistoryByLoginId
mcl.selPendingAutoPayRegistrations
mcl.selPendingLoginInvites
mcl.selPendingPaperlessRegistrations
mcl.selPendingScheduledPaymentProcessingList
mcl.selPendingScheduledPaymentProcessingListForMultiInvoiceDetail
mcl.selRemoteAuthenticationByLoginID
mcl.selScheduledPayments
mcl.selScheduledPaymentsByPaymentMethodGUID
mcl.selScheduledPaymentsForRecalculation
mcl.spAllocateBouncedEmailAddress
mcl.spCheckBillerAuthenticationChange
mcl.spCheckLoginAuthValue
mcl.spConveyCustomerAccount
mcl.spCopyDefaultPaymentMethodForLoginID
mcl.spCopyDefaultPaymentMethodForLoginIDV2
mcl.spCreateLogin
mcl.spCreateRecurringScheduledPayments
mcl.spCustomerBanksByAccountNumber
mcl.spCustomerCreditCardsByAccountNumber
mcl.spCustomerGroupAutoPayWithNoPaymentMethodCount
mcl.spCustomerGroupInvoiceTypesWithoutAutoPay
mcl.spCustomerLogin
mcl.spCustomersWithExpiringCards
mcl.spCustomersWithExpiringCardsBillerPortal
mcl.spLocateSimilarCustomerBills
mcl.spMotorVehicleLinkingSearch
mcl.spMotorVehicleLinkingSearchV2
mcl.spPayInfoCheck
mcl.spPendingAutoPayRegistrationResends
mcl.spPendingPaperlessRegistrationResends
mcl.spProcessSmtpComplaint
mcl.spRemoveCustomerActiveServices
mcl.spTulareLinkingRegisteredCustomers
mcl.spTulareMigratePriorYearData
mcl.spUnConveyAccount
mcl.UnConveyAccounts
mcl.UnConveyAccounts_V2
mcl.updCustomerAutoPay
mcl.updCustomerAutoPayV2
mcl.updCustomerBanks
mcl.updCustomerCreditCards
mcl.updCustomerLogins
mcl.updCustomerRecurringScheduledPayments
mcl.updCustomerRegConfig
mcl.updLogin
mcl.updLoginBanks
mcl.updLoginCreditCards
mcl.updLoginInvite
mcl.updLoginUserActivity
mcl.updPendingAutoPayRegistrations
mcl.updPendingPaperlessRegistrations
mcl.updScheduledPayments
mcl.WS_selCustomerAutoPay
 URL:/spaces/EA/pages/4623663184/MCL+-+Database+Architecture+-+PRJ
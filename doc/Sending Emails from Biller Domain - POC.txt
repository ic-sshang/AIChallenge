Objective
This objective of this spike it to test the technical feasibility to use Mailgun APIs to send email from biller’s domain. This includes the research on various Mailgun services and understand the possible architecture to implement this feature with the capability to define and configure the domain details for billers. Following are the functionality needs to test in the POC.
 
Can validate DNS status via Mailgun API
Can pull the default smtp credential via Mailgun API after domain creation
Can send email through that Biller Domains after set up
FROM
 in received email looks accurately sent from that domain
At min, it should not have the on-behalf-of string in the from
Marked email as spam event is delivered back to Mailgun and specifically the Biller Domain
Marked email as do not email / block is delivered back to Mailgun and specifically the Biller Domain
Bounced emails list back to Mailgun and specifically the Biller Domain
Create an API key for a domain and get a list of API keys for a domain via the Mailgun API.
 
POC Repo Link:
MailgunSendMailFromBillerDomainPOC - Repos
Prerequisites to Send the email from Biller Domain
: 
Add the Domain in MailGun
Set up the DNS in Mailgun
Create SMTP Username and Password (If Using SMTP to Send Email)
Generate an API Key for the Domain (If Using Mailgun’s API to send Email)
Sending Email using API Service
: 
Here's a step-by-step summary of Sending an email using the Mailgun API in POC:
Load Configuration
: It loads the configuration for Mailgun.
Retrieve Biller Details
: It fetches the biller domain details from the configuration based on the provided 
billerID
.
Check Biller Existence
: If no biller is found, it throws an 
ArgumentException
.
Retrieve Domain Details
: It fetches the domain details for the specified 
EmailType
.
Construct API URL
: It constructs the Mailgun API URL using the domain details.
Create HttpClient
: It creates an 
HttpClient
 instance using the Constructed API Url.
Set Authentication
: It sets the Basic Authentication header using the Mailgun API key.
Prepare Email Data
: It prepares the email data including the sender, recipient, subject, and body (both plain text and HTML).
Send Email Request
: It sends the email request to the Mailgun API.
10.
Log Response
: It logs the response from the API.
11.
Return Status
: It returns 
True
 if the email was sent successfully, otherwise 
False
.
12.
Exception Handling
: If an exception occurs, it logs the error and returns 
False
.
 
Sending Email using SMTP Service
:
Here's step-by-step summary of sending an email using SMTP in POC:
Load Configuration
: It starts by loading the configuration for MailGun.
Retrieve Biller Information
: It retrieves the SMTP settings for the specified 
billerID
 from the configuration.
Error Handling
: If no settings are found for the given 
billerID
, it throws an exception.
Setup SMTP Client
: It initializes an 
SmtpClient
 with the server "
smtp.mailgun.org
" and sets the credentials and port using the retrieved domain details.
Compose Email
: It creates a 
MailMessage
 object, setting the sender's address, recipient's address, subject, and body of the email. The body is marked as HTML.
Send Email
: It sends the email using the 
smtp.Send(mail)
 method.
Logging and Return
: It logs a success message if the email is sent successfully and returns 
True
. If an exception occurs, it logs the error message and returns 
False
.
 
Testing Services of a Domain
Below are the methods used to test the different Mailgun Events.
GetDNSRequirements(domainName As String) As String
: Retrieves DNS requirements for a specified domain.
ValidateDNS(domainName As String) As Boolean
: Validates the DNS records for a specified domain by checking if Mailgun marks it as active.
GetSMTPDetails(domainName As String) As String
: Retrieves SMTP credentials for a specified domain.
GetSpamComplaints(domainName As String) As String
: Retrieves spam complaints for a specified domain.
GetUnsubscribes(domainName As String) As String
: Retrieves unsubscribe information for a specified domain.
 
GetBounces(domainName As String) As String:
 Retrieves bounced emails information for a specified domain.
Creating API key for domains using  API service:
Below are the methods used to test the different Mailgun Events.
CreateDomainAPIKey(domainName As String) As String
: It creates a new API key for a specified domain.
GetDomainAPIKeys(domainName As String) As String
: Retrieves all API keys for the specified domain.
POC result: 
Below screenshot can be verified to conclude the POC implementation. 
 
Through SMTP Service of POC
Through API Service of POC
 
Geting all API keys of domain
Creating API keys for domain
 URL:/spaces/PE/pages/4077355052/Sending+Emails+from+Biller+Domain+-+POC
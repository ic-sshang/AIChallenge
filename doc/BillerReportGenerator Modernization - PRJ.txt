Proposal
2
1
0
0
4168876059
3956342829
1
Untitled Diagram-1743196887839.drawio
7
7
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1743196887839.drawio
0
1277
661
Phase 1
A new event driven k8s job will be deployed alongside the exiting Biller Report Generator that runs on Skybot.  Both jobs will generate reports independently, the new job will not email reports just yet.   A comparison of reports generated by both jobs will be used to validate accuracy and consistency.   Use a feature flag in the source applications (Biller Portal and Biller Report Scheduler) to rollout a subset of billers to control the publishing of the events.  
ARC-2
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System Jira
 
Create a new dotnet 8 console job
Copy legacy BIllerReportGenerator code repository to Biller domain ADO project 
https://dev.azure.com/invoicecloud/Biller/_git/BillerReportGeneratorJob
Update data access to use new database library ( IC.Net.DataAccess.MsSql )
Update job to get DB connection string from environment variable
Use Workload Identity to access Azure SQL
Query the Biller shard table using a prepared statement, query Report Generator Queue table by the Report Generator Queue identifier (PKID) and Biller ID sent in the event payload
Extract email code from legacy email library to local code (temporary until new library is created)
Update job to get email settings from environment variables (currently in KV appsettingsdevtest etc… )
 Inject values using k8s Azure Key Vault driver from new environment level KV
Add a new setting to toggle emailing 
Update Zip code to use native dotnet 8 Zip SDK
Extract Azure blob storage code to local code (temporary until new library is created)
Update job to get blob settings from environment variables
Use a new blob storage account to store the report data (for side by side support)
Update email blob download links to restrict reading blobs via SaS tokens
Update code to use Workload Identity to access blob storage
Remove multi-shard query for polling DB for Report Generator Queue records
Remove creating hard coded biller reports
Hard coded reports will be supported by legacy job via the existing one off Skybot schedules (temporary until future phase) 
Remove Slack integration for error alerting
Add Azure Service Bus topic, subscription, and queue for Biller Report Enqueued event
Read Azure Service Bus connection string from environment variables
Read Topic, Subscription, and Quque identifiers from environment variables 
Access Azure Service Bus via workload identity
Add the proper logging and monitoring to track the reports generated to provide the details needed to compare the reports generated with the legacy job
Meet with the BMS team to review the code and the new error handling (retries, dead letter, etc…) to meet SLO.
Phase 2
Limited rollout to a subset of Billers
Update the legacy Biller Report Generator job to use the feature flag to 
EXCLUDE
 the subset of Billers for report generation.
Enable the new job to send emails.
Inform customer service of the Billers in the transition period and to report any anomalies.
Monitor system performance under increased load to ensure new job handles the scale without degradation.
Phase 3
Gradual scaling by increasing the the number of Billers in the subset
Inform customer service of additional Billers and to report any anomalies.
Monitor system performance under increased load to ensure new job handles the scale without degradation.
Phase 4
All Billers are are now rolled out.  
Disable legacy job in Skybot (leave one off schedules for hard coded biller reports schedules running).  
Monitor for a set period to ensure successful operation.
Phase 5
Remove feature flags and add support for FTP delivery
Remove feature flags from Biller Portal and Biller Report Scheduler
Add support for delivery method (Email or FTP) and format in Biller Report Schedule table
Add support for delivery method (Email or FTP) and format in Report Generator Queue table
Add FTP support delivery in new job (do not actually FTP at this time), add a setting to toggle FTP
Create scheduled reports for the hard coded Biller reports
Compare the reports generated
Phase 6
Disable Skybot one off jobs for hard coded Biller reports
Enable FTP delivery in the new job
Monitor for a set period to ensure successful operation.
Phase 7
Complete transition
Remove Skyjob jobs and code from servers
Disable deployment pipelines for Biller Report Generator
Archive Biller Report Generator code
Create new libraries for any platform code (Azure Blob and Email)
Refactor new Biller Report Generator job to use new libraries
legacy
2
1
0
0
4169039973
3956342829
1
Untitled Diagram-1743199185460.drawio
3
3
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1743199185460.drawio
0
861
658
Main Activity
2
0
1
0
3956342829
3957817363
Untitled Diagram-1738239404330.drawio
1
2
2
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1738239404330.drawio
0
1213
1557
 URL:/spaces/EA/pages/3956342829/BillerReportGenerator+Modernization+-+PRJ
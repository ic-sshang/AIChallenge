Deploy Panorama Terraform
Panorama Terraform Infrastructure
Note:
 
If deploying High Availability, ensure both primary region and secondary region Panorama are deployed
Connect to Panorama Endpoint utilizing the Private or Public IP Address assigned during creation.
License Panorama
Click PANORAMA > Setup > Management > General Settings > Edit > 
Paste Serial Number
 > Click OK
Wait 10 Seconds, Refresh the page
Click “OK” on the following link “Retrieve Panorama License” Pop-Up Window
Verify Serial Number applied correctly
PANORAMA > Setup > Management > Genreal Settings
Panorama Commit
Commit > Commit to Panorama > Commit
Download and Install Content
PANORAMA > Dynamic Updates
Click “Check Now” at the bottom of the screen
Click “Download” and click “Install”
Repeat the previous steps in order for the secondary Panorama
Restore Running Configuration
Click Panorama > Setup > Operations > “import named Panorama configuration snapshot”
Click “browse” on “Import Named Configuration” pop-up window
Select the xml configuration file and click “OK”
Click Panorama > Setup > Operations > “Load named Panorama configuration snapshot”
Click the dropdown for the name and select the xml configuration loaded in the previous step
Repeat the previous steps for the secondary Panorama
Commit > Commit to Panorama
HA Key Setup
Click PANORAMA > Certificate Management > Certificates
Export HA Key (Bottom of the screen)
Repeat the previous steps for the Secondary Panorama
Import HA Key
On the Primary Panorama Panorama > Certificate Management > Certificates > Import HA Key (Bottom of the screen)
Import the Secondary Panorama Key
Repeat the steps on Secondary Panorama, import the primary Panorama key instead
Verify HA Setup
Navigate to Primary Panorama
Click Dashboard > Widgets > System > High Availability
 
Wait for all status to go green but Running Config
Click “Sync to peer”
Click “yes” to “Overwrite Peer Configuration” pop-up window, wait for sync to complete
Add Logging disk to Panorama
Login to Primary Panorama CLI using SSH
Enter the following command to view the disks on the Panorama Virtual Appliance
show system disk details
Enter the following command to confirm the request when prompted for disks
request system disk add sdd
Enter the following command to verify the status for the disk addition
show system disk details
On the primary Panorama (active), use the following command to set the Panorama-server, which should be the IP address of the secondary panorama
configure 
set deviceconfig system panorama-server {ip_of_secondary_panorama}
commit the changes
commit
Login to Secondary Panorama CLI using SSH
On the secondary Panorama, use the following command to set the Panorama-server, which should be the Ip address of the primary panorama
configure 
set deviceconfig system panorama-server {ip_of_primary_panorama}
Commit the change
commit
Add Log Collector
Login to Primary Panorama
Dashboard > Copy Serial Number
Login to Secondary Panorama
Dashboard > Copy Serial Number
Primary Panorama
Panorama > Managed Collectors 
Click “Add”
Enter the Primary Panorama Serial Number copied earlier 
Commit to Panorama
Click into Collector > Disks > Add
Add Disks (A && B) 
Commit to Panorama
Secondary Panorama
Panorama > Managed Collectors 
Click “Add”
Enter the Secondary Panorama Serial Number copied earlier 
Enter the IP address of the primary and secondary Panorama HA peers in the Panorama Server IP
field and Panorama Server IP 2 field respectively.
Click “OK”
Commit > Commit to Panorama
Note: If Secondary log collector does not sync to primary, reboot secondary Panorama
Click into Collector > Disks > Add
Add Disks (A && B) 
Commit to Panorama
Primary Panorama
Panorama > Collector Groups > Add
Add one or both (if High Availability) Log Collectors as Collector Group Members
Enable Log redundancy across collectors
Note:  If multiple Log Collectors are added to a single Collector group. This option requires each Log Collector to have the same number of virtual logging disks.
Select Device Log Forwarding
 Configure the Log Forwarding Preferences list. This list defines which firewalls forward logs to which Log Collectors. Assign firewalls according to the number of Log Collectors in this Collector Group:
o   
Single
Assign the firewalls that will forward logs to the Log Collector that is local to the primary Panorama, as illustrated in 
Single Log Collector Per Collector Group
.
o   
Multiple
Assign each firewall to both Log Collectors for redundancy. When you configure the preference list, make Log Collector 1 the first priority for half the firewalls and make Log Collector 2 the first priority for the other half, as illustrated in 
Multiple Log Collectors Per Collector Group
.
Click “OK” to save changes
Select Commit > Commit and Push
Primary Panorama
Panorama > High Availability
Click “Suspend local Panorama” located in the Operational Commands section
Secondary Panorama
Panorama > Managed Collectors
Select Log Collector that is local to secondary Panorama
Enter the IP Address of the primary and secondary Panorama vm’s in the “Panorama Server IP”
Click “OK”
Commit > Commit and Push
Primary Panorama
Panorama > High Availability
Make local Panorama functional for high availability 
Secondary Panorama
Panorama > High Availability
Suspend local Panorama in the operational commands section
Make local Panorama functional for high availability 
Primary Panorama
Dashbaord
Verify HA widget shows primary Panorama is primary-active
Generate VM-Auth-Key
https://{ip}/api
Opertional Commands > Request > bootstrap > vm-auth-key > genreate > lifetime
Note: Lifetime is in hours
Enter an iteger for the “hours” field
Click Submit
Copy Key
 URL:/spaces/icinfradoc/pages/2683175012/Deployment+Steps
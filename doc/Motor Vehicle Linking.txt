Summary Overview:
Previously a registered motor vehicle customer would be unable to locate his new invoice on his registered account, because the bill or account number changed.   The customer would think that his new invoice was not available, and this would generate calls to the biller.  The customer’s new invoice could be located on our site through a normal bill search.  The customer would have to register the new account and link it to his previously registered account, to pay with his saved payment information or perform a one-time pay.
Repo: 
MotorVehicleLinking
Team:
 The Integrators 
Logs: 
AutomateScheduler – STAGING- MotorVehicleLinking  - Job runs 7am CST
Job Description: 
Looks at all the MV invoices imported the previous day and attempts to find a match to an older MV invoice so that it can then link up the customer accounts.This then allows us to email the invoice to the payer.
ChangeRequestor:
 4 - Cloud Process
Observability:
 Not APM enabled, No New Relic Logs
Stored Procedures:
spMotorVehicleLinkingExtensionBillerList  –
  Gets the list of Billers to run the job for
What MotorVehicleLinkingExtensionID to use 
e.g. (MotorVehicleLinkingExtensionID 19 = (QDS – Custom11))
MCL.spMotorVehicleLinkingSearchV2 –
Searches for a previous customer record that has the same name and same information within the MotorVehicleLinkingExtension column to be able to link the new account to
spMotorVehicleLinkingExtensionData –
 Returns all of the motor vehicle invoices from the prior day we are going to try and link them to last year’s MV bills.
Autopay -
MCL.selCustomerAutoPay
MCL.insCustomerAutoPay
MCL.updCustomerAutoPay
Paperless -
selCustomerPaperless
insCustomerPaperless
updCustomerPaperless
Payment Methods –
selDefaultPaymentMethods_Multiple – We will not link accounts if there are multiple saved payment methods.
Rerunning MotorVehicleLinking Documentation - 
SRE-250
Steps to resolve:
Log in to Automate Scheduler.
Go to Job -> Individual Jobs
On Name column, add “STAGING-MotorVehicleLinking“ to filters
Right click the job and go to job history.
Download Job log file for failed run in Opsgenie alert (129701396)
Open the job log and look for phrases like “error”, “failed“, or “exception“.
On the error found, take a note of the Biller ID that encountered the exception
Looking for link for InvoiceNumber: 2024MV25109. BillerID:1131. CustomerID: 83547816. InvoiceID: 392963121.
Found link between 392963121 and 392864216. Additional Info: LoginID: 83401918. CustomerID:83515558
Registered Customer 83547816
Linked CustomerIDs 83547816 and 83515558
Problem in ProcessInvoice(): System.NullReferenceException: Object reference not set to an instance of an object.
   at MotorVehicleLinking.Business.UpdateAutopay(Int32 billerid, Int32 oldCustomerID, Int32 newCustomerId) in C:\agent\_work\182\s\MotorVehicleLinking\objects\Business.vb:line 183
   at MotorVehicleLinking.LinkInvoicesForBiller.ProcessInvoice(BillerCustomerLink CustomerLink) in C:\agent\_work\182\s\MotorVehicleLinking\LinkInvoicesForBiller.vb:line 245
-------------------
-------------------
Looking for link for InvoiceNumber: 2024MV6891. BillerID:1131. CustomerID: 83547810. InvoiceID: 392967377.
Found link between 392967377 and 392827304. Additional Info: LoginID: 78312206. CustomerID:83511429
Registered Customer 83547810
Linked CustomerIDs 83547810 and 83511429
Updated AutoPay CustomerIDs 83547810 and 83511429
Problem in ProcessInvoice(): System.NullReferenceException: Object reference not set to an instance of an object.
   at MotorVehicleLinking.Business.UpdatePaperless(Int32 billerid, Int32 oldCustomerID, Int32 newCustomerId) in C:\agent\_work\182\s\MotorVehicleLinking\objects\Business.vb:line 228
   at MotorVehicleLinking.LinkInvoicesForBiller.ProcessInvoice(BillerCustomerLink CustomerLink) in C:\agent\_work\182\s\MotorVehicleLinking\LinkInvoicesForBiller.vb:line 245
-------------------
[2024-02-22 06:55:43.710] - exec spMotorVehicleLinkingSearchV2 @BillerID=1131,@CustomerID=83547828,@CustomerName='RODRIGUES BENTO, MAIKE ANTONI',@CustomFieldName='Custom22',@CustomFieldValue='1FM5K8F89HGA34884'

Due to the job failure, MotorVehicleLinking may need to be rerun.
To rerun, Clone repo “MotorVehicleLinking“
Make sure the solution/sln file has been double clicked. Right click project MotorVehicleLinking and go to properties.
Go to the Debug tab. Add message: "-billerid=xxxx" and replace the Xs with the biller ID value with the failure/exception. Save
Place breakpoint on line “If Keys("billerid") IsNot Nothing Then”
Run and hover over Keys to check if BID inputted is found.
Continue and make sure run completes.
In this scenario the rerun was successful and the exception was not encountered again.
Useful Documentation - 
 URL:/spaces/DS/pages/2818375737/Motor+Vehicle+Linking
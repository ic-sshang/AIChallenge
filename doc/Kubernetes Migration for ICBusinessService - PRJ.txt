Impacted New Relic Entities Due to Azure VM to Kubernetes Migration
none
1.Overview
This document outlines the impact of migrating services from Azure Virtual Machines (VMs) to Kubernetes on existing New Relic dashboards and alerts. It identifies VM-specific dependencies, provides a checklist to ensure observability continuity post-migration, and offers actionable remediation steps.
Dashboards
BusinessServiceTransactions
{
  "search_term": "BusinessServiceTransactions",
  "dashboards": [
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw",
      "dashboard_name": "ICServices - Performance",
      "widget_title": "BusinessService By MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET MethodName",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw",
      "dashboard_name": "ICServices - Performance",
      "widget_title": "BusinessService By Machine",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw",
      "dashboard_name": "ICServices - Performance",
      "widget_title": "Load Balancing",
      "nrql": "SELECT count(timestamp) from BusinessServiceTransactions where Machine like '%TEMP%' LIMIT MAX FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw",
      "dashboard_name": "ICServices - Performance",
      "widget_title": "Average ResponseTimes by MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%TEMP%' and MethodName is not null Limit MAX TIMESERIES 1 minutes FACET MethodName  ",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjQwNzMw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg",
      "dashboard_name": "ICServices - Performance copy",
      "widget_title": "BusinessService By MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET MethodName",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg",
      "dashboard_name": "ICServices - Performance copy",
      "widget_title": "BusinessService By Machine",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg",
      "dashboard_name": "ICServices - Performance copy",
      "widget_title": "Load Balancing",
      "nrql": "SELECT count(timestamp) from BusinessServiceTransactions where Machine like '%TEMP%' LIMIT MAX FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg",
      "dashboard_name": "ICServices - Performance copy",
      "widget_title": "Average ResponseTimes by MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%TEMP%' and MethodName is not null Limit MAX TIMESERIES 1 minutes FACET MethodName  ",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjk0MDcxMg"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE",
      "dashboard_name": "SRE ICRTDR Services - Performance",
      "widget_title": "BusinessService By MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET MethodName",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE",
      "dashboard_name": "SRE ICRTDR Services - Performance",
      "widget_title": "BusinessService By Machine",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%PROXY%' Limit MAX TIMESERIES 1 minutes FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE",
      "dashboard_name": "SRE ICRTDR Services - Performance",
      "widget_title": "Load Balancing",
      "nrql": "SELECT count(timestamp) from BusinessServiceTransactions where Machine like '%TEMP%' LIMIT MAX FACET Machine",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE",
      "dashboard_name": "SRE ICRTDR Services - Performance",
      "widget_title": "Average ResponseTimes by MethodName",
      "nrql": "SELECT average(TotalProcessTime) from BusinessServiceTransactions Where Machine Like '%TEMP%' and MethodName is not null Limit MAX TIMESERIES 1 minutes FACET MethodName  ",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjMzNjY0NTE"
    }
  ]
}
ICBusinessService
{
  "search_term": "ICBusinessService",
  "dashboards": []
}
ICBusinessService(MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MTExNjMz)
{
  "search_term": "MTQ5OTcwNHxBUE18QVBQTElDQVRJT058OTg2MTExNjMz",
  "dashboards": []
}
ICPerformanceMetrics(Business Service Only)
{
  "search_term": "ICPerformanceMetrics",
  "dashboards": [
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw",
      "dashboard_name": "ICSERVICES - By Service (% Max Sessions)",
      "widget_title": "Business Service",
      "nrql": "select MAX(`Counter Value`) from ICPerformanceMetrics where  `Counter Name` = 'Percent Of Max Concurrent Sessions' and `Metric Alias` = 'BusinessService' facet HostName since 3 hours ago TIMESERIES  auto",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw",
      "dashboard_name": "ICSERVICES - By Service (% Max Sessions)",
      "widget_title": "MAX % Concurrent Sesions",
      "nrql": "select MAX(`Counter Value`) from ICPerformanceMetrics where  `Counter Name` =  'Percent Of Max Concurrent Sessions' and `Metric Alias` = 'BusinessService' facet HostName since 3 hours ago TIMESERIES  auto",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw",
      "dashboard_name": "ICSERVICES - By Service (% Max Sessions)",
      "widget_title": "MAX % Concurrent Calls",
      "nrql": "select MAX(`Counter Value`) from ICPerformanceMetrics where  `Counter Name` ='Percent Of Max Concurrent Calls' and `Metric Alias` = 'BusinessService' facet HostName since 3 hours ago TIMESERIES  auto",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw",
      "dashboard_name": "ICSERVICES - By Service (% Max Sessions)",
      "widget_title": "Outstanding Calls",
      "nrql": "select MAX(`Counter Value`) from ICPerformanceMetrics where  `Counter Name` ='Calls Outstanding' and `Metric Alias` = 'BusinessService' facet HostName since 3 hours ago TIMESERIES  auto",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw"
    },
    {
      "dashboard_guid": "MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw",
      "dashboard_name": "ICSERVICES - By Service (% Max Sessions)",
      "widget_title": "MAX % Concurrent Instances",
      "nrql": "select MAX(`Counter Value`) from ICPerformanceMetrics where  `Counter Name` = 'Percent Of Max Concurrent Instances' and `Metric Alias` = 'BusinessService' facet HostName since 3 hours ago TIMESERIES  auto",
      "permalink": "https://one.newrelic.com/redirect/entity/MTQ5OTcwNHxWSVp8REFTSEJPQVJEfGRhOjg4MjA4Mw"
    }
  ]
}
Alerts
BusinessServiceTransactions
{
  "search_term": "BusinessServiceTransactions",
  "alerts": [
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTEwNjQ",
      "alert_name": "IC-PROXYTEMP1 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP1'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTEwMzE",
      "alert_name": "IC-PROXYTEMP2 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP2'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTEwMjU",
      "alert_name": "IC-PROXYTEMP3 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP3'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTEwMTE",
      "alert_name": "IC-PROXYTEMP4 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP4'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA5OTI",
      "alert_name": "IC-PROXYTEMP5 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP5'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA5ODc",
      "alert_name": "IC-PROXYTEMP6 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP6'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA5NDk",
      "alert_name": "IC-PROXYTEMP7 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP7'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA5NDg",
      "alert_name": "IC-PROXYTEMP8 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP8'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA5NDQ",
      "alert_name": "IC-PROXYTEMP9 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP9'   facet Machine"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MTU5OTA4NzI",
      "alert_name": "IC-PROXYTEMP10 - BusinessService - NO TRANSACTIONS",
      "nrql": "SELECT count(*) from BusinessServiceTransactions  Where  Machine ='IC-PROXYTEMP10'   facet Machine"
    }
  ]
}
ICBusinessService
{
  "search_term": "ICBusinessService",
  "dashboards": []
}
ICPerformanceMetrics
{
  "search_term": "ICPerformanceMetrics",
  "alerts": [
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MzIzMjczMjE",
      "alert_name": "% Max Concurrent Sessions by Service, Proxy",
      "nrql": "SELECT Max(`Counter Value`) AS 'Max % Concurrent Sessions' FROM ICPerformanceMetrics WHERE `Counter Name` = 'Percent Of Max Concurrent Sessions' AND HostName LIKE 'IC-PROXYT%' AND `Counter Value` < 200 FACET `Metric Alias` AS 'Service Name', HostName WITH TIMEZONE 'America/Chicago'"
    },
    {
      "alert_guid": "MTQ5OTcwNHxBSU9QU3xDT05ESVRJT058MzIzMjYwOTE",
      "alert_name": "Max Concurrent Sessions - All Proxy Services",
      "nrql": "select Max(`Counter Value`) from ICPerformanceMetrics where `Counter Name` = 'Percent Of Max Concurrent Sessions' and `Counter Value` < 200 and HostName like 'IC-ProxyT%' facet HostName, `Metric Alias`"
    }
  ]
}
2. Impacted Dashboards
Dashboard Name
VM-Specific Filters
Kubernetes-Compatible?
Required Action
ICServices - Performance
Machine LIKE '%PROXY%'
, 
'%TEMP%'
No
Replace filters with pod/container-level metadata
ICServices - Performance copy
Same as above
No
Merge with original, update filters
SRE ICRTDR Services - Performance
Machine LIKE '%PROXY%'
, 
'%TEMP%'
No
Update all NRQLs to Kubernetes label equivalents
ICSERVICES - By Service (% Max Sessions)
HostName LIKE 'IC-PROXYT%'
No
Replace HostName with Kubernetes node/pod label
3. Impacted Alerts
Alert Name
NRQL Filter Type
Kubernetes-Compatible?
Required Action
IC-PROXYTEMP[1-10] - NO TRANSACTIONS
Machine = 'IC-PROXYTEMP*'
No
Replace with pod name label (
k8s.pod_name
, etc.)
% Max Concurrent Sessions by Service
HostName LIKE 'IC-PROXYT%'
No
Replace HostName with 
kubernetes.node_name
Max Concurrent Sessions - All Proxies
HostName LIKE 'IC-ProxyT%'
No
Use container or node labels for service identification
4. Observations
Hardcoded VM identifiers
 (e.g., 
Machine
, 
HostName
) are prevalent and must be replaced with Kubernetes-native labels.
Dashboard duplication
 exists (e.g., 
Performance
 and 
Performance copy
), suggesting a need for consolidation.
Metric continuity
 (e.g., 
ICPerformanceMetrics
) must be verified in Kubernetes, as exporters may expose different fields.
Timeseries granularity
 set to fixed 1-minute intervals may require tuning to balance data volume and accuracy in dynamic K8s environments.
5. Migration Checklist
NRQL Refactoring
Identify all queries using 
Machine
, 
HostName
, and similar.
Replace VM-based filters with Kubernetes metadata fields such as:
k8s.pod_name
k8s.container_name
kubernetes.namespace_name
kubernetes.node_name
Validate metric availability in New Relic from Kubernetes exporters.
Dashboard Updates
Consolidate duplicate dashboards into single views using dynamic filters (e.g., by namespace or team).
Ensure queries reflect current Kubernetes deployment topology.
Validate all dashboards post-migration using real-time Kubernetes data.
Alert Reconfiguration
Replace all alerts tied to VM-specific 
Machine
 or 
HostName
 values.
Confirm alert thresholds are still meaningful based on Kubernetes scaling behavior.
Ensure alert conditions are tested in a dev or staging Kubernetes environment.
Instrumentation Validation
Ensure APM agents are injected or deployed as sidecars in containers.
Confirm Kubernetes infrastructure monitoring (via DaemonSets or New Relic's K8s integration) is in place.
Ensure telemetry (logs, traces, metrics) flows from pods to New Relic.
6. To-Do and Future Enhancements
Task Description
Priority
Owner
Notes
Update all dashboard NRQLs to use K8s labels
High
Observability
Replace 
Machine
, 
HostName
 filters
Refactor alert conditions for dynamic containers
High
SRE Team
Replace VM host filters with pod/container name or tags
Add pod health metrics to dashboards
Medium
Platform Team
Include 
restarts
, 
ready
 status using 
k8s.pod_sample
Enable dashboard filtering by namespace/team
Medium
Observability
Use dashboard variables or filters for flexibility
Replace session-based metrics if unsupported
Medium
Infra Team
Validate availability of 
Percent Of Max Concurrent Sessions
Implement service-level tracing in Kubernetes
Low
DevOps
Useful for latency insights via distributed tracing
7. Sample NRQL Migration Examples
Alert NRQL – Before (VM-based):
SELECT count(*) FROM BusinessServiceTransactions WHERE Machine = 'IC-PROXYTEMP1' FACET Machine 
Alert NRQL – After (Kubernetes):
SELECT count(*) FROM BusinessServiceTransactions WHERE `k8s.pod_name` LIKE 'proxytemp1-%' FACET `k8s.pod_name` 
Dashboard NRQL – Before:
SELECT average(TotalProcessTime) FROM BusinessServiceTransactions WHERE Machine LIKE '%PROXY%' FACET MethodName 
Dashboard NRQL – After:
SELECT average(TotalProcessTime) FROM BusinessServiceTransactions WHERE `k8s.container_name` LIKE '%proxy%' FACET MethodName 
 URL:/spaces/EA/pages/4364206105/Kubernetes+Migration+for+ICBusinessService+-+PRJ
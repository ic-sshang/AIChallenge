Objective
Explore the technical feasibility of retrieving and displaying SMS replies from customers alongside outbound messages in the Pay by Text history and evaluate the ability to download and resend individual SMS messages from the Pay by Text interface.
 Part 1: Feasibility of Displaying SMS Replies in Pay by Text History
Findings
Storage Locations:
Inbound SMS:
 Stored via stored procedure 
[SMS].[insSmsVendorLog]
 into the 
SmsVendorLog
 table (in external DB 
DBMaster_GoldAzure
) synced to appropriate shards.
Outbound SMS:
 Stored in 
SMS.SmsOut
 via stored procedure 
[SMS].[insSmsOut]
.
Unified Retrieval:
 The stored procedure 
[SMS].[selPhonerNumberHistory]
 can fetch both inbound and outbound messages by phone number and date range.
Linking Replies:
No direct message ID linkage exists between inbound and outbound SMS.
Logical linking is possible through matching phone numbers and timestamp proximity (e.g., replies within a few minutes of outbound messages), enabling effective message threading.
UI/UX Implications:
Messages can be grouped into conversational threads by phone number and timestamps.
UI should clearly indicate message direction (inbound vs outbound) for contextual clarity.
Codebase Insights:
Inbound SMS handling code exists in 
PayController.vb
 but has been commented out since 2020 for unknown reasons.
After re-enabling and testing, the inbound SMS processing works via REST API (
POST pay/payerresponse/{BillerGuid}
), successfully inserting inbound messages and syncing shards.
The lack of explicit message ID linkage is a manageable limitation.
The inbound SMS should be sanitized in proper way to eliminate any risk or injection; refer to sanitization logic in 
CreditProcessor.vb
 .
Part 2: Feasibility of Downloading and Resending Individual SMS Messages
Findings
Download:
SMS text content is stored in 
SMS.SmsOut
 and is suitable for export/download functionality.
Resend Capability:
No existing resend functionality.
Resending can be implemented by reusing stored message content with the 
[SMS].[insSmsOut]
 procedure.
Compliance & Controls:
Resend functionality must comply with SMS provider rate limits.
Audit logging should be implemented for security and traceability.
Resending must respect opt-in/opt-out and privacy regulations.
Technical Summary
Aspect
Details
Outbound SMS Storage
SMS.SmsOut
 table, inserted via 
[SMS].[insSmsOut]
Inbound SMS Storage
Inserted via 
[SMS].[insSmsVendorLog]
 into 
SmsVendorLog
 (DBMaster_GoldAzure), synced shards
Unified Retrieval
[SMS].[selPhonerNumberHistory]
 by PhoneNumber, DateRange, SMSDirectionID
API Endpoint for outbound SMS
POST sms/pay/payerresponse/{BillerGuid}
Resend Feature Design Options
Option
Description
Pros
Cons
Modify Stored Procedure
Add parameters (
@IsResend
, 
@OriginalMessageID
) to 
[SMS].[insSmsOut]
 for resend tracking.
Avoids data duplication, clean audit
Requires DB schema/SP changes
Flag Resend Rows
Insert new rows with 
IsResend
 flag and link to original message ID.
Simple, keeps messages in one table
Duplicates content, complicates UI/reporting
API-only Resend Logic
Resend handled entirely in API with audit logging, no DB changes.
No DB changes, keeps DB clean
Less transparent in main table, requires robust logging
Recommendations & Risk Mitigation
Re-enable inbound SMS handling code with enhanced logging and monitoring to catch regressions.
Inform support teams of improved SMS visibility (inbound/outbound).
Update UI to thread messages by phone and time with clear inbound/outbound labeling.
Design secure resend functionality with confirmation prompts, audit logs, rate limiting, and compliance checks.
Implement download/export capability from the Pay By Text history interface.
Document historical context regarding the 2020 code disablement for operational awareness.
Quick QA Points
Code History:
Why was the inbound SMS code commented out in 2020? Were there security concerns (e.g., injection), stability issues, business rule changes, or deprecated dependencies? Any risks to consider before re-enabling?
We don’t know for sure. It could be due to security issues, system errors, business changes, or old code that was no longer needed. It’s best to check old logs or ask the team from that time.
Sanitization:
Does the current sanitization logic (e.g., in 
CreditProcessor.vb
) effectively prevent injection risks? Do we need changes or a security review?
Full security monitor isn’t required, but it’s 
good to have
 for extra safety. A quick review can help make sure everything is still secure.
Resend Design:
Which resend 
option 
above is best? Any known risks with DB schema changes?
The best way is to insert a new record and set the 
SmsSentDate
. No need for an 
IsResend
 flag or DB changes.
Conclusion
Displaying SMS replies alongside outbound messages in Pay by Text history is technically feasible with existing infrastructure and successfully re-enabled inbound SMS processing. Download and resend functionalities are achievable with additional development and operational safeguards, promising significant improvements in customer support and user experience.
 URL:/spaces/PE/pages/4512055313/Spike+PRISM-677+Feasibility+check+SMS+Copies+along+with+SMS+Replies.
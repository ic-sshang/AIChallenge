note
Conversion for Live Billers
Doing a data conversion for a live biller is more delicate, and requires the questions listed earlier answered. We don’t want to overwrite a user’s manual enrollment unless the biller asks us to do it for the conversion. That’ll require us to manually filter out any such accounts, as our tools do not handle the filtering for us.
For MCL billers, we also want to consider the file contents and any login registrations. If they’re wanting us to not create logins with the import, and only save it as the account-level, it is safer to skip over the accounts that already have a login registered.


Conversion for Live Billers
Doing a data conversion for a live biller is more delicate, and requires the questions listed earlier answered. We don’t want to overwrite a user’s manual enrollment unless the biller asks us to do it for the conversion. That’ll require us to manually filter out any such accounts, as our tools do not handle the filtering for us.
For MCL billers, we also want to consider the file contents and any login registrations. If they’re wanting us to not create logins with the import, and only save it as the account-level, it is safer to skip over the accounts that already have a login registered.


There are two ways to which these data conversions are handled, through the CRM tool, which can be found under: Tools > Biller Customer Imports, or through the InvoiceCloud API. 
Most conversions will fall under utilizing the CRM tool, but if the biller is a multi-customer/user login (MCL) biller then we need to handle them through our API until we have a better solution.
File Splitting
Not all conversions require this
Sometimes we need to split up the contents of a file into smaller files. It’s usually only needed under these two situations:
The file they’ve provided is large, and timing is an issue, as 
RegisterAutoPay
 is set to only run on six threads, and paperless/customers only run on one thread.
The import is occurring for a biller via CRM with multiple invoice types, but they only want those AutoPay enrollments imported for a given invoice type Id if the account has that ID.
Example, conversion is request for 6,42, ABC123 in the file is for ID6 and XYZ980 is for ID42. We’ll have to split up the file based on invoice type Id to not have the data imported as the other type.
They gave you a raw file that contains both ACH/CC payment methods.
File Combining
Not all conversions require this
There are other times where we need to combine two files provided by the biller/software partner/payment processor. Usually in this case it’s one file containing account number/data to correlate with IC, customer information and some type of payment method token, and another file where it contains the raw payment method information.
The two files will have to be mapped together based on the token and then merged into one dataset/file.
Customer Import Tool
You can view the guide for the Customer Import tool separately here, 
How to use the Customer Import Tool
, or from within the expand below.
How to use the Customer Import Tool
API
There are a few repositories within 
Miscellaneous Src
 that can be utilized for manually importing the conversions. 
Customer Login Registration - 
CustomerRegistrationApp - Repos
AutoPay Registration - 
AutopayRegistrationApp - Repos
Paperless Registration - 
PaperlessRegistrationApp - Repos
Review over the code before importing. 
You may need to comment out sections of the code depending on what’s being done for the import.
You’ll need to either update the file headers in code, or in the file.
We’ll have to retrieve CustomerGUIDs and LoginGUIDs from the Database. As well as any missing data that isn’t present in the file (e.g. Billing Information like Address, City, State…)
Generating an API key is required for an import over our API.
note
If the data conversion is for a MCL biller, and the import is going through our API, having the flags enabled currently isn’t enough to create DataPump records for Paperless. A DBR with Data Services will be needed to create those Paperless records.


If the data conversion is for a MCL biller, and the import is going through our API, having the flags enabled currently isn’t enough to create DataPump records for Paperless. A DBR with Data Services will be needed to create those Paperless records.


Generating API Key
An API key can be generated from within the biller portal under Support > Documentation / APIs > Application API Keys.
Sample Scripts/DB Calls
Pandas
This is a script you can use with pandas to merge two csv files together. You have three options on how to retrieve the data, 
'both'
, 
'left_only'
, and 
'right_only'
 after the merge.
It is helpful for both non-MCL and MCL, as you can use this to also retrieve data from the DB and merge it with the file you’re merging with as well.
Merge Data Script
py
import pandas as pd

origFile = pd.read_csv(r"FILE1",
                       dtype=str, keep_default_na=False)
customerGuidFile = pd.read_csv(r"FILE2",
                               dtype=str, keep_default_na=False)

df = pd.DataFrame(data=origFile)
df2 = pd.DataFrame(data=customerGuidFile)

#you can merge based on multiple columns. useful.
res = df.merge(df2, left_on=["AccountNumber"], right_on=["AccountNumber"], 
                              how="left", indicator=True, sort=False)
#res = res.drop_duplicates(keep="first", subset=['AccountNumber']) #drops all but first copy; not always needed but on request by the biller

dfs = {k: v for k, v in res.groupby("_merge")}
res2 = dfs['both'].drop(['_merge'], axis=1)
res2.to_csv(r"OUTPUTFILE", index=False)
Login Creation Script
py
import pandas as pd
import uuid
file = pd.read_csv(r"INPUT_FILE",
                          dtype=str, keep_default_na=False)
df = pd.DataFrame(columns=['AccountNumber', 'UserName', 'Password'])
madeDict = {}

for ind ifile. Indexex:
    accountNumber = str(file['AccountNumber'][ind])
    userName = str(file['Username/Email Address'][ind])

    if not userName or userName.isspace():
        userName = 'AutoPay_' + accountNumber

    if userName in madeDict.keys():
        password = madeDict[userName]
    else:
        password = uuid.uuid4()
        madeDict[userName] = password
    new_row = {'AccountNumber': accountNumber, 'UserName': userName, 'Password': password}
    df.loc[len(df)] = new_row
print(df['AccountNumber'].duplicated().any())
df.to_csv(r"OUTPUT_FILE", index=False)
File Splitter Script
py
import pandas as pd

file= pd.read_csv(rf"INPUT_FILE",
                  dtype=str, keep_default_na=False, encoding='mac_roman')

df = pd.DataFrame(data=file)

for i, g in df.groupby(df.index // 1000):
    g.to_csv(rf"OUTPUT_FILE_{i}", index=False)
SQL
This is a call you’ll want to use if you’re trying to find out if there are any accounts that are registered, or to change if you’re doing a MCL conversion and are trying to grab LoginGUIDs.
sql
SELECT c.AccountNumber, l.*
FROM mcl.customerlogins AS cl
INNER JOIN mcl.logins AS l
ON l.loginid = cl.loginid
INNER JOIN customers AS c
ON c.customerid = cl.customerid
 URL:/spaces/IM/pages/4248633410/Guidance+for+Conducting+a+Data+Conversion
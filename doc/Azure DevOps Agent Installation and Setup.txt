Below are the step by step by instructions to install the environment specific agents
Environment specific agent installation.
As shown in the video above click and follow the instruction and then copy the script.
In case of adding servers to the deployment groups for the classic pipelines use the method shown below
Once we have the scripts to register the agents on the targeted servers, log on to the sever where we need to register them.
1. In my case I logged into the proxytemp10, once you logged in make sure you open the PowerShell prompt and run it as ADMIN.
Paste the scripts you have copied from the above tutorials
Hit Enter and then follow the instructions as shown in the below picture
In the example below I am adding proxytemp10 to a deployment group and not environment.
Make sure on line 5 you add the tags carefully which is very crucial while configuring new servers
The tags I got for the above is shown in the below videos
For the environment resources, it is very much the same process to register the server. except for the tags identify it from the environment as shown below. use those tags.
To clean up the exiting agents inside the servers follow these instructions.
 1. By default, the ADO agents are installed under C Drive and in the following path 
C:\azagent
Look up the services.msc file to see what folder agent is being currently used as shown in the video below
Once you identify in the video, we have folder A3 and A4 being used, so we can safely delete the other folders as they are not being utilized by the agents.
to delete them using PowerShell using the follow commands as shown and modify them as needed based on the paths you have.
Get-ChildItem -Path 'C:\azagent\A1' -File -Recurse -Force | Remove-Item -Force
By following all the steps above, we just did a clean agent installation on the server for both the deployment groups and environments.
 URL:/spaces/platform/pages/4661051476/Azure+DevOps+Agent+Installation+and+Setup
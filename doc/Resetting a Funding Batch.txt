Introduction
This page will go over how to reset a funding batch. Resetting a funding batch is done whenever a biller should have been credited or debited but an issue occurs and the funds are not properly delivered. In these scenarios, the funding batch needs to be reset so that we can attempt to credit or debit the biller again. Resetting a funding batch will create another funding batch with the same volumes that is not marked as processed so that it is picked up and included in a NACHA file.
An SR item was created to develop a self-service tool in the CRM.
 
SR-381
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System JIRA
 
Preliminary Check
Before proceeding with this process you need to confirm if the batches are queued and the terminal is not on hold.
First check if the batches are currently queued by using the query below and confirming the batchâ€™s Funding Processed Date is NULL.
select * from fundingbatches where terminalid=7253 and servicefeebatch=0 order by 1 desc
Second in the CRM, navigate to the PayPal tab > IC Gateway Terminals. If the Terminal is on HOLD the funding batches will not be process. At this point reach out to the requestor and ask the to remove the terminal in questions from HOLD.
Environment Setup
The project used to reset the batches is not published on DevOps. Contact a Wicked Tendies ESRE member if you need this project. The execution of this project must be done on a Bastion term server so that it can reach the production ICGateway database.
Configuring the Project
The project consists of an int array that contains the FundingBatchIDs. The program will iterate through the FundingBatchIDs and call the stored procedure on it. Manually populate the FundingBatchID in the int array.
The stored procedure is different depending on whether the terminal type is Online Bank Direct or Paypal/Braintree. Query the Terminals table on ICGW_Master and check the TerminalTypeID field to determine which stored procedure should be used.
TerminalTypeID
TerminalType
Stored Procedure
1
Paypal/Braintree
spResetBatchFunding
2
Online Bank Direct
spResetBatchFunding_RPPS
These stored procedures take the same parameters. The ones being called in this case are FundingBatchID and NewFundingDelayDays.
Unless the funding needs to be delayed, pass a value of 0 in the NewFundingDelayDays parameter. Do not leave the value blank since the default delay is 3 days.
After configuring these variables and setting the FundingBatchIDs, the program is ready to execute.
Verifying Succesful Batch Reset
To verify the batch was successfully reset, query the database for the original FundingBatchID and refer to the NewFundingBatchID field.
This is the ID of the new funding batch. You can query for it and verify the correct volume and scheduled processing date.
 URL:/spaces/DS/pages/2804678694/Resetting+a+Funding+Batch
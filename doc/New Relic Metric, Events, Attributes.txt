1
7
Introduction
The three important aspects of New Relic are Metric, Events, and Attributes. Some of them come off the shelf with the configuration of the.NET agent in the production environment. The Custom are very specific and that are normally done via code instrumentation.
Metric
APM reports metric data in the form of 
metric timeslice data
, and you can use 
NRQL
 to query, facet, and alert on this type of data.
https://docs.newrelic.com/docs/data-apis/understand-data/metric-data/query-apm-metric-timeslice-data-nrql/
 
The Metric ingestion via .NET agent pre-populates a large number of values that are available via Metric Table, this is a dimensional table and what that means is there are multiple attributes associated with this Table and can be grouped via facet clause in NQRL. 
To list the attribute associated with a Metric
select uniques(metricName)  from Metric
FROM Metric SELECT keyset() WHERE metricName = 'apm.service.transaction.duration'
In the Metric dimension table, we can add custom attributes and from my understanding, this cannot be done via the .NET agent API. This is something needs to be VALIDATE with the experts.
The documentation gathered so far suggests that this can be done only via the Metric API which is a rest API
typescript
curl -vvv -k -H "Content-Type: application/json" \
-H "Api-Key: NEW_RELIC_LICENSE_KEY" \
-X POST https://metric-api.newrelic.com/metric/v1 \
--data '[{ 
        "metrics":[{ 
           "name":"memory.heap", 
           "type":"gauge", 
           "value":2.3, 
           "timestamp":CURRENT_TIME, 
           "attributes":{"host.name":"dev.server.com"} 
           }] 
    }]'
https://docs.newrelic.com/docs/data-apis/ingest-apis/metric-api/report-metrics-metric-api/
 
Custom Metric
The custom metric is a metric that can be defined for the application to track specifically, this involves adding the telemetry in the code.
vbnet
NewRelic.Api.Agent.NewRelic.RecordMetric(string $metric_name, single $metric_value)
vbnet
Stopwatch stopWatch = Stopwatch.StartNew();
System.Threading.Thread.Sleep(5000);
stopWatch.Stop();
NewRelic.Api.Agent.NewRelic.RecordMetric("Custom/DEMO_Record_Metric", stopWatch.ElapsedMilliseconds);
https://docs.newrelic.com/docs/apm/agents/manage-apm-agents/agent-data/collect-custom-metrics/
 
https://docs.newrelic.com/docs/apm/agents/net-agent/net-agent-api/recordmetric-net-agent-api/
 
Events reported by APM
APM
 reports 
event data
 that appears in some UI displays and is also available for 
querying and charting
. Select an event name in the following table to see its attributes.
Event
Description
Transaction
A transaction is a logical unit of work in a software application. The 
Transaction
 event includes information about the app, database calls, the duration of the transaction, and any errors that may occur.
TransactionError
Transaction errors occur when a request throws an exception in the code path that was taken to fill that request. The number of transaction errors does not equal the number of transactions, because you can specify whether you want to 
collect, ignore, or mark errors as expected
.
Span
Span events are created when New Relic agents, or other tracing instrumentation tools, instrument operations that are part of a distributed trace. See the 
definition of span
.
https://docs.newrelic.com/docs/data-apis/understand-data/event-data/events-reported-apm/
 
Custom Events and Attributes
var eventAttributes = new Dictionary<String, Object>();
NewRelic.Api.Agent.NewRelic.RecordCustomEvent("MyCustomEvent", eventAttributes);
https://docs.newrelic.com/docs/data-apis/custom-data/custom-events/apm-report-custom-events-attributes/
 
Custom Attributes
Once you add a custom attribute, you can query it in New Relic and create custom charts from that data. For example, if you used the .NET agent to add a 
userId
 attribute to your 
Transaction
 and 
TransactionError
 events, you could then create a NRQL query using that attribute, like:
sql
SELECT count(*) FROM TransactionError 
  WHERE userId = '1401961100' FACET dateOf(timestamp), `error.message` 
  SINCE 1 week ago
vbnet
IAgent agent = NewRelic.Api.Agent.NewRelic.GetAgent();
ITransaction transaction = agent.CurrentTransaction;

transaction
    .AddCustomAttribute("Discount Code", "Summer Super Sale")
    .AddCustomAttribute("Item Code", 31456);
https://docs.newrelic.com/docs/data-apis/custom-data/custom-events/collect-custom-attributes/
 
Further Reading
https://docs.newrelic.com/docs/apm/agents/net-agent/net-agent-api/guide-using-net-agent-api/
 
https://github.com/newrelic/newrelic-dotnet-agent/blob/main/README.md
 
https://dev.azure.com/invoicecloud/Src/_git/MyIIS/pullrequest/20089
https://dev.azure.com/invoicecloud/Src/_git/MyIIS?path=%2FIC.Common%2FclsNewRelic.vb&version=GBrelease&_a=contents
https://dev.azure.com/invoicecloud/Src/_wiki/wikis/Invoice Cloud Wiki/26/Logging-Standards
 URL:/spaces/DS/pages/2565439489/New+Relic+Metric+Events+Attributes
Summary: The City of Charlottesville Utility EBPP integration is a custom integration with SAP software. The data transfers are file based via SFTP. The integration exists within one City of Charlottesville portal, combined with their Tax integration (PCI software - standard integration).
The City of Charlottesville Utility also receives a payment file for the Cloudstore payments for utility deposits.
Page Navigation:
Jira ticket 
INT-1853
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System Jira
 
Document status
in progress
Yellow
Document owner
 
Solution engineer
 
Salesforce SOW
Integration Overview
The Charlottesville integration includes two separate integrations on the same portal (one for taxes and one for utility). This is the technical design for Utility (SAP) but each integration will have it’s own bill import process, adjustment process, payment data sync process, pdf linking, and invoice types.
File Mapping
Invoice File 
File Purpose: Create new invoices in IC.
File Extension: .txt
File Naming Convention: n/a
File Delimiter: CR, each line is a column
Specification: N/A
Sample File: Each bill starts with ‘H046A113’
SFTP File Path: ToInvoiceCloud/Invoices/UB
File Transfer Frequency: Each bill cycle
File Mapping
IC FileSpecID
IC Field
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Format
Partner Field Description
Partner Field Character Limit
Record Type
1
RowType
N
TRUE
N/A - Generated by IC
File Header
2
BillerGuid
N
TRUE
N/A - Generated by IC
File Header
4
FileCreationDate
N
TRUE
N/A - Generated by IC
File Header
5
InvoiceCount
N
TRUE
N/A - Generated by IC
File Header
6
TotalInvoiceAmount
N
TRUE
N/A - Generated by IC
File Header
7
RowType
N
TRUE
N/A - Generated by IC
Invoice Header
8
RecordType
N
TRUE
N/A - Generated by IC
Invoice Header
9
InvoiceFormatGuid
N
TRUE
N/A - Generated by IC
Invoice Header
10
InvoiceNumber
Y
TRUE
DACCT_NO + DBILL_DATE
Alphanumeric
Both are displayed on each bill twice, take first
Invoice Header
11
InvoiceDate
Y
TRUE
DBILL_DATE
MM/DD/YYYY
Displayed twice on each bill, take first
Invoice Header
12
InvoiceDueDate
Y
TRUE
DDUE_DATE
MM/DD/YYYY
Invoice Header
13
TotalAmountDue
Y
TRUE
DTOTAL_DUE
Currency
Invoice Header
38
Custom1
Y
FALSE
DSERVICE_ADDR
Varchar
Displayed twice on each bill, take first
Invoice Header
93
BalanceDue
Y
TRUE
DTOTAL_DUE
Currency
Invoice Header
252
InvoiceTypeID
N
TRUE
Invoice Header
407
PastDue
Y
FALSE
First line will be: DITEM_DESC BEGINNINGBALANCE
Next line will be:
DITEM_AMNT
Currency
Invoice Header
58
RowType
TRUE
NA - Generated by IC
Customer Record
59
AccountNumber
Y
TRUE
DACCT_NO
Numeric
Displayed twice on each bill, take first
Customer Record
60
CustomerName
Y
TRUE
DRESP_PARTY1
Varchar
Customer Record
61
Address1
Y
FALSE
DCUST_BILL_ADDR_LINE2
Customer Record
63
City
Y
FALSE
From 
DCUST_BILL_ADDR_LINE3
Customer Record
64
State
Y
FALSE
From DCUST_BILL_ADDR_LINE3
Customer Record
65
Zip
Y
FALSE
From DCUST_BILL_ADDR_LINE3
Customer Record
70
RowType
N
TRUE
Invoice Detail
Adjustments
File Purpose: Update balances on existing records. File is also used for customer updates - please see below.
File Extension: .txt
File Naming Convention: N/A
File Delimiter: Fixed space
Specification: 
Sample File: Updated due date and invoice date fields
SFTP File Path: ToInvoiceCloud/Updates/UB
File Transfer Frequency: Nightly
Rows that are marked with an ‘X' in field 34 are active. If there is no 'X’ in field 34 
and 
the balance due is 0 or negative the row can be skipped. If the record is inactive but still has a balance, IC will update the row.
File Mapping
IC FileSpecID
IC Field Name
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Format
Partner Field Description
Partner Field Character Limit
Record Type
305
RowType
 N
TRUE
 N/A IC to generate - Always AH
 
 
 
File Header
306
BillerGuid
 N
TRUE
 N/A IC to generate
 
 
 
File Header
307
ThirdPartyFileReference
 N
FALSE
 
 
 
 
File Header
308
FileCreationDate
 N
TRUE
  N/A IC to generate
 
 
 
File Header
309
AdjustmentCount
 N
TRUE
  N/A IC to generate
 
 
 
File Header
310
TotalAdjustmentAmount
 N
TRUE
  N/A IC to generate
 
 
 
File Header
311
RowType
 N
TRUE
  N/A IC to generate - Always AR
 
 
 
Adjustment Record
312
InvoiceNumber
Y 
FALSE
 Contract Account + Invoice Date
 
ContractAccount (22-33) + Invoice Date (535-542).
The Account number is 7 digits and Lpadded with 0s
The date is in format YYYYMMDD
 
Adjustment Record
313
AccountNumber
 Y
TRUE
 Contract Account
 
Position 22-33
 
Adjustment Record
314
AdjustmentAmount
 Y
TRUE
 Balance Due on or Before Current Date (Only display to two decimal places)
 
Position 305-317
 
Adjustment Record
316
AdjustmentTypeID
 Y
TRUE
 2 (Balance Differential adjustment type)
 
 
 
Adjustment Record
Customer Update File
File Purpose: IC will create a ‘customer update’ file from the daily adjustment file to make updates to the ‘BlockPaymentsEFT’ field.
File Extension: .txt
File Naming Convention: N/A
File Delimiter: Fixed space
Specification: 
Sample File: 
SFTP File Path: ToInvoiceCloud/Updates/CustomerUpdates
File Transfer Frequency: Nightly
Rows that are marked with an ‘X' in field 3
File Mapping
IC FileSpecID
IC Field
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Format
Partner Field Description
Partner Field Character Limit
Record Type
58
RowType
N
T
N/A - IC to generate always CR
Customer Record
59
AccountNumber
Y
T
Contract Account
Position 22-33
Customer Record
357
BlockPaymentsEFT
Y
F
Customer Check Status - if ‘NOCHK’ will not allow ACH payments. 
Given that all customers will always have a blank value for this it is not possible to determine when a customer is unblocked and this will have to be done manually.
Position 523-526
Customer Record
Payment File
File Extension: .txt
File Naming Convention: 
BID_UTLPAYMENTS_YYYYMMDD
 and for Cloud Store payment file ‘BID_CLOUDSTOREUTLPAYMENTS_YYYYMMDD’
File Delimiter: Fixed length (each payment is a row in the file)
Specification: 
If credit - can skip and be handled manually
File should contain InvoiceTypeID 42 ONLY
Example line: 114305    202101201234567 0000000001234VIS000000000000    
Sample File: 
SFTP File Path: FromInvoiceCloud/Payments/UB
File Transfer Frequency: Daily
File Mapping
Field
Data Type
Character Limits
Format
Values
TransactionTime
Time
6
Position 1-6
HH:MM:SS
Filler
Varchar
4
Position 7-10
4 blank spaces: '    '
TransactionDate
Date
8
Position 11-18
YYYYMMDD
AccountNumber
Number
7
Position 19-25
AccountNumber
PaymentAmount
Number
15
Position 27-40
Amount (LPAD with 0s), no decimal point. If credit (negative) - can skip and be handled manually
CardType
varchar
3
Position 41-43
MST, VIS, DCV, ACH, or UNK(for other)
Filler
12
Position 44-53
0s
Filler
4
Position 54-59
4 blank spaces ('    ')
Change Log File
File Extension: .csv
File Naming Convention: BID_CHANGELOG_YYYYMMDD
File Delimiter: comma
Specification: n/a
Sample File: n/a
SFTP File Path: FromInvoiceCloud/ChangeLogs/UB
File Transfer Frequency: daily 
File Mapping
Field
Data Type
Character Limits
Format
Values
Account Number
Varchar 
30 
Account Number from IC database
AP Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed enrollment in AutoPay
AP Un-Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed un - enrollment in AutoPay
Phone Number
Varchar 
15
Phone number of the customer
Phone Number change date
Datetime
MMDDYYYYHHMMSS
Date phone number was changed on IC
Paperless Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed enrollment in paperless
Paperless Un-enrollment
Datetime
MMDDYYYYHHMMSS
Date customer un-enrolled in paperless
Bill Presentment
PDF Extraction
File Extension: .pdf
File Naming Convention: One file - zipped
Sample File: 
https://invoicecloud.box.com/s/6125hnx7rh84mtrbial4bkakl99uftwt
 
SFTP File Path: ToInvoiceCloud/PDFs/UB
File Transfer Frequency: Each Billing Cycle
Bill presentment will be done through PDF extraction. Please extract the account number + the due date (or bill date if not possible) for each bill for matching. Charlottesville is balance forward so there should only be one open bill but best to also link on one other field besides account number.
BIF Customization's
Feature
BIF CUSTOMIZATIONS
AchServiceFee
N/A, in BIF, on biller questionnaire 
AllowPartialPayments
BIF Customization - Biller 
Questionnaire
AutoPayCollectionDate
BIF Customization - Biller 
Questionnaire
BalanceForward
BIF Customization - Biller 
Questionnaire 
(required)
CreditCardServiceFee
N/A
FirstNotifyRequestedDate
BIF Customization - Biller 
Questionnaire
InvoiceDate
N/A
InvoiceDueDate
N/A
InvoiceFormatGuid
N/A
InvoiceTypeID
N/A
LateFeeDate
N/A
LocationReference
N/A
MinimumAmountDue
N/A
PaymentExpirationDate
N/A
PaymentExpirationMessage
N/A
PromptPayExpirationDate
N/A
RegistrationValue
N/A
SecondNotifyRequestedDate
BIF Customization - Biller 
Questionnaire
ThirdNotifyRequestedDate
BIF Customization - Biller 
Questionnaire
User Interaction and Design
Data Flow - Invoice
Invoices are uploaded to SFTP in Charlottesville format and converted to BIF and imported
Data Flow - Adjustments
Daily adjustment file mapped to IC
Data Flow - Payment
Payment made on IC → daily payment file sent back in Charlottesville format. A separate payment file for cloudstore.
Data Flow - Void
Use Biller Portal to void payment, manually remove payment
Data Flow - ACH Reject
Receive email for ACH reject, manually remove payment
Data Flow - Change Log
Changelog file sent daily
Data Flow - Bill Presentment
Print vendor will put zip file of PDFS on SFTP with naming convention of 
BillerID_AccountNumber_InvoiceNumber.pdf
 (can pass the word “InvoiceNumber”)
Payer Experience
Payers will access Invoice Cloud from the Biller website (URL redirect). Payers will use the IC Virtual Site and Customer Portal.
Biller Experience
Through the biller portal
User Stories
User needs to make a payment before first bill - Linked to Cloud Store (enter 7 digit account number + payment amount) → Payment sent back as payment file.
Invoice Cloud Web Services
N/A
Integration Modifications
Jira INT
Date Released
Previous Behavior
Desired Behavior
Business Case / Solution
ITG-2936
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System Jira
 
TBD
Service address is empty when switch the address. 
Display service address correctly.
Stored service address to Custom1 instead of CustomField1
 URL:/spaces/IM/pages/1724317963/City+of+Charlottesville+UTL+2575+Technical+Design
Purpose and Scope
This domain manages storage of sensitive data in Azure Key Vault, enforcing strict network and authorization controls. It provisions the Key-Vault instance, Access Control Lists(ACLs) and secrets for downstream consumers.
Detailed Architecture
Terraform Implementation
hcl
# 1. Fetch tenant info
data "azurerm_client_config" "current" {}

# 2. Generate random password
resource "random_password" "local_admin_user_password" {
  length           = 16
  special          = true
  override_special = "!#$%&*()-_=+[]{}<>:?"
}

# 3. Create Key Vault
resource "azurerm_key_vault" "key_vault" {
  name                          = "kv-${var.region}-${var.application_name}-v${var.deployment_version}-${var.environment}"
  resource_group_name           = module.resource_group.resource_group.name
  location                      = module.resource_group.resource_group.location
  tenant_id                     = data.azurerm_client_config.current.tenant_id
  sku_name                      = "standard"
  public_network_access_enabled = false
  enable_rbac_authorization     = true
  tags                          = var.tags

  network_acls {
    default_action = "Deny"
    bypass         = "AzureServices"
  }
}

# 4. Store admin config as secret
resource "azurerm_key_vault_secret" "local_admin_config" {
  name         = "local-admin-user-configuration"
  value        = jsonencode({
                   name     = "local_admin_user"
                   password = random_password.local_admin_user_password.result
                 })
  key_vault_id = azurerm_key_vault.key_vault.id
  tags         = var.tags
}
Key Inputs and Outputs
Name
Type
Description
var.region
string
Azure region code
var.application_name
string
Application name prefix
var.deployment_version
number
Infra version suffix
var.environment
string
Deployment environment
var.tags
map(string)
Tag map
data.azurerm_client_config.current.tenant_id
string
Tenant ID for the Key Vault
random_password.local_admin_user_password.result
string
Generated admin password
Output
Description
azurerm_key_vault.key_vault.id
Resource ID of the Key Vault
azurerm_key_vault.key_vault.name
Name of the Key Vault
azurerm_key_vault_secret.local_admin_config.id
ID of the stored “local-admin-user” secret
Security and Access Controls
RBAC-only
: uses Azure RBAC for all access (no legacy access policies).  
Network ACLs
: 
default_action = "Deny"
, only AzureServices bypass.  
Public access disabled
: ensures VNet-only connectivity via private endpoints if needed. 
Managed Identities
: downstream modules use MI to fetch secrets—no static credentials.
Operations and Runbook
terraform init  
terraform plan -var-file=env/${var.environment}.tfvars  
terraform apply -var-file=env/${var.environment}.tfvars  
Rotate secret: update random_password length or pattern, then re-apply.
note
Troubleshooting:
403 Forbidden
 → verify MI has “Key Vault Secrets User” role assignment.  
NetworkAccessDenied
 → check Key Vault firewall settings and VNet/subnet associations.


Troubleshooting:
403 Forbidden
 → verify MI has “Key Vault Secrets User” role assignment.  
NetworkAccessDenied
 → check Key Vault firewall settings and VNet/subnet associations.


Links and References:
Azure Key Vault docs
Confluence labels: 
infra
 
secrets
 
key-vault
 
terraform
 
Related pipeline:
 URL:/spaces/platform/pages/4264820755/Secrets+and+Key+Vault
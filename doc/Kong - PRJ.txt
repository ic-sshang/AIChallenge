Overview
Kong is a API Gateway system.  Kong will be used for API routing, authentication, observability, transformation, lifecycle management, and API documentation.   
There are two usage models:
Legacy integrations
 - Supported on the existing www.invoicecloud.com domain.  Kong will primarily act as a router.  Existing API HTTP traffic will be routed to Kong by a upstream component (Azure App Gateway).  Kong will pass through the requests to the backend.  In the future Kong can be used to handle other use cases in this space as needed.  
New integrations
 - Supported on the new api.invoicecloud.com domain.  Kong will act as a router and provide additional value add functionality ( authentication, transformation, etc…)
2
0
1
0
3639279651
3676635153
Untitled Diagram-1729782038247.drawio
1
4
4
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1729782038247.drawio
0
571
861
New Integrations
The first phase is targeting biller APIs.
Authentication
Kong will be used to centralize API authentication protocols.  OAuth 2.0 will be used. 
Kong Consumer
A Kong Consumer will be created for each Biller.   A consumer has a custom id property that can hold any data needed to map to a Biller in the backend.  This can be used to hold multiple values like the Biller ID, Biller GUID, and Legacy API Key.  Similar in concept to claims in a JWT token.
OAuth 2.0
The client credential grant will be used in this first phase.  A front end, like the Biller Portal or CRM, will be used to provision OAuth client ids and secrets on a Biller's consumer record in Kong.  A integrated application will exchange their client id and secret for a access token using the Kong OAuth token endpoint.   Access tokens will have a limited lifetime.
OAuth 2.0 Authentication and Legacy RESTful APIs
2
1
0
0
3639148611
3639279651
1
Untitled Diagram-1728674006298.drawio
1
3
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1728674006298.drawio
0
540
810
Example OAuth 2.0 Request
GET /apis/biller/v1/httpbin HTTP/1.1
Authorization: Bearer Yg55QAXIMkvSG9xa1wk6YOHtNZh0jdcW
User-Agent: PostmanRuntime/7.42.0
Accept: 
/
Cache-Control: no-cache
Postman-Token: aa650a6f-5548-4b59-8d18-a7b90adc1264
Host: api-dev.invoicecloud-beta.com
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Example OAuth 2.0 → Basic Transform HTTPBIN Response
HTTP/1.1 200 OK
Date: Mon, 28 Oct 2024 15:21:32 GMT
Content-Type: application/json
Transfer-Encoding: chunked
Connection: keep-alive
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
CF-Cache-Status: DYNAMIC
Server: cloudflare
CF-RAY: 8d9bea89fd6a1762-IAD
Content-Encoding: gzip
{
"args": {},
"data": "",
"files": {},
"form": {},
"headers": {
"Accept": "
/
",
"Accept-Encoding": "gzip, br",
"Authorization": "Basic SXpyZkNNT3BPRjVXRFAvWjhVOEZtelhGcTFVbjducW9iN3ZvZXlIMFJ5TzcvdGRHcjEzV3JCOG1NbXdhTFlCNjZVbGJTTXpvUFVEYlZ2M3Rud052aldhbmRaNzdydm5xL1UzRVhpWGVzM0E9Og==",
"Cache-Control": "no-cache",
"Cdn-Loop": "cloudflare; loops=1",
"Cf-Connecting-Ip": "20.246.162.241",
"Cf-Ipcountry": "US",
"Cf-Ray": "8d9bea89fd6a1762-IAD",
"Cf-Visitor": "{\"scheme\":\"https\"}",
"Host": "http://httpbin.org ",
"Postman-Token": "aa650a6f-5548-4b59-8d18-a7b90adc1264",
"User-Agent": "PostmanRuntime/7.42.0",
"X-Amzn-Trace-Id": "Root=1-671fabfc-339988e20d42e889183a0e6b",
"X-Appgw-Trace-Id": "327ee9ac3a2f2339a3c74be7b24fc108",
"X-Consumer-Custom-Id": "guid:4851516b-28fa-4194-8b4a-7097ff11c4b8,id:2002,apikey:SXpyZkNNT3BPRjVXRFAvWjhVOEZtelhGcTFVbjducW9iN3ZvZXlIMFJ5TzcvdGRHcjEzV3JCOG1NbXdhTFlCNjZVbGJTTXpvUFVEYlZ2M3Rud052aldhbmRaNzdydm5xL1UzRVhpWGVzM0E9Og==",
"X-Consumer-Id": "b96f7258-1eb6-4234-9566-7714932eb1e0",
"X-Consumer-Username": "4851516b-28fa-4194-8b4a-7097ff11c4b8",
"X-Credential-Identifier": "4iekcenidfn7zu028sa9t1s6g58yjhex",
"X-Forwarded-Host": "api-dev.invoicecloud-beta.com",
"X-Forwarded-Path": "/apis/biller/v1/httpbin",
"X-Forwarded-Prefix": "/apis/biller/v1/httpbin",
"X-Original-Host": "api-dev.invoicecloud-beta.com",
"X-Original-Url": "/apis/biller/v1/httpbin"
},
"json": null,
"method": "GET",
"origin": "20.246.162.241,10.152.2.6, 10.152.88.64, 20.246.162.241",
"url": "https://api-dev.invoicecloud-beta.com/anything/from/kong"
}
OAuth 2.0 Authentication and New RESTful APIs
2
1
0
0
3639083033
3639279651
1
Untitled Diagram-1728669817607.drawio
2
2
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1728669817607.drawio
0
489.5
727
 URL:/spaces/EA/pages/3639279651/Kong+-+PRJ
Runbook name
PDF Extraction Setup 
Description
PDF Extraction Setup and Configurations
On this page
2
Change Log
760
Date
Author
Version
Description
 
Summary
PDF Extraction:
(PdfQueueByExtraction) The process that renames pdf files to the appropriate account and/or invoice number to be linked to the invoice record for bill presentment.​
BID_AccountNumber_InvoiceNumber.pdf​
How it works​
Determines the invoice type associated with the pdf​
Splits large pdf collections into smaller individual pdfs.​
Reading the text contents of the pdf​
      -Searches the pdf in a particular area for a set pattern that matches the account or invoice number data.​
      -Builds the account or invoice number based on the data provided within the pdf.​
Renames the appropriate name based on the data gathered from the text contents.
Process
Steps
Description
Screen Shots
1
Access the AVD Web Client
Open Microsoft Edge (recommended for best performance).
Navigate to: 
AVD Web Client
 
2
Launch the AVD Session
Click on the 
SessionDesktop
 icon displayed on the screen.
3
Allow Resource Access
If prompted, click 
Allow 
to enable necessary resource permissions.
4
Log in to Your AVD Session
Wait for the 
login prompt
 to appear. 
(If the prompt does not appear, check your popup blocker settings.)
Enter your 
Office 365 credentials
 and complete authentication.
5
From the Azure Virtual Desktop, Open Remote Desktop
Click 
Start
, then open 
Remote Desktop
.
6
Connect to the Target Server
In Remote Desktop, enter the server IP: 
10.0.8.4
.
Click 
Connect
 and log in using your 
Office 365 credentials
.
If prompted, click 
Yes
 to connect despite certificate errors.
7
Resume Work in CSTerm
Once connected, proceed with CSTerm tasks as usual.
8
Skynet URL
Once signed in navigate to the Chrome icon and enter the Skynet URL: 
http://internal.invoicecloud.com/apps/skynet/Authenticate
 
When prompted sign in using CRM Credentials.
9
Adding PDF File to Remote Desktop
When uploading a PDF file, it will go to the 
Remote Desktop Virtual Drive
 which is located on the
 Session Desktop
. Once you locate the file move it to 
your user folder
 then from there you can either copy paste to the 
Remote Desktop
, or you can Drag and Drop. 
If unable to do the above navigate open another Google page find BOX official site, then login using your Invoice Cloud credentials. Navigate to your biller by either enter BID in the search bar or go to > Public - Operations > Billers > and find the Billers folder to grab the PDF samples. 
When in biller's folder open the PDFs and click download this will download to This PC > Local Disk (C:) > Users > (your name) > Downloads.
10
PDF Markers and ICInvoiceFileMapper​
Location of application​
E:\Data\AppData\Pdfs\Tools\InvoiceFileMapper 
File -> Open Pdf.​
You can also drag-drop pdf.​
Select dropdown for BitMiracle.Docotic​
Click “Get Text Extract” so that the application reads the text within the pdf as well as shows the location coordinates of each word or line.​
Internally we call these “Pdf Markers”
11
ICSkynet
Open Chrome
Go to 
http://internal.invoicecloud.com/apps/skynet
Login using your current CRM credentials​
Select “Pdf Utilities” on the top tab​
If creating a new configuration​
Select the “+ Add New Pdf Template”​
If modifying an existing configuration​
Use the search bar to find the existing configuration then, select the PdfTemplateID to view the existing configuration.
 
12
Using ICSkynet – PDF Template
PDF Extraction Library = BitMiracle.Docotic​.PDF
PDF Template Page Count = The pdf page count per invoice record.
Is Self-Healing = Logic that enables the code to attempt to search for a marker based on the existing search pattern.
PDF Extraction Mode = Should always be set to “Partial Extraction”​ (Full Extraction is deprecated)
PDF Template Description = The identifier when using ICSkynet. Usually written in the format below:​
Biller DBA – Invoice Type Quarter Demand
PDF Template Markers = Found when the ICInvoiceFileMapper was run.
PDF Extraction Markers = Found when the ICInvoiceFileMapper was run.
13
ICSkynet – Pdf Template Marker
PDF Extraction Type = How to search for the value.​
Use only Word or Line​
Self Generated Marker = Identifier to show if the marker was generated by the self-heal process.
Marker X - Marker Y Dialog BOX = The coordinates used to locate the value, these are found when the ICInvoiceFileMapper was run on the PDF samples. 
Margin of Error = Unused when using BitMiracle. Set to 0
Value = The value to search for to identify the Pdf Template (relates to the value you used to get the information for Marker Dialog BOX) 
Click Save PDF Template Marker
14
ICSkynet – Pdf Extraction Field/Marker
PDF Extraction Field = Extraction Keywords to get or set data based on the configuration.
Self Generated Marker = Identifier to show if the marker was generated by the self-heal process.
Extraction Function = Used to search.​
Always use 
Word Extraction
 – GetTextFromRectangle or 
Line Extraction
 – GetTextFromRectangle.​ (All other options are Deprecated.)
Marker X - Marker Y Dialog BOX = The coordinates used to locate the value, these are found when the ICInvoiceFileMapper was run on the PDF samples. 
Click Save PDF Extraction Field
15
Regex
Common regex patterns will be added to this Guru card.​ (Coming Soon)
Pdf Extraction Regex Cheat Sheet | Guru (getguru.com)
AM|AccountNumber works in a lot of cases (as long as it matches what's in the BIF)
Some explanations on symbols and characters on how Regex is used can be explained within this website.
https://regexr.com/
 
NOTE:
 
You can put a generic account number into CoPilot to get the Regex pattern.
16
Extraction Keywords/Formats
Extraction keywords are explained in depth 
https://invoicecloud.atlassian.net/wiki/spaces/Implementa/pages/edit-v2/4253384745?draftShareId=20134a29-80db-4c96-b427-b6e525a41eba#PDF-Extraction-(Generic-Class)-Format
 
17
PdfExtractionValidator
Location of application​
E:\Data\AppData\Pdfs\Tools\PdfExtractionValidator\ PdfExtractionValidator.exe​
Load Pdfs​
Pdf Must have BID in front of the filename​
Test pdfs must be from the same BID​
Run Extraction​
NOTE: 
It helps to set the max pdfs to process to 10 while you are testing so it doesn't take forever to load.  Once the 10 is successful, then run all of them.
View results​
Success​
TemplateNotFound – Pdf Template markers cannot identify the pdf invoice type.​
ExtractionFailure – Could not location the data for the account number or invoice number.​
Duplicate – Duplicate account numbers in the large pdf​
Reject – files intentionally removed​
Uneven Split – page count from large file does not match the split amount​
Save Directory will save the resulted pdf within the directory.​
Avoid using the Desktop as a save path
18
CRM - Integration Summary
Integration Summary - Invoices
Dates should be updated to reflect when the work was completed.
Invoice Display Method should be set to PDF
BIF Customization
Add or edit File Spec ID 9 Invoice Format GUID
Check the Biller Will Send us PDFs, Regular, and Active to enable PDF Extraction
19
CRM - Stratus/FTP
Stratus
Add a Stratus Task as a “Send Pdfs” task
FTP
New PDF Settings:
Add FTP PDF Settings​ - Note: The Move Action must be ​
“Prepend BillerID and Move to Extraction Pending”
New Zip File Setting:
Optionally add a Zip Task if the biller plans to send .zip or .7z files for PDFs
Resouces 
PowerPoint Training 
PdfExtraction-Setup.pptx
Video
PDF Extraction Setup.mp4
Adding Sample PDFs files to Remote Desktop
Adding Sample PDFs to Remote Desktop.mp4
Change Log vs. Full Delta (file)
https://invoicecloud.atlassian.net/wiki/x/AYBB-w
 
note
PDF Extraction (Generic Class) Format 


PDF Extraction (Generic Class) Format 


This guide is to implement a PDF Extraction into the Generic Class. The Generic class uses the markers in Skynet in order to add the Account Number and Invoice Number data onto the PDF name. There are a few keywords and formats used in the Marker Descriptions in order to achieve this task.
Descriptions Format
Each marker requires a keyword that is used for a particular task. In the example below is written "AM" plus a pipe "|" is the keyword used to search the Account Number and the value after the pipe "Marker1" is the description of the marker.
AM|Marker1
Some keywords use the description to do a particular task. In the example below, we use "AN|" as the keyword for the Account Number Regex and the value after the pipe is the Regex code that will be used to verify the Account Number.
AN|[0-9]{3,5}
Template Markers
Template markers are markers used to identify the invoice type to the PDF. The Value is normally a word or line used to identify the invoice type. IE. "Utility Services" or "Water Bill"
Keywords
Template markers only use the keywords below. keywords are IC created keys used to do certain actions in the Generic Pdf Extraction logic.
FORCE|{ID}
FORCE| is used to for the PDF template skipping the normal search from template markers. This is originally designed when there is only one invoice type for the biller and there is no viable data in the PDF text to identify the invoice type. You can use the word "ID" after the pipe "|" and the logic will pick up the PdfTemplateID with this logic. You can also specify a PdfTemplateID to jump the system to a different PdfTemplateID.
Sample
Result
FORCE|1200
PdfTemplateID = 1200
FORCE|ID
PdfTemplateID = 1200
NAME|
the NAME| is used to identify the template using the filename instead of searching the PDF text. This is used by adding a text value after the pipe "|" to search for in the file name. To use this, we expect the file name to always have the search value.
Example File Name
Example Search
Result
3340_GAP3455400
NAME|GAP
match
3340_RE3455400
NAME|GAP
no match
Extraction Markers
Requirements
Each extraction search marker needs an accompanying Regex. Some have internal Regex so one is not needed to be specified. You can add multiple Regex markers for each search marker.
Keywords
Several keywords are used by both the Account Number and Invoice Number. They are differentiated by the first letter of the keyword. "A" is for Account Number, and "I" is for Invoice Number. There are some keywords that are used in conjunction with other keywords used to adjust the first keyword properties, most of these do not have an "A" or "I" as the first letter.
AFV| , IFV|
The AFV| and IFV| is used for the final regex verification, this is the final step in the process to ensure the Account or Invoice Number is in the correct format. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$".
Sample
Result
AFV|[A-Z0-9]{2}\-[0-9]{6}
New Regex("^[A-Z0-9]{2}\-[0-9]{6}$")
AN| , IN|
The AN| and IN| is used for regex values to verify the AM| and IM| markers. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$".
Sample
Result
AN|[A-Z0-9]{2}\-[0-9]{6}
New Regex("^[A-Z0-9]{2}\-[0-9]{6}$")
AM| , IM|
The AM| and IM| are used to get the base Account or Invoice Number. This is usually the only keyword used if you are not looking for other values in the PDF. Anything after the pipe "|" is only a description of the marker. This value will be checked by the AN| and IN| regex.
Sample
Result (found data)
AM|MarkerNum1
00472-00
ASN| , ISN|
The AN| and IN| is used for regex values to verify the ASM|, ASM2|, and ISM| markers. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$". These markers are completely optional and are not necessary to use the ASN| and ISN| markers.
Sample
Result
ASN|\d{4,9}\-\d{3,9}
New Regex("^\d{4,9}\-\d{3,9}$")
ASM| , ASM2|, ISM|
The ASM|, ASM2| and ISM| is the split marker. This is used to get a part of a whole word that has a value we can split between. The data after the pipe "|" should be the character we are to use to split the word, comma "," the index of the part of the word we are getting (0 index), comma "," the description of the marker. In the examples below we are to use only the data in bold.
Sample
Result (found data)
ASM|-,0,AccountNumber
123456
-12345678
ASM2|-,1,CustomerNumber
123456-
12345678
ISM|/,2,BillYear
12/20/
2022
AFR| , IFR|
The AFR| and IFR| is used for regex values to verify the AFN| and IFN| markers. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$". These markers are completely optional and are not necessary to use the ABILLNUM| and IBILLNUM| markers.
Sample
Result
AFR|[A-Z0-9]{2}\-[0-9]{6}
New Regex("^[A-Z0-9]{2}\-[0-9]{6}$")
AFN| , IFN|
The AFN| or IFN| is known as the file name marker. This marker is used to grab text from the filename. This works similar to the split marker as the formatting of this marker also used a a value to split the text in order to grab part of the file name. The data after the pipe "|" should be the character we are to use to split the word, comma "," the index of the part of the word we are getting (0 index), comma "," the description of the marker. In the examples below we are to use only the data in bold.
Sample
Result (found data)
AFN|_,1,AccountNumber
1875_
123456
_12345678.pdf
ABN| , IBN|
The AN| and IN| is used for regex values to verify the ABILLNUM| and IBILLNUM| markers. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$". These markers are completely optional and are not necessary to use the ABILLNUM| and IBILLNUM| markers.
Sample
Result
ABN|[A-Z0-9]{2}\-[0-9]{6}
New Regex("^[A-Z0-9]{2}\-[0-9]{6}$")
ABILLNUM| , IBILLNUM|
The ABILLNUM| and IBILLNUM| is used similarly to the AM| or IM|, the only major difference is that this marker can 
optionally
 get verified by the regex set from the ABN| or IBN| regex keyword. If it is not verified, this marker will pull the first thing it will find without validation. Note: Self-healing will not work if there is no regex for this marker.
Sample
Result (found data)
ABILLNUM|BillNo1
3254
ABILLYR| , IBILLYR|
The ABILLYR| and IBILLYR| are used to get the Bill Year of the Account or Invoice Number, the data after the pipe "|" is only the description. This value must pass the Regex of Numeric Only with 4 Characters (^[0-9]{4}$).
Sample
Result (found data)
ABILLYR|BillYear1
2020
APRE| , IPRE|
The APRE| and IPRE| are used to Prepend any string to the Account or Invoice Number. The value that will be prepended is the value after the pipe "|". This will prepend to the final Account or Invoice Number before it is processed.
Sample
Supporting Marker
Result (00472-00)
APRE|WTR-
AM|MarkerNum1
WTR-
00472-00
APOST| , IPOST|
The APOST| and IPOST| are used to Append any string to the Account or Invoice Number. The value that will be appended is the value after the pipe "|". This will append to the final Account or Invoice Number before it is processed.
Sample
Supporting Marker
Result (00472-00)
APOST|-0011
AM|MarkerNum1
00472-00
-0011
AVAR| , IVAR|
The AVAR| and IVAR| are used to insert a string into the Account or Invoice Number. This is similar to the APRE|, IPRE|, APOST|, and IPOST| functionality. The data after the pipe "|" is what is inserted into the Account or Invoice Number string. This is usually used with the APOS| or IPOS| keywords. This can be used multiple times using different markers.
Sample
Supporting Marker
Result (00472-00)
AVAR|UT-|
APOS|1
AM|AccountNum1|APOS|2
UT-
00472-00
ASAMEVALS| , ISAMEVALS|
This duplicated the account number with the invoice number. This is only used with MV invoice type extractions.
AREGNUM|
The AREGNUM| is the exclusive to the Account Number. This is used to get the registration number. This is similar to the ABILLNUM| in that it does not get verified via regex and, anything after the pipe "|" is only a description of the marker.
Sample
Result (found data)
AREGNUM|RegisNum1
554
INSTNUM|
The INSTNUM| is the exclusive to the Invoice Number. This is used to get the installment number. Anything after the pipe "|" is only a description of the marker. This value is unique because it will find and convert the phrases 1st, 2nd, 3rd or 4th, FIRST, SECOND, THIRD, and FOURTH to a numerical value.
Sample
Result (2nd or SECOND)
INSTNUM|instalNum1
2
IDV|
The IDV| is used for regex values to verify the IBDATE| markers. This is an optional Regex as IBDATE| has an internal standard to search for a date. After the pipe "|" you enter what is usually entered between the carrot "^" and the "$". These markers are completely optional and are not necessary to use the ABILLNUM| and IBILLNUM| markers.
Sample
Result
ABN|\d{1,2}\/\d{1,2}\/\d{4}
New Regex("^\d{1,2}\/\d{1,2}\/\d{4}$")
IBDATE|
The IBDATE| is the exclusive to the Invoice Number. This is used to get a date for the invoice number. The IBDATE| is unique because it can be used in conjunction with the STR| to rearrange or use partial values of the date. This date is auto Regexed to search for MM/DD/YY or MM/DD/YYYY but can be 
optionally
 validated with the IDV| marker.
Sample
Supporting Marker
Result (04/01/2021)
IBDATE|billDate1
﻿
04/01/2021
IBDATE|billDate1|STR|yyyy
﻿
2021
IBDATE|billDate1
IDV|\d{4}\/\d{2}\/\d{2}
No Match Found
Conjunction Keywords
These keywords are use in addition to the regular keywords. These are used to manipulate data to get the wanted results. These keywords must be used after the using a keyword to search for a value.
APOS| , IPOS|
The APOS| and IPOS| are special keywords used to position the marker on the Account or Invoice Number string. The value after the pipe "|" must be numeric and is used to position the marker in a build-able Account or Invoice Number.
Samples
AVAR|UT-|
APOS|1
AM|AccountNum1|
APOS|3
ABILLYR|BillYear1|
APOS|2
Final Result
Results
UT- (Position 1)
00472-00 (Position 3)
2020 (Position 2)
UT-202000472-00
TRIMLVAR| , TRIMRVAR|
These will trim left (TRIMLVAR|) or trim right (TRIMRVAR|) and will remove the value specified after the pipe "|".
Sample (Left Trim)
Result (00472-00)
AM|AccountNum1|
TRIMLVAR|0
472-00
﻿
Sample (Right Trim)
Result (00472-00)
AM|AccountNum1|
TRIMRVAR|0
00472-
SUBSTR|
The SUBSTR| is used to get a sub string of the first keyword marker. There must be two values after the pipe "|" separated by a comma "," to get the start index and total length of the sub string.
Sample
Result (00472-00)
AM|AccountNum1|
SUBSTR|2,5
472-0
STR|
The STR| currently only being used in conjunction of the IBDATE| to return a particular string format after getting a date value.
Sample
Result (04/01/2021)
IBDATE|billDate1|
STR|MMddyyyy
04012021
IBDATE|billDate2|
STR|yyyyMMdd
20210104
IBDATE|billDate3|
STR|yyyy
2021
PADL| , PADR|
These will pad left (PADL|) and pad right (PADR|) with values that are specified after the pipe "|". There must be two values separated by a comma ",". The first value is the total length, and the second value is the charter used to fill the spaces.
Sample (Left Pad)
Result (00472)
AM|AccountNum1|
PADL|9,0
0000
00472
﻿
Sample (Right Pad)
Result (004720)
AM|AccountNum1|
PADR|9,1
004720
111
REPL|
The replace (REPL|) is used to replace a value for another value. There must be two values after the pipe "|" separated by a comma "," to search for the old value and convert to the new value. Note: to replace a comma "," you must use a backslash "\" to separate the values. Note: to replace as an empty string. insert a pipe after the comma; to replace as a space add a space between the comma and the last pipe.
Sample
Result (00472-00)
AM|AccountNum1|
REPL|-,.|
00472.00
﻿
Sample (Empty string)
Result (00472-00)
AM|AccountNum1|
REPL|-,|
0047200
﻿
Sample (Add space)
Result (00472-00)
AM|AccountNum1|
REPL|-, |
00472 00
﻿
Sample (Replace comma)
Result (00472,00)
AM|AccountNum1|
REPL|,\*|
00472*00
INS|
The INS| is used to insert a string of the first keyword marker. There must be two values after the pipe "|" separated by a comma ",". The first value should be the character index of where to insert the text. The second value is the text to insert.
Sample
Result (RE0047210)
AM|AccountNum1|
INS|2,-
RE
-
0047210
RMV|
The RMV| is used to remove a string of the first keyword marker. There must be two values after the pipe "|" separated by a comma ",". The first value should be the start index of where to remove the text. The second value is the length or, how many characters to remove.
Sample
Result (RE0047210)
AM|AccountNum1|RMV
|2,2
RE47210
Special Scenarios
Any PDF Template Description with the phrase "- Custom" uses a custom version of these keywords. If this needs to be troubleshooted or modified, please research the logic in code or reach out to an IT resource to assist.
Several billers using BSA have PDF extractions use the AM| markers and no other keyword. This is because there is special logic for BSA billers where we automatically look for the account number and nothing else. Note. Conjunction keywords can be used with these extractions.
﻿
 URL:/spaces/Implementa/pages/4253384745/PDF+Extraction+Setup
Staging Process
: Once 
PdfQueueByFilename
 
loads extracted pdfs to biller blob path (
ic-pdf-<bid>
) and then creates a new DB row in 
BillerPendingPdfs 
with the following fields: 
(BillerPendingPdfID,BillerPendingPdfGUID,BillerID,Filename,AccountNumber,InvoiceNumber,BillerPdf,PDFSearchMethodID,GroupID,FlagForDelete,DateRecAdded)
 
Universal PDF Extraction Requirements:
Invoice format id must be set to use PDF Extraction -- 
Invoices
.
InvoiceFormatID
=18 
Customer and Invoice records must be set to active -- 
Customers
/
Invoices
.
Active
=1 
 
PDFQueue_MonitorTT: Timer Triggered (20 min intervals) Azure Function
 
Runs MultiShard SP 
selPendingPDF_Billers 
against master shard and delegates a queue trigger to run based on QueueNumber/QueueName 
QueueNumber | QueueName 
1 | pdfqueue-invoicenumber 
2 | pdfqueue-accountnumber 
3 | pdfqueue-linkpdfs 
The QueueName is the designated queue path and the resulting QueueMessage is delivered to the queue based on QueueName. The process uses the classes CloudQueue & CloudQueueMessage from the legacy SDK Microsoft.Azure.Storage.Queue 
 
 
PDFQueue_UpdateInvoiceNumberQT: Queue Trigger("pdfqueue-invoicenumber")
 
Runs 
spProcessPdfQueueByFilenameInvoiceNumberRenameByGroupID 
to set the 
InvoiceNumber 
based on the most recent invoices that contain the 
CustomerID 
associated with the 
AccountNumber 
Lookback period:  (
default 20 day lookback period on biller shards
) 
Converts string value 'InvoiceNumber' to the 
InvoiceNumber
 
value identified in the DB based on 
AccountNumber 
and 
BillerID
. 
Once a new invoice number is set, the 
pdf.BillerPendingPdfs
 row associated with the PDF is updated to include a valid invoice number in the 
FileName
 
and 
InvoiceNumber
 
columns 
Filename
 column rename example 
Before:  00010101_InvoiceNumber 
After:  00010101_202412-00010101 
InvoiceNumber
 
column rename example 
Before:  InvoiceNumber 
After:  202412-0010101 
 
PDFQueue_UpdateAccountNumberQT: Queue Trigger("pdfqueue-accountnumber")
 
Runs 
spProcessPdfQueueByFilenameAccountNumberRenameByGroupID 
to set the 
AccountNumber
 
based on the most recent invoices that contain the 
CustomerID
 
associated with the 
InvoiceNumber
 
Lookback period: (
NA
)  
Converts string value 'AccountNumber' to the 
AccountNumber
 
value identified in the DB based on 
CustomerID 
associated with the 
InvoiceNumber 
and bid. 
Once a new account number is set, the 
pdf.BillerPendingPdfs
 row associated with the PDF is updated to include a valid account number in the 
FileName
 
and 
AccountNumber
 
columns 
Filename
 
column rename example 
Before:  AccountNumber_202412-00010101 
After:  00010101_202412-00010101 
InvoiceNumber
 
column rename example 
Before:  AccountNumber 
After:  00010101 
PDFQueue_LinkPDFsQT: Queue Trigger("pdfqueue-linkpdfs")
 
Runs 
spProcessPdfQueueByFilenameByGroupID
 
based on the 
PDFLinkingModeID
 set in the biller's 
dbo.IntgInvoiceSummary
 table.  
PDFLinkingModes: 
1 (default) Link Pdf with no overwrite 
Only links if 
PDFToken
 
is '' or null 
2 Link Pdf with overwrite 
Will overwrite existing 
PDFToken
 
value 
3 Link Pdf with overwrite on semi-annual installments 
Links a single PDF to multiple installments based on 
BillerInstallmentNumber
 
Installment 1 or 2 will contain the same pdf 
Installment 3 or 4 will contain the same pdf 
4 Link Pdf with overwrite on annual installments 
Links a single PDF based on matching 
BillerBillYear
, 
BillerInvoiceNumber
 and a 
BillerInstallmentNumber 
!= 0.  
Each PDFLinkingMode will update the relevant Invoice Records 
PdfToken
 
field to the 
 
BillerPendingPDFGUID
 value in the 
BillerPendingPdfs
 
table.  
 
 URL:/spaces/IM/pages/3828678691/PDFQueues
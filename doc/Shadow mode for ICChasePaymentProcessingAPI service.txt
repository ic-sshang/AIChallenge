Overview
Shadow Mode is a feature that allows the ICChasePaymentProcessing API to execute all business logic and database operations while bypassing external Chase payment processor calls, i.e. it does not imply the actual money movement.
This enables comprehensive testing, development, and debugging of early issues without performing the actual money movement. Throughout this doc we will be referring to Real Mode as the mode where we execute the entire flow which involves the actual money movement by calling the Chase endpoint.
Purpose
The purpose of shadow mode is to:
call the main routes of ICChasePaymentProcessingAPI alongside Orbital, ensure that we do not break the existing workflows (try-catch blocks on the caller, in our case CTP) and log the payload and the result and emit the necessary metrics to monitor and catch issues early on
ensure that ICChasePaymentProcessingAPI can handle the load when called from CTP on the main routes and define its scaling profile based on that
ensure the correctness for the flows for ICChasePaymentProcessingAPI
prepare to handle operations for ICChasePaymentProcessingAPI
How It Works
Activation
Shadow Mode is activated via HTTP header, which is passed by the callers:
ShadowMode: true
We do not want to clutter the API contracts with the 
ShadowMode
 flag, since we will need to forever support it.
This document assumes that the exact mechanism of configuring the shadow mode falls on the caller and that will be explored in a separate document.
Request Flow
HTTP Request → Controller → Validation → Handler → [Shadow Mode Check] → Business Logic → Database Operations → [Mock Chase Response] → Response
Real Mode vs Shadow Mode
Component
Real Mode
Shadow Mode
HTTP Header Validation
 
✅ Required 
✅ Required 
Request Validation
 
✅ FluentValidation 
✅ FluentValidation 
Database Operations
 
✅ Insert/Update 
✅ Insert/Update 
Business Logic
 
✅ All processing 
✅ All processing 
Chase Client Calls
 
✅ Real API calls 
❌ Bypassed, or we call the test endpoint 
Response Generation
 
✅ Real Chase data 
✅ Mock Chase data 
Audit Logging
 
✅ Full logging 
✅ Full logging + Shadow indicator 
Implementation Details
1. HTTP Header Processing
c#
// In controllers or middleware
bool shadowMode = Request.Headers.ContainsKey("ShadowMode") && 
                 Request.Headers["ShadowMode"].ToString().ToLower() == "true";
2. Handler-Level Integration
c#
// In payment handlers
if (shadowMode)
{
    // Generate mock Chase response; can call mockedChaseClient here as well
    string mockChaseTransactionId = GenerateMockChaseTransactionId();
    _logger.LogInformation("Shadow Mode: Mocking Chase response for {PaymentReferenceId}", payment.PaymentReferenceID);
    return mockChaseTransactionId;
}
else
{
    // Real Chase client call
    return await _chaseClient.AuthorizePaymentAsync(payment, cancellationToken);
}
3. Mock Response Generation
c#
private string GenerateMockChaseTransactionId()
{
    return $"SHADOW_{Guid.NewGuid():N}";
}
Supported Operations
Shadow Mode will be used for all of the main routes, which are
sale - when we execute sale, we must pass ShadowMode flag on if we want to have the entire flow to be executed in ShadowMode. When on, the payment record will get created and its ID will get added to 
TestPayments
 reference table. The presence of the record in 
TestPayments
 is the indicator that the workflow for the particular item is indeed shadow mode.
void - no matter if ShadowMode flag is passed or not, we execute the DB operation, verify that the payment record was in shadow mode and only then not call Chase for CC. Otherwise we call Chase irrespective of the header.
refund - no matter if ShadowMode flag is passed or not, we execute the DB operation, verify that the payment record was in shadow mode and only then not call Chase for CC. Otherwise we call Chase irrespective of the header.
Logging and Monitoring
Shadow Mode Logging
c#
_logger.LogInformation("Shadow Mode enabled for {Operation} - {PaymentReferenceId}", 
    operation, paymentReferenceId);
Audit Trail
Operation Type
: RealMode vs ShadowMode
Mock Data
: Clearly marked in audit logs
Performance
: Track shadow vs real response times
Monitoring Metrics
Shadow Mode Usage
: Track frequency and patterns
Response Times
: Compare shadow vs real performance
Error Rates
: Monitor shadow mode error patterns
Configuration
TBD as part of integration with CTP.
Rollout Strategy
Enable shadow mode for one internal test biller and perform sale/void/refund operations to catch early bugs.
Enable shadow mode for one small active biller. Keep monitoring for issues and do bug fixing.
Enable shadow mode for one large active biller. Monitor for issues and do bug fixing as needed.
Gradually enable shadow mode for all active billers, which use Chase as the terminal for ACH/CC.
At any point in time we should be able to quickly turn off ICChasePaymentProcessingAPI route execution for one/all billers without the need for deployment (aka pulling Andon cord).
Error Handling
Error handling for shadow mode will not differ from handling in real mode when it concerns ICChasePaymentProcessingAPI. The only difference will be that for shadow mode there will be additional logs/traces/metrics emitted.
 URL:/spaces/EA/pages/4533485709/Shadow+mode+for+ICChasePaymentProcessingAPI+service
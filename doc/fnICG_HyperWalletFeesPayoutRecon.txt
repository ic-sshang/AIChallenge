Basically this azure function gets records from TransActivity_DetailImport table for over a period of days and prepares a csv file. This file is then uploaded to the azure blob storage and sent in email to the configrued email addresses.
Program also has a HTTP Triggered function (for the same functionality) which accepts a date as an argument, this date argument can be used to test the functionality on any day, function will consider the passed date as current date.
(This was implemented as part of BRAIN-139 to make the functionality testable on any day based on the date argument).
Stored Procedure
Test DB
Description
selTerminalTransActivity
ICG_Test
Gets data from the  
TransActivity_DetailImport 
table based on the CompareDate, Terminal Type Id, Terminal Id, TransactionType, Short Description and InternalUse.
The CompareDate is calculated based on the DaysBack passed to the SP.
DaysBack and TerminalTypeId are mandatory. Others are optional parameters.
selFundingBatchByDate
ICG_Test
Gets Data from the 
FundingBatches 
table based on CompareDate, ServiceFeeBatch, DebitAmount, TerminalID, FundingBatchID.
The CompareDate is calculated based on the DaysBack parameter passed to the SP.
Only CompareDate is mandatory, other parameters are optional.
selICGRecon_BatchConvFeeTotals
ICG_DW
Process
Get WD_PPAAP transaction records over the past daysback number of days from TransActivity_DetailImport table (using selTerminalTransActivity).
 URL:/spaces/ED/pages/2625798163/fnICG_HyperWalletFeesPayoutRecon
1
6
false
default
list
true
Overview
Type or paste something here to turn it into an excerpt.
Due to costing aspects of the Kong license, it was determined that Kong is not a viable Router for all of InvoiceCloud Network Traffic.  We still plan on using Kong as an API Developer Portal and API specific Routes when we Productize our APIs.  However we will replace Kong as the Primary traffic router with Azure App Gateway.
Diagram
The same Network Topology will be used for both the NonProd and Prod Network Lanes.
Stage 1
Go-Live on 7/14/2024
1
0
0
3344498693
3312353302
1
kong-stage-1.drawio.svg
3
0
10
https://invoicecloud.atlassian.net/wiki
kong-stage-1.drawio.svg
1
oARx2cA5TwcqSpZ-VeZQ 1
1220
auto
top
1
709.5
Stage 2
Planned Go Live on 9/8/2024
Route 
api.invoicecloud.com
 thru Kong
1
0
0
3506798705
3312353302
1
app-gateway-and-kong-stage-2.drawio.svg
2
0
2
https://invoicecloud.atlassian.net/wiki
app-gateway-and-kong-stage-2.drawio.svg
1
oARx2cA5TwcqSpZ-VeZQ 1
277
auto
top
1
591.5
Stage 3 and beyond
Planned go-live on TBD.  We will look to deploy APIs one at a time to minimize blast radius.
1
0
0
3505979459
3312353302
1
app-gateway-and-kong-stage-3-and-beyond.drawio.svg
1
0
1
https://invoicecloud.atlassian.net/wiki
app-gateway-and-kong-stage-3-and-beyond.drawio.svg
1
oARx2cA5TwcqSpZ-VeZQ 1
217
auto
top
1
592
Monthly Cost Projection
Follow 
this link to the monthly cost projection for App Gateway
 usage at InvoiceCloud including both NonProd and Prod instances supporting those distinct network lanes.
App Gateway Entities
Below are the App Gateway Entities used to setup the Routing
Front End Port
Configures Ports that can be used to enable transit thru the App Gateway.
Used in combination with a Front End Port in a Listener enabling incoming traffic to be identified and routed by the App Gateway.
Current Ports enabled are 
443
 and 
80
.
Front End IP
Configures Public and Private IP Addresses that can be used to enable transit thru the App Gateway.
Used in combination with a Front End IP in a Listener enabling incoming traffic to be identified and routed by the App Gateway.
At least one Public IP is required however it is not configured in any routes so it goes nowhere.
We also have a single Private IP Address to which Palo Alto will forward all traffic per Network Lane.
SSL Certificate
Reference to a TLS Certificate stored in a KeyVault and used for TLS/SSL client handshakes.
Can be configured in a Listener to enable the Listener to server HTTPS traffic.
We currently support the following Certificates:
 Production
*.invoicecloud.com
invoicecloud.com
www1.mcc.net
NonProd
*.invoicecloud.com
invoicecloud.com
*.invoicecloud-beta.com
HTTP Listener
A combination of Front End Port, IP, and a list of Hostnames used to monitor for incoming traffic that needs to be routed to one of the Backend Address Pool.
Backend Address Pool
A set of IP Addresses or FQDNs to which traffic will be routed from the Listeners via Routing Rules.
Probe
A custom probe used to monitor and determine the health of the Backends configured within a given Backend Address Pool. 
Backend HTTP Settings
A set of settings used when traffic is forwarded to the Backends configured in a given Backend Address Pool.
Hostname if different than the Hostname coming in on the Listener.
Path if needed to be different or augmented from the Path coming in on the Listener.
Port
Protocol
Request Timeout
Use Cookie Based Affinity
Probe to use to monitor backend health
Redirect Configuration
Allows for redirecting traffic at the App Gateway Network Plane.
Used for HTTPS redirects for HTTP traffic for certain Listeners. 
Request Routing Rule
URL Path Map
Rewrite Rule Set
App Gateway Instances
Prod
NonProd
Azure DevOps
Repo:  
AppGateway_Infrastructure - Repos (azure.com)
Apply Pipeline: 
Pipelines - Runs for AppGateway_Infrastructure Apply (azure.com)
Destroy Pipeline: 
Pipelines - Runs for AppGateway_Infrastructure Destroy (azure.com)
Observability
NewRelic Dashboards
Prod
NonProd
NewRelic Alerts
Prod
References
What is Azure Application Gateway v2? | Microsoft Learn
https://learn.microsoft.com/en-us/azure/application-gateway/application-gateway-metrics
 
https://learn.microsoft.com/en-us/azure/application-gateway/high-traffic-support#alerts-for-application-gateway-v2-sku-standard_v2waf_v2
Diagnostic logs - Azure Application Gateway | Microsoft Learn
 
Microsoft Azure Well-Architected Framework review - Azure Application Gateway v2 - Microsoft Azure Well-Architected Framework | Microsoft Learn
Azure Application Gateway - List of Failed Requests | Abhith Rajan
Analyze usage in a Log Analytics workspace in Azure Monitor - Azure Monitor | Microsoft Learn
 URL:/spaces/platform/pages/3312353302/Azure+App+Gateway
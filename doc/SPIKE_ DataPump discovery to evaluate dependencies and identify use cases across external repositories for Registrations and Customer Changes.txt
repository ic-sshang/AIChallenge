Description
As part of this spike analysis below data pump type (transaction type)
Registrations
Customer Changes
Expected Outcome
Analysis is document in confluence
Flow
Repo / code file
Dependencies
Repositories
MyIIS.
DataPump.
Biller Portal.
SkyBots:
RegisterCustomers
RegisterPaperless
RegisterAutopay
Stored Procedure: 
The below SP is used to insert the data into 
DataPump
 table.
insDataPump
Registrations:
 
There are types of Registrations are present the below confluence link refers the different types of Registrations.
Customer Registration: 
Please go through the below link,
 
Customer Portal - Customer Registration - SRE - Confluence
Path: 
…….
.\repos\MyIIS\MyIIS\2\CustomerRegistration.aspx.vb
Path: 
………….
\repos\MyIIS\MyIIS\App_Code\2\clsCustomerRegistrationBase.vb
AutoPay Registration:
AutoPay - Registration - Payer - SRE - Confluence
C:\Users\YaminiArumilli\source\repos\MyIIS\MyIIS\2\AutoPay.aspx.vb
AutoPay - Registration - Biller - SRE - Confluence
Follow the same flow as above. But the user login through Biller Portal.
Same as above process.
AutoPay - Registration - API - SRE - Confluence
………….\source\repos\MyIIS\MyIIS\App_Code\CloudManagement.vb
The CloudManagement.vb file implements a SOAP web service for your application, providing a set of methods that allow external systems (or other parts of your platform) to manage customer accounts, AutoPay, and Paperless enrollment.
PaperLess Registration:
Paperless Registration - Payer Portal - SRE - Confluence
Trigger: 
[mcl].[trgCustomers]
This trigger ([mcl].[trgCustomers]) automatically logs customer updates to the DataPump table after any update to the [mcl].[Customers] table, but only if the biller is configured to track customer changes.
Trigger Activation
•	The trigger fires AFTER an UPDATE on the [mcl].[Customers] table.
Variable Declaration
•	Declares variables to hold:
•	@BillerID: The biller associated with the customer.
•	@CustomerChanges: A flag indicating if the biller wants to track customer changes.
•	@CustomerID: The ID of the updated customer.
Assign Values
•	Uses a SELECT statement joining the inserted pseudo-table (which contains the new values after the update), Customers, and BillerDataPumpConfig to assign values to the variables.
Conditional Insert
•	Checks if @CustomerChanges = 1 (i.e., the biller is configured to track customer changes).
•	If so, inserts a record into the DataPump table with:
•	DataPumpTypeID = 5 (indicating a customer change event)
•	The Biller ID
•	The Customer ID
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
ALTER TRIGGER [mcl].[trgCustomers]
ON [mcl].[Customers]
AFTER UPDATE
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE 
		@BillerID int
		,@CustomerChanges bit
		,@CustomerID int

	--Assign data to the variables.  
	SELECT 
		@BillerID = C.BillerID
		,@CustomerChanges = B.CustomerChanges 
		,@CustomerID = I.CustomerID
	FROM
		inserted I
		Inner Join Customers C on I.CustomerID = C.CustomerID
		INNER JOIN BillerDataPumpConfig B ON C.BillerID = B.BillerID 

	--Add the data to the datapump if the biller is configured to have customer updates delivered.  It is the same insert for both tables
	IF @CustomerChanges = 1
	BEGIN
		INSERT INTO DataPump (DataPumpTypeID,BillerID,FKID) SELECT 5,@BillerID,@CustomerID
	END
END;
Customer Change:
 
Path: 
repos\MyIIS\BillerPortal\BillerCustomerProfile.aspx.vb
Purpose
This method is triggered when the user clicks the "Update" button(s) on the customer profile page. It handles updating the customer's profile information, including address, phone, payment block settings, and login details (such as email address and opt-out status).
Step-by-Step Breakdown
Form Validation
•	The method first calls ValidateForm(). If the form is not valid, it exits without making any changes.
Customer Object Preparation
•	A new Customer object is created and assigned from the current session.
•	If the address fields are visible, it updates the customer's address, city, state, and zip code from the form inputs.
•	If the phone field is visible, it updates the customer's phone number.
•	Updates payment block settings (BlockPaymentsCC, BlockPaymentsEFT) from the form.
•	Updates the session with the modified customer object.
Persist Customer Changes
•	Calls UpdateCustomer to save the changes to the database.
Login Information Update (Single Customer Panel)
•	If the single customer panel is visible:
•	Stores the current login email, courtesy email, and opt-out status for comparison.
•	If the email address has changed and the customer has linked accounts, and a dialog is not already open, it shows a dialog to confirm the change and exits.
•	If any login info (email, courtesy email, opt-out) has changed:
•	Prepares flags for what needs updating.
•	Loads the new values from the form into the customer object.
•	Calls UpdateLogin to persist login changes.
•	If there is an error, shows the error message, restores previous values, and exits.
•	If successful, updates the session with the new customer object.
Trigger DataPump Sync
•	
If the customer object is not Nothing (i.e., update succeeded),
 calls
 
to synchronize the customer changes with external systems (DataPump), ensuring downstream systems are updated.
Inserting the Record for customer change into DataPump Table
Path: 
repos\MyIIS\BillerPortal.Business.VisualBasic\Repositories\RealTimeDataRefreshRepository.vb
Step-by-Step Explanation
Function Purpose
•	This function is used to synchronize customer status changes (such as registration or profile updates) with an external system called DataPump, but only if the biller's configuration allows it.
Parameters
•	billerID: The unique identifier for the biller.
•	customerID: The unique identifier for the customer.
•	registered: Boolean indicating the customer's registration status.
•	optionalDescription: An optional string for additional information about the change.
Initialization
•	retval is set to False and will be returned at the end.
•	dt is a DataTable for holding configuration data.
•	dataPumpRepo is an instance for interacting with the DataPump system for the specified biller.
Configuration Check
•	The function executes the stored procedure selBillerDataPumpConfig to get the DataPump configuration for the given billerID.
•	If configuration data is found (dt.Rows.Count > 0):
•	Checks if the CustomerChanges column is True (i.e., the biller is configured to sync customer changes).
Insert DataPump Record
•	If syncing is enabled, calls DataPumpRepository.InsertDataPump with:
•	DataPumpType.Registrations (indicating a registration or customer change event)
•	The biller and customer IDs
•	The registered status
•	The optional description (optionalDescription)
Error Handling
•	If an exception occurs, it logs detailed information to a file for diagnostics.
•	Also logs the error using Serilog for centralized logging.
Return
•	Returns retval (always False in the current implementation).
 URL:/spaces/PE/pages/4494327813/SPIKE+DataPump+discovery+to+evaluate+dependencies+and+identify+use+cases+across+external+repositories+for+Registrations+and+Customer+Changes
Sequence
CRM
RAW MOCKUPS
Default View
All Billers should have the first row be the 
invoicecloud.net
 domain, which is the default domain used by our system.  
Adding Domain / Editing Domain
After button is clicked I’m thinking we go back to the parent page and instruct user to click View DNS Settings to get the info to share with the Biller.  We can save a click by redirecting user to the View DNS Settings page from here if we’re adding a New Domain.  Also, on Edit we should disable the Send Email Domain.  If they want to change the text, they should go create a new domain as it will likely require DNS set up again.
View DNS Settings for Domain
These grids are cropped from the Mailgun DNS Settings view.  We want to display the same data.  In addition we might want to add a column showing the current value we see, which is not displayed on the Mailgun grids.
Backend Work
Determine what domain we should use when sending email
Need shard-level table
ID, DomainName, InvoiceTypeID, KeyVaultKeyNameForAPIKey (BID_EmailQueueTypeID)
Send email using desired domain name
Update ICFramework.Utilities.Email
Ability to send email using API for Mailgun Integration with support for passed in biller domain information
Keep SMTP integration for existing traffic
In cases where emails bounce
Update ICFramework.Email to support pulling bounce list by domain
Currently only supports pulling bounces through app config value
Update 
spProcessBouncedEmailAddress
 to support accepting the domain the email bounced through
Should probably be the ID from the biller domains table
BouncedEmailAddress table should be updated to store this value
Update BouncedEmailMonitor to use latest of ICFramework.Email to pass the domains as needed when pulling bounce data
Update BouncedEmailMonitor to pass the bounced domain to 
spProcessBouncedEmailAddress
Update BouncedEmailProcessing
Review 
updBouncedEmailAddress
to ensure that it supports same email existing across multiple Billers but only 1 actually bouncing
Update as needed
In cases where we receive complaint
Update 
MCL.spProcessSmtpComplaint
 to support saving the source biller domain of the complaint
Update 
EmailDoNotSend
 table to have a foreign key reference to the biller domain table
Review 
MCL.spProcessSmtpComplaint
 to ensure that it supports same email existing across multiple Billers but only 1 actually complaining
Update MailgunSpamComplaints
Update to pull complaints from new biller domains as well
Currently pulls via config value
Update MailgunDeclineMonitor to support the source biller domain to get the failed emails list
Update to pull complaints from new biller domains as well
Currently pulls via config value
Update EmailQueueProcessor and EmailQueueProcessing 
Use latest of 
ICFramework.Utilities.Email
Pass the BillerID/Biller Domain
Unsubscribe?
Reporting
CRM
Viewing Logs
Update ICFramework.Email
Update 
EmailLogs
 to support pulling from the new biller domains as well
Update CRM
Have latest version of ICFramework.Email
Update ToolEmailLogs class to pass EmailDomain to ICFramework.Email.EmailLogs method
Taking action on a bounced and/or complaint email address
Update ICFramework.Email
Update 
EmailAddressInBounceList
 to support checking the bounce list by domain or make sure it checks all supported domains
Update 
RemoveFromBounceList
 to support removing from biller domains as well, or support passing it in
Update 
EmailAddressInComplaintsList
 
to support checking the complaint list by domain or make sure it checks all supported domains
Update 
RemoveFromSpamComplaints
 to support removing from biller domains as well, or support passing it in
Update CRM
Have latest version of ICFramework.Email
Biller Portal
Have latest version of ICFramework.Email
Update btnRemove_Click method to pass billerDomainId to RemoveFromSpamComplaints
 will look up other pages in use against mailgun API
 URL:/spaces/EA/pages/4063952939/Sending+Emails+from+Biller+Domains+Implementation+Plan
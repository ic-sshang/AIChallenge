1
6
false
default
list
true
7/15/2024
Seeing 
/robots.txt
 scans, we should setup one for 
www.invoicecloud.com
 and things like that.
Action Items
 Look into Spike of Thruput observed in App Gateway
 Follow up with 
 and 
 on 
payer-v3-iat.invoicecloud.com
7/16/2024
 are we seeing any traffic coming thru Barracuda?
WAF: Seeing traffic from IP 
10.152.98.5
 which is a new Build Server 
IC-BuildA-Dev2
.  Note that some of the build pipelines try to update the host file, so this is a good candidate for root cause.  Barracuda Load Balancer IP 
10.0.3.20
 
 any ideas on this?
Firewall: Internal Traffic is being seen on this 
 please prioritize this cleanup as we would like to get these VMs deallocated.
 check-in on AlienVault Logs.
Events are seen in Event Hub from App Gateway.  However, AlienVault is not seeing/processing them as expected.  
 to create a ticket with AlienVault support to investigate.
 and 
 
payer-v3-iat.invoicecloud.com
 is paired with UAT testing with MyIIS hosted on 
cert.invoicecloud.com
.  Do we need to continue to support this?  If so, we will need to schedule a DNS change and enable this in NonProd App Gateway.
Waiting on response from 
 
 Costing check-in.
Current projected cost for half month is $453, so projected for full month is ~$1,000 (including Log Analytics Workspace), so we are right on target.
44543.8153.81
 found that 
/portaldev3/
 is configured in PSN DB
7/17/2024
PSN 400s from ICG issue is reported to be resolved 
 
Lessons Learned:
PSN has a custom implementation of the 
IClient
 they use with the 
IC.Gateway
 SDK which is loosely based on the InvoiceCloud Implementation.  A good place to look to update when we face connectivity and/or request/response issues between PSN and InvoiceCloud.
The ICGateway 2 and 3 Prod Servers did not have their NewRelic Logging Configuration correct which reduced our observability abilities to correlate requests and responses we are logging.
 to remediate tonight around 8 PM Eastern Time.
To find failed batch inquiries, go to NewRelic’s Log page, and use the search terms 
"INQUIRY FAILED"
.  This will provide a list of responses to which we need to research.  Click on the results and find records that have the 
RequestId
 field present.  Use that 
RequestId
 value to correlate the failure response with the initial request.  Use the Body of the Request and Response as data points to investigate further.
Now that all Production (and NonProduction) traffic is going thru Cloudflare, if we provide the 
accept-encoding
 Header in our request, our software must be ready to process the encoding algorithm provided in the Response (Response Headers will indicate which Encoding Algorithm was used).
We saw a spike of 5XXs twice today:
between (todatetime("7/17/2024, 7:19:00.000 PM") .. todatetime("7/17/2024, 7:24:00.000 PM"))
 UTC
All were Status Codes from the Backend Servers
Seems this URL was the main offender (95% of Errors)
: 
www.invoicecloud.com/remoteauthenticationapi/user/RetrieveUsers
 
 
 which team handles the App mentioned above?  They should be made aware of this spike.
Error Found, was this a DB connectivity issue?  Should the app throw a 500 when no DataRows are returned?
error.message:The source contains no DataRows.
error.stack:	   at System.Data.DataTableExtensions.LoadTableFromEnumerable[T](IEnumerable`1 source, DataTable table, Nullable`1 options, FillErrorEventHandler errorHandler) 
	   at System.Data.DataTableExtensions.CopyToDataTable[T](IEnumerable`1 source) 
	   at ICRemoteAuthenticationAPI.CustomerLogin.CreateRetrieveUsersResponse(RetrieveUsersRequest retrieveRequest) in C:\agent\A4\_work\34\s\ICRemoteAuthenticationAPI\Models\CustomerLogin.vb:line 33 
	   at ICRemoteAuthenticationAPI.Controllers.UserController.RetrieveUsers(RetrieveUsersRequest retrieveRequest) in C:\agent\A4\_work\34\s\ICRemoteAuthenticationAPI\Controllers\UserController.vb:line 71
between (todatetime("7/17/2024, 2:27:00.000 PM") .. todatetime("7/17/2024, 2:57:00.000 PM")) UTC
All were Status Codes from the Backend Servers, except 1 which the backend Server or the Client forcefully closed the connection.
Example query to use if interested to investigate (remove line 4 to see all Failure Records)
AGWAccessLogs
| where TimeGenerated between (todatetime("7/17/2024, 7:19:00.000 PM") .. todatetime("7/17/2024, 7:24:00.000 PM"))
| where HttpStatus > 499
| where HttpStatus != ServerStatus
Spike in Time Taken between 
between (todatetime("7/17/2024, 5:05:00.000 PM") .. todatetime("7/17/2024, 5:35:00.000 PM"))
 UTC
Analysis shows this was driven by long running Backend Server operations
AGWAccessLogs
| where TimeGenerated between (todatetime("7/17/2024, 5:05:00.000 PM") .. todatetime("7/17/2024, 5:35:00.000 PM"))
| where TimeTaken > 4
| project TimeTaken, ServerResponseLatency, Host, RequestUri, ReceivedBytes, SentBytes, ServerRouted, ServerStatus, TimeGenerated
| order by TimeTaken desc 
7/18/2024
There is a discrepancy of Logging for the 
/remoteauthenticationapi/
 , Web 6 provides Error Message and Stack Trace Details.  All other Webs do not
 
 
 please address this logging discrepency.
7/19/2024
We saw a spike in 500s 
between (todatetime("7/18/2024, 6:41:00.000 PM") .. todatetime("7/18/2024, 7:11:00.000 PM"))
 UTC
Seems this URL was the main offender (95% of Errors)
: 
www.invoicecloud.com/remoteauthenticationapi/user/RetrieveUsers
Errors Observed
error.message:Unrecognized Guid format.
error.stack:	   at System.Guid.GuidResult.SetFailure(ParseFailureKind failure, String failureMessageID, Object failureMessageFormatArgument, String failureArgumentName, Exception innerException) 
	   at System.Guid.TryParseGuid(String g, GuidStyles flags, GuidResult& result) 
	   at System.Guid..ctor(String g) 
	   at ICRemoteAuthenticationAPI.WebServicesLogging.validateGUID(String DataToValidate) in C:\agent
error.message:Value cannot be null.
Parameter name: source
error.stack:	   at System.Linq.Enumerable.Count[TSource](IEnumerable`1 source) 
	   at ICRemoteAuthenticationAPI.CustomRedirectHttpModule.GetBiller(HttpApplication context) in C:\agent\A4\_work\34\s\ICRemoteAuthenticationAPI\Modules\CustomRedirectHttpModule.vb:line 202
AGWAccessLogs
| where TimeGenerated between (todatetime("7/18/2024, 6:41:00.000 PM") .. todatetime("7/18/2024, 7:11:00.000 PM"))
| where HttpStatus > 499
| project HttpStatus, ServerStatus, TimeTaken, ServerResponseLatency, HttpMethod, Host, RequestUri, ReceivedBytes, SentBytes, ServerRouted, TimeGenerated
| summarize count() by HttpStatus, ServerStatus, HttpMethod, Host, RequestUri 
Barracuda WAF Firewall VM Deallocate 
 
Has this been done yet?
Barracuda L3 Firewall Traffic Evaluation - Infrastructure Documentation - Confluence (atlassian.net)
Follow up:: on large StratusWebService File giving 302 that is driving Throughput (and hence Capacity Unit Consumption) spikes.
 any word from 
 team?
Follow up:: 
 check-in on AlienVault Logs.
Follow up:: 
 and 
 
payer-v3-iat.invoicecloud.com
 is paired with UAT testing with MyIIS hosted on 
cert.invoicecloud.com
.  Do we need to continue to support this?  If so, we will need to schedule a DNS change and enable this in NonProd App Gateway.
 URL:/spaces/platform/pages/3396403203/Meetings+App+Gateway+7+15+-+7+19
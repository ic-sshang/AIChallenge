IC.Azure.Blob Library Developer Guide
Table of Contents
Introduction
Installation
Configuration
Storage Types
Basic Usage
Working with Biller PDFs
Working with Biller Images
Working with Zip Archives
Working with Stratus Files
Working with Secure Upload Files
Generic Storage Operations
Shared Access Signatures (SAS)
Error Handling
Best Practices
Examples
Introduction
IC.Azure.Blob is a .NET Framework 4.8 library that provides a simple and efficient way to interact with Azure Blob Storage. This library encapsulates common Azure Blob Storage operations, offering specialized methods for different storage needs like PDF files, images, archives, and secure file uploads.
This library abstracts away many of the complexities of working directly with Azure Blob Storage APIs while providing specific functionality for different business scenarios. It leverages the Microsoft Azure Storage SDK and integrates with Azure Key Vault for secure connection string management.
Installation
NuGet Package
Add a reference to the IC.Azure.Blob library in your project.
xml
<PackageReference Include="IC.Azure.Blob" Version="X.Y.Z" />
Dependencies
.NET Framework 4.8
Microsoft.WindowsAzure.Storage
IC.Azure.KeyVault (For secure connection string retrieval)
IC.Interfaces
Configuration
Initialize the Azure Key Vault Reader
Before using the AzureBlobService, you must set the Key Vault reader to access your storage connection strings:
c#
// Create a Key Vault reader (replace "yourKeyVaultName" with your actual Key Vault name)
var keyVaultReader = KeyVaultReader.CreateFromDefaultIdentity("yourKeyVaultName");

// Set the vault for the AzureBlobService
AzureBlobService.SetVault(keyVaultReader);
Connection Strings
Connection strings are stored in Azure Key Vault with naming convention:
StorageTypeConnectionString{StorageTypeName}
For example, for 
StorageType.BlobStorage
, the key in Key Vault would be 
StorageTypeConnectionStringBlobStorage
.
Storage Types
The library defines several storage types to organize different kinds of data:
c#
public enum StorageType
{
    NONE = 0,
    Generic = 1,
    Stratus = 2,
    VendorPDFArchive = 3,
    SecureUpload = 4,
    BlobStorage = 5,
    Logs = 6,
    SQLImportFiles = 7,
    OutboundPayments = 8,
    AutoPaySecureUpload = 9,
    ICGateway = 10
}
Each storage type corresponds to a different Azure Storage account connection string that is retrieved from the Key Vault.
Basic Usage
Creating an Instance of AzureBlobService
c#
// After setting up the Key Vault reader
var blobService = new AzureBlobService();
Common Operations
The library provides methods for the following common operations:
Upload files (from path, byte array, or stream)
Download files (as byte array or stream)
Delete files
List files
Check container existence
Generate Shared Access Signatures (SAS)
Working with Biller PDFs
PDFs are stored in containers with naming convention 
ic-pdf-{BillerID}
.
Upload a PDF
c#
// Upload from file path
bool success = blobService.SaveBillerPDF(billerId, "C:/path/to/file.pdf", "filename.pdf");

// Upload from byte array
byte[] fileBytes = File.ReadAllBytes("C:/path/to/file.pdf");
bool success = blobService.SaveBillerPDF(billerId, "filename.pdf", fileBytes);

// Upload from stream
using (var fileStream = new FileStream("C:/path/to/file.pdf", FileMode.Open))
{
    bool success = blobService.SaveBillerPDF(billerId, "filename.pdf", fileStream);
}
Download a PDF
c#
// Get PDF as byte array
byte[] pdfBytes = blobService.GetBillerPDF(billerId, "filename.pdf");

// Get PDF as stream
using (var pdfStream = blobService.GetBillerPDFStream(billerId, "filename.pdf"))
{
    // Use the stream
}
Delete a PDF
c#
bool success = blobService.DeleteBillerPdf(billerId, "filename.pdf");
Working with Biller Images
Images are stored in the 
ic-resources
 container.
Upload an Image
c#
// Upload from file path
bool success = blobService.SaveBillerImage("C:/path/to/image.png", "image.png");

// Upload from byte array
byte[] imageBytes = File.ReadAllBytes("C:/path/to/image.png");
bool success = blobService.SaveBillerImage("image.png", imageBytes);
Download an Image
c#
byte[] imageBytes = blobService.GetBillerImage("image.png");
Delete an Image
c#
bool success = blobService.DeleteBillerAzureImage("image.png");
Working with Zip Archives
Zip archives are stored in the 
ic-reporting
 container.
Upload a Zip Archive
c#
// Upload from file path
bool success = blobService.SaveZipArchive("C:/path/to/archive.zip", "archive.zip");

// Upload from byte array
byte[] zipBytes = File.ReadAllBytes("C:/path/to/archive.zip");
bool success = blobService.SaveZipArchive("archive.zip", zipBytes);
Download a Zip Archive
c#
byte[] zipBytes = blobService.GetZipArchive("archive.zip");
Delete a Zip Archive
c#
bool success = blobService.DeleteZipArchive("archive.zip");
Working with Stratus Files
The library supports three types of Stratus files, each stored in a different container:
Stratus Dump files (
ic-stratusdump
)
Stratus Processed files (
ic-stratusprocessed
)
Stratus Export files (
ic-stratusexport
)
Stratus Dump Files
c#
// Save a Stratus dump file
bool success = blobService.SaveStratusDumpFile(billerId, "C:/path/to/file.txt", "file.txt");

// Get a Stratus dump file
byte[] fileBytes = blobService.GetStratusDumpFile(billerId, "file.txt");

// Get a Stratus dump file as stream
using (var stream = blobService.GetStratusDumpFileStream(billerId, "file.txt"))
{
    // Use the stream
}

// Delete a Stratus dump file
bool success = blobService.DeleteStratusDumpFile(billerId, "file.txt");
Stratus Processed Files
c#
// Save a Stratus processed file
bool success = blobService.SaveStratusProcessedFile(billerId, "C:/path/to/file.txt", "file.txt");

// Get a Stratus processed file
byte[] fileBytes = blobService.GetStratusProcessedFile(billerId, "file.txt");

// Get a Stratus processed file as stream
using (var stream = blobService.GetStratusProcessedFileStream(billerId, "file.txt"))
{
    // Use the stream
}

// Delete a Stratus processed file
bool success = blobService.DeleteStratusProcessedFile(billerId, "file.txt");
Stratus Export Files
c#
// Save a Stratus export file
bool success = blobService.SaveStratusExportFile(billerId, "C:/path/to/file.txt", "file.txt");

// Get a Stratus export file
byte[] fileBytes = blobService.GetStratusExportFile(billerId, "file.txt");

// Get a Stratus export file as stream
using (var stream = blobService.GetStratusExportFileStream(billerId, "file.txt"))
{
    // Use the stream
}

// Delete a Stratus export file
bool success = blobService.DeleteStratusExportFile(billerId, "file.txt");
Listing Stratus Files
c#
List<string> fileList = blobService.GetStratusListOfFiles("containerName", billerId, "searchPattern");
Working with Secure Upload Files
Secure Upload files are organized by biller ID and file type. Available file types:
c#
public enum SecureUploadFileType
{
    Other = 0,
    CustomerRegistrations = 1,
    AutoPayRegistrations = 2,
    PaperlessRegistrations = 3
}
Upload a Secure Upload File
c#
byte[] fileBytes = File.ReadAllBytes("C:/path/to/file.csv");
bool success = blobService.SaveSecureUploadFile(
    billerId,
    (int)SecureUploadFileType.CustomerRegistrations,
    "file.csv",
    fileBytes
);
Download a Secure Upload File
c#
byte[] fileBytes = blobService.GetSecureUploadFile(
    billerId,
    (int)SecureUploadFileType.CustomerRegistrations,
    "file.csv"
);
Delete a Secure Upload File
c#
bool success = blobService.DeleteSecureUploadFile(
    billerId,
    (int)SecureUploadFileType.CustomerRegistrations,
    "file.csv"
);
List Secure Upload Files
c#
List<string> fileList = blobService.GetSecureUploadListOfFiles(
    billerId,
    (int)SecureUploadFileType.CustomerRegistrations
);
Find Old Secure Upload Files
c#
// Get files older than 30 days
List<string> oldFiles = blobService.GetSecureUploadFilesOlderThanPassedInDays(
    StorageType.SecureUpload,
    30
);
Generic Storage Operations
The library provides static methods for generic storage operations that work with any 
StorageType
.
List Files in a Container
c#
// List all files in a container
List<string> fileList = AzureBlobService.RetrieveStorageFileList(
    StorageType.Generic,
    "containerName",
    ""  // Empty string for root directory
);

// List files in a specific directory
List<string> fileList = AzureBlobService.RetrieveStorageFileList(
    StorageType.Generic,
    "containerName",
    "directoryName"
);

// List files with a search pattern
List<string> fileList = AzureBlobService.RetrieveStorageFileList(
    StorageType.Generic,
    "containerName",
    "directoryName",
    "searchPattern"
);

// List files with a prefix
List<string> fileList = AzureBlobService.RetrieveStorageFileListByPrefix(
    StorageType.Generic,
    "containerName",
    "prefix/"
);
Upload a File
c#
using (var stream = new MemoryStream(fileBytes))
{
    bool success = AzureBlobService.StoreStorageFile(
        StorageType.Generic,
        "containerName",
        "filePath",
        stream
    );
}
Download a File
c#
using (var stream = AzureBlobService.RetrieveStorageFile(
    StorageType.Generic,
    "containerName",
    "filePath"))
{
    // Use the stream
}
Delete a File
c#
bool success = AzureBlobService.DeleteStorageFile(
    StorageType.Generic,
    "containerName",
    "filePath"
);
Check if Container Exists
c#
bool exists = AzureBlobService.ContainerExists(
    StorageType.Generic,
    "containerName"
);
Shared Access Signatures (SAS)
The library provides methods to generate SAS tokens and URLs for containers and blobs.
Get SAS Token for a Container
c#
string sasToken = AzureBlobService.GetSharedAccessSignature(
    StorageType.Generic,
    "containerName"
);
Get SAS URL with Token for a Container
c#
string sasUrl = AzureBlobService.GetSharedAccessSignatureUrlWithToken(
    StorageType.Generic,
    "containerName"
);
Get Read-Only SAS URL for a Container
c#
string sasUrl = AzureBlobService.GetSharedAccessSignatureUrlWithTokenReadOnly(
    StorageType.Generic,
    "containerName"
);
Get SAS URL for a Specific Blob
c#
string sasUrl = AzureBlobService.GetSharedAccessSignatureUrlForBlob(
    StorageType.Generic,
    "containerName",
    "blobName"
);
Error Handling
Most methods in the library catch exceptions internally and return a boolean value or null to indicate success or failure. It's important to check these return values.
c#
bool success = blobService.SaveBillerPDF(billerId, "C:/path/to/file.pdf", "file.pdf");
if (!success)
{
    // Handle error
}

byte[] pdfBytes = blobService.GetBillerPDF(billerId, "file.pdf");
if (pdfBytes == null)
{
    // Handle error
}
Best Practices
Initialize the Key Vault reader once
 at application startup and reuse it for all Azure Blob operations.
Dispose streams properly
 by using 
using
 statements when working with streams.
Handle null return values
 when retrieving files, as they indicate that the file was not found or an error occurred.
Use appropriate storage types
 for different kinds of data to maintain separation and organization.
Check boolean return values
 from save and delete operations to ensure they completed successfully.
Use the appropriate file retrieval method
 (byte array vs. stream) based on your needs. Streams are more memory-efficient for large files.
Clean up temporary files
 after uploading them to Azure Storage if they are no longer needed.
Use meaningful file names
 to make file management and retrieval easier.
Examples
Complete Example: Processing and Storing a PDF
c#
using IC.Azure.Blob;
using IC.Azure.KeyVault;
using System;
using System.IO;

public class BillerPdfProcessor
{
    private readonly AzureBlobService _blobService;
    
    public BillerPdfProcessor()
    {
        // Initialize Key Vault reader
        var keyVaultReader = KeyVaultReader.CreateFromDefaultIdentity("yourKeyVaultName");
        
        // Set the vault for AzureBlobService
        AzureBlobService.SetVault(keyVaultReader);
        
        // Create AzureBlobService instance
        _blobService = new AzureBlobService();
    }
    
    public bool ProcessAndStorePdf(int billerId, string localPdfPath, string targetFileName)
    {
        try
        {
            // Validate inputs
            if (!File.Exists(localPdfPath))
            {
                Console.WriteLine($"File not found: {localPdfPath}");
                return false;
            }
            
            // Upload PDF to Azure Blob Storage
            bool uploadSuccess = _blobService.SaveBillerPDF(billerId, localPdfPath, targetFileName);
            
            if (!uploadSuccess)
            {
                Console.WriteLine("Failed to upload PDF to Azure Blob Storage.");
                return false;
            }
            
            Console.WriteLine($"Successfully uploaded {targetFileName} for biller {billerId}");
            return true;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error processing PDF: {ex.Message}");
            return false;
        }
    }
    
    public byte[] RetrievePdf(int billerId, string fileName)
    {
        try
        {
            // Get PDF from Azure Blob Storage
            byte[] pdfBytes = _blobService.GetBillerPDF(billerId, fileName);
            
            if (pdfBytes == null)
            {
                Console.WriteLine($"PDF not found: {fileName} for biller {billerId}");
                return null;
            }
            
            Console.WriteLine($"Successfully retrieved {fileName} for biller {billerId}");
            return pdfBytes;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error retrieving PDF: {ex.Message}");
            return null;
        }
    }
}
Using Generic Storage Methods
c#
using IC.Azure.Blob;
using IC.Azure.KeyVault;
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;

public class GenericStorageExample
{
    public static void Main()
    {
        // Initialize Key Vault reader
        var keyVaultReader = KeyVaultReader.CreateFromDefaultIdentity("yourKeyVaultName");
        
        // Set the vault for AzureBlobService
        AzureBlobService.SetVault(keyVaultReader);
        
        // Create a unique container name for testing
        string containerName = $"test-container-{Guid.NewGuid()}";
        string fileName = "test-file.txt";
        string content = "Hello, Azure Blob Storage!";
        byte[] contentBytes = Encoding.UTF8.GetBytes(content);
        
        try
        {
            // Upload file
            using (var stream = new MemoryStream(contentBytes))
            {
                bool uploadSuccess = AzureBlobService.StoreStorageFile(
                    StorageType.Generic,
                    containerName,
                    fileName,
                    stream
                );
                
                Console.WriteLine($"File upload: {(uploadSuccess ? "Success" : "Failed")}");
            }
            
            // Check if container exists
            bool containerExists = AzureBlobService.ContainerExists(
                StorageType.Generic,
                containerName
            );
            
            Console.WriteLine($"Container exists: {containerExists}");
            
            // List files in container
            List<string> fileList = AzureBlobService.RetrieveStorageFileList(
                StorageType.Generic,
                containerName,
                ""
            );
            
            Console.WriteLine($"Files in container: {fileList.Count}");
            foreach (string file in fileList)
            {
                Console.WriteLine($"- {file}");
            }
            
            // Download file
            using (var stream = AzureBlobService.RetrieveStorageFile(
                StorageType.Generic,
                containerName,
                fileName))
            {
                using (var reader = new StreamReader(stream))
                {
                    string retrievedContent = reader.ReadToEnd();
                    Console.WriteLine($"Retrieved content: {retrievedContent}");
                }
            }
            
            // Generate SAS URL
            string sasUrl = AzureBlobService.GetSharedAccessSignatureUrlWithToken(
                StorageType.Generic,
                containerName
            );
            
            Console.WriteLine($"SAS URL: {sasUrl}");
            
            // Delete file
            bool deleteSuccess = AzureBlobService.DeleteStorageFile(
                StorageType.Generic,
                containerName,
                fileName
            );
            
            Console.WriteLine($"File deletion: {(deleteSuccess ? "Success" : "Failed")}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }
}
These examples demonstrate the basic usage patterns for the IC.Azure.Blob library. For more specific use cases or complex scenarios, refer to the API documentation or consult with your development team.
 URL:/spaces/ED/pages/4552130829/IC.Azure.Blob
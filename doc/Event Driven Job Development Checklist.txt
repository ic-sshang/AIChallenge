Project + Message Setup




1


3b67282e-ac2a-4477-8d6a-d18973186d75


incomplete


All Events/Commands, Messages should be located in their own project - check for an existing  
IC.{Domain|Domain.SubDomain}.Contracts
 or create a new one. 
Note - you may keep this project locally to start and break it out later, if needed.








2


fd2326f4-4a9f-4f86-94d4-203aed2bf6d8


incomplete


For your contracts project - add a package reference to 
IC.Messaging.Core
 and ensure that all events/commands inherit the 
MessageBase
 type to ensure that required properties are always set on messages sent or published on the bus.








3


0531da44-5813-4846-a4e2-f2785bb0c2b6


incomplete


Add 
RebusTopicNameFormatterExtensions
 to your project and make sure that you use the 
UseKebabCaseTopicNames
 extension method when registering Rebus 
Options
 → 
o.UseKebabCaseTopicNames
.








7


09149a3a-375d-4246-a57d-d49ee0514c56


incomplete


Use OpenTelemetry for Metrics + Traces. There is an OTEL-specific extension package for Rebus, 
Rebus.OpenTelemetry
. Pull this into your project along with 
Rebus.Diagnostics
 and follow the example from the provided link - or the 
BillerReportGeneratorJob
 on wiring up Rebus to output OTEL Metrics + Traces. 
Refer to the OpenTelemetry Documentation in this Wiki
 for more information on adding OTEL to your service.




Pipeline & Helm Environments




5


40fcba39-059b-441b-9821-7a09fe7448df


incomplete


Ensure that the deploy pipeline is configured with 
enableKedaScaling: true
 - provide necessary Service Bus entity names for 
serviceBusQueueName
 and in 
environments: env: {}
 - 
this can be used as an example








6


8b9dc10e-2bc6-40c1-ae9a-20edbf243ae3


incomplete


Make sure that scaling rules are defined 
.helm/environments
 - 
this can be used as an example
.




Rebus Scenarios with Expected Outcomes
.UseAzureServiceBus(connString, INPUT_QUEUE_NAME)
 creates the service’s 
input queue
.
c#
wide
760
.Transport(
t => 
  t.UseAzureServiceBus(azureServiceBusConnectionString,
                       "biller-report-generator", // Creates the 'biller-report-generator' Service Bus Queue
                        new ChainedTokenCredential(
                              new VisualStudioCredential(), new ManagedIdentityCredential()
                          ))
// https://learn.microsoft.com/en-us/azure/service-bus-messaging/message-transfers-locks-settlement#peeklock
                          .AutomaticallyRenewPeekLock() 
),
Auto-created ‘biller-report-generator’ queue.
bus.Subscribe<TMessage>()
 - Creates a 
topic
 
subscription 
which forwards topic messages back to the service’s input queue. 
Note that this will also create the Topic if it doesn’t exist yet.
c#
wide
760
onCreated: async bus =>
{
    // Creates Topics (if they don't exist) + Creates subscription on topic
    // that forwards messages back to the Input Queue.
     await Task.WhenAll(
            bus.Subscribe<BillerReportEnqueued>(), // Creates `biller-report-enqueued`
            bus.Subscribe<BillerReportComplete>(), // Creates `biller-report-complete`
            bus.Subscribe<BillerReportEmailed>() // Creates `biller-report-emailed`
      );
})
.AddRebusHandler<BillerReportEnqueuedConsumer>();
Auto-created topic, showing single subscription.
Auto-created subscription on message topic.
Auto-created subscription, shown forwarding messages on topic back to input queue.
Using 
RetryStrategy
 creates an error queue for the service.
c#
wide
760
.Options(o => {
     // Creates the 'biller-report-generator-error' Service Bus queue.
     // Messages that fail to process are moved here after 5 retries.
     o.RetryStrategy("biller-report-generator-error", 5);
})

Auto-created error queue.
A 
Publisher 
configured with 
.UseAzureServiceBusAsOneWayClient(connString, credential)
 auto-creates message topics but 
DOES NOT CREATE TOPIC SUBSCRIPTIONS.
 In this scenario, the message will be published successfully - but without a configured consumer subscription, the message will not be consumed & will potentially be lost.
c#
wide
760
var containerActivator = new BuiltinHandlerActivator();
var bus = Configure
     .With(containerActivator)
     .Logging(l => l.Serilog(Serilog.Log.Logger))
     .Options(o => {
           // Again - ensure this is also used for the producer.
           o.UseKebabCaseTopicNames();
      })
      .Transport(t => t.UseAzureServiceBusAsOneWayClient(serviceBusConnectionString, new ChainedTokenCredential(new VisualStudioCredential(), new ManagedIdentityCredential(Environment.GetEnvironmentVariable("ClientId")))))
      .Start();

var @event = new BillerReportEnqueued(CorrelationId, "PublishingService", BillerID, ReportID);
bus.Publish(@event); // Creates 'biller-report-enqueued' topic.


 URL:/spaces/PMK/pages/4625498155/Event+Driven+Job+Development+Checklist
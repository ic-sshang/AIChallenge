Custom batch integration designed for BID2899 Stafford County (Utility)
Page Navigation:
1
7
Jira ticket
Release Date
Document status
 
in progress
Yellow
 
Document owner
 
Solution engineer
 
File Mapping
Invoice File
File Summary/Purpose: The purpose of this file is transfer bill/invoice data to IC from the biller. This file contains information for new bills, adjusted balances, block payment indicators and updates to past due amounts.
File Extension:  .fullDelta
File Naming Convention: CX20200313170449271650116.fulldelta
File Delimiter:  '|'
Specification: 
Sample File: 
SFTP File Path:
File Transfer Frequency:  Daily
File Split Logic:
If account status (field 32) is ‘C' or 'W’, do not create new invoice, adjustment record or invoice update record. If invoice exists in IC, create record in customer update file to block payment for CC and ACH. (Use Case: Account was not in Collections or Write-off status when sent to IC originally. At some point, the status changed to one of these and the account needs to be blocked for payment).
If account status (field 32) is ‘not C' or 'W’:
Identify Adjustment Records: When the InvoiceNumber exists in IC, create record in adjustment file and invoice update file. InvoiceNumber is created by using AccountNumber-StatementDate (field2-field55)
Create New Records:
Utility Bills: If statement date (field 55) is not null (and account status (field 32) is not ‘C' or 'W’), create invoice RecordType=N. InvoiceNumber is created by using AccountNumber-StatementDate (field2-field55)
Miscellaneous Utility Bills:  If statement date (field 55) is null and account status (field32) not in ‘C' or 'W’ and totalamountdue (30) > 0, create invoice RecordType=N. InvoiceNumber is created by using AccountNumber-Misc (field2-Misc).
Note: If account status (field 32) changes from ‘C' or 'W’, the accounts should be unblocked (block ACH and block CC = false)
Field Mapping
IC FileSpecID
IC Field
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Format
Partner Field Description
Record Type
1
RowType
N
TRUE
set by IC (FH)
File Header
2
BillerGuid
N
TRUE
set by IC
File Header
4
FileCreationDate
N
TRUE
set by IC
File Header
5
InvoiceCount
N
TRUE
set by IC
File Header
6
TotalInvoiceAmount
N
TRUE
set by IC
File Header
7
RowType
N
TRUE
set by IC (IH)
Invoice Header
8
RecordType
N
TRUE
Always 'N'
Char(1)
Invoice Header
9
InvoiceFormatGuid
N
TRUE
set by IC
Invoice Header
10
InvoiceNumber
Y
TRUE
4d4f3861-3723-4e5b-b062-2dad2b8af6d7
DECIDED
46d2f0e7-f022-4b6d-96c5-77503368d48d
If statement date (field 55) is not null (and account status (field 32) is not ‘C' or 'W’), use AccountNumber-StatementDate (field2-field55) Ex:42399-34144-03102020
DECIDED
24273724-ddc6-4832-bb15-bb7e7310cf9f
If statement date (field 55) is null (and account status (field 32) is not ‘C' or 'W’), and totalamountdue > 0, use AccountNumber-Misc (field2-Misc) literal string “Misc”
If statement date (field 55) is not null (and account status (field 32) is not ‘C' or 'W’), use AccountNumber-StatementDate (field2-field55) Ex:42399-34144-03102020
If statement date (field 55) is null (and account status (field 32) is not ‘C' or 'W’), and totalamountdue > 0, use AccountNumber-Misc (field2-Misc) literal string “Misc”
AccountNumber (AR2) +  '-' + StatementDate: (AR55)
Invoice Header
11
InvoiceDate
Y*
TRUE
StatementDate
If statement date is empty set to current date
Date(MMDDYYYY)
AccountRecord55
Invoice Header
12
InvoiceDueDate
Y
TRUE
DueDate
If statement date is empty set to current date
Date(MMDDYYYY)
AccountRecord8
Invoice Header
13
TotalAmountDue
Y
TRUE
TotalBalanceAmount
Decimal(10,2)
AccountRecord30
Invoice Header
20
AllowPartialPayments
Y
FALSE
PartialPaymentType
4198e587-2e16-4626-926f-c747411934a6
DECIDED
dbe3562f-b58c-4404-bfe6-67f219773e7c
If PartialPaymentType is “P”, AllowPartialPayments = True
DECIDED
d48f53d9-6a8d-4c2a-a494-ac67c3bbc4c3
If PartialPaymentType is not “P”, AllowPartialPayments = False
If PartialPaymentType is “P”, AllowPartialPayments = True
If PartialPaymentType is not “P”, AllowPartialPayments = False
Char(1)
AR36
Invoice Header
21
MinimumAmountDue
Y
FALSE
PartialPaymentAmount
a75cbabc-78e7-465d-8b8d-e3fd64f2980d
DECIDED
602eed9d-4ac0-4376-899f-4d90b1de8052
If PartialPaymentType is “P” MinimumAmountDue = AR37
DECIDED
3e3fa668-23c7-4350-b800-f04fb96e3300
If PartialPaymentType is not “P” MinimumAmountDue will not be set
If PartialPaymentType is “P” MinimumAmountDue = AR37
If PartialPaymentType is not “P” MinimumAmountDue will not be set
Decimal(10,2)
AR37
Invoice Header
38
Custom1
Y
FALSE
NormalizedValidationValue
Numeric(10)
AR54
Invoice Header
39
Custom2
Y
FALSE
RecordType
Char(1)
AR1
Invoice Header
40
Custom3
Y
FALSE
DueAmount
Decimal(10,2)
AR7
Invoice Header
41
Custom4
Y
FALSE
BudgetBillingAmount
Decimal(10,2)
AR56
Invoice Header
42
Custom5
Y
FALSE
PartialPaymentAmount
Decimal(10,2)
AR37
Invoice Header
44
Custom7
Y
FALSE
PaymentPlanAmount
Decimal(10,2)
AR57
Invoice Header
47
Custom10
Y
FALSE
AccountType
Char(1)
AR3
Invoice Header
93
BalanceDue
Y
FALSE
DueAmount
Decimal(10,2)
AR7
Invoice Header
94
Custom11
Y
FALSE
LastPaymentAmount
Decimal(10,2)
AR9
Invoice Header
95
Custom12
Y
FALSE
LastPaymentDate
Date(MMDDYYYY)
AR10
Invoice Header
96
Custom13
Y
FALSE
AutoPayFlag
char(1)
AR11
Invoice Header
97
Custom14
Y
FALSE
Paperless
char(1)
AR12
Invoice Header
98
Custom15
Y
FALSE
ConsumerCountry
Char(2)
AR20
Invoice Header
99
Custom16
Y
FALSE
NotificationOption
Char(1)
AR23
Invoice Header
100
Custom17
Y
FALSE
StreetNumber
Numeric(7)
AR24
Invoice Header
101
Custom18
Y
FALSE
ServiceAddressLine1
Varchar(48)
AR25
Invoice Header
102
Custom19
Y
FALSE
ServiceAddressLine2
Varchar(48)
AR26
Invoice Header
103
Custom20
Y
FALSE
ServiceCity
Varchar(20)
AR27
Invoice Header
104
Custom21
Y
FALSE
ServiceState
Char(2)
AR28
Invoice Header
105
Custom22
Y
FALSE
ServiceZip
Varchar(9)
AR29
Invoice Header
106
Custom23
Y
FALSE
OverDueAmount
Decimal(8,2)
AR31
Invoice Header
107
Custom24
Y
FALSE
Status
Char(1)
AR32
Invoice Header
108
Custom25
Y
FALSE
StatusDescription
Varchar(25)
AR33
Invoice Header
109
Custom26
Y
FALSE
PaymentTypeFlag
Char(1)
AR35
Invoice Header
110
Custom27
Y
FALSE
AccountNumber1
varchar(22)
AR38
Invoice Header
111
Custom28
Y
FALSE
AccountNumber2
varchar(22)
AR39
Invoice Header
112
Custom29
Y
FALSE
AccountNumber3
varchar(22)
AR40
Invoice Header
113
Custom30
Y
FALSE
AccountNumber4
varchar(22)
AR41
Invoice Header
252
InvoiceTypeID
N
TRUE
Set by IC - Always 42 (Utility)
Char(2)
Invoice Header
407
Past Due
Y
FALSE
OverDueAmount
Decimal(8,2)
AccountRecord31
Invoice Header
58
RowType
N
TRUE
n/a - always CR
Customer Record
59
AccountNumber
Y
TRUE
AccountRecord2
varchar(22)
AccountRecord2
Customer Record
60
CustomerName
Y
TRUE
CustomerName
Varchar(32)
AccountRecord5
Customer Record
61
Address1
Y
FALSE
ConsumerAddressLine1
Varchar(48)
AccountRecord15
Customer Record
62
Address2
Y
FALSE
ConsumerAddressLine2
Varchar(48)
AccountRecord16
Customer Record
63
City
Y
FALSE
ConsumerCity
Varchar(20)
AccountRecord17
Customer Record
64
State
Y
FALSE
ConsumerState
Char(2)
AccountRecord18
Customer Record
65
Zip
Y
FALSE
ConsumerZip
Varchar(9)
AccountRecord19
Customer Record
66
Phone
Y
FALSE
ConsumerPhone
Numeric(10)
AccountRecord21
Customer Record
356
BlockPaymentsCC
Y
FALSE
38f80dcf-4761-4e1c-98ab-c258ec3dd255
DECIDED
9b56c1f3-976c-449a-931f-e7775784b6dc
If AR 32 = ‘C' or 'W’, block = True (takes precedent over AR 35)
DECIDED
26be6f25-b930-421a-b767-771c3943d8e0
If AR 32 != ‘C' or 'W’, block = False
If AR 32 = ‘C' or 'W’, block = True (takes precedent over AR 35)
If AR 32 != ‘C' or 'W’, block = False
Account Record32
Customer Record
357
BlockPaymentsEFT
Y
FALSE
d7cbf809-9d52-41d2-84e3-f4ca6ccbbfac
DECIDED
3ec81265-7fdf-481e-b6f1-887defa44d28
If AR 32 = C or W, block = True
DECIDED
35f82ede-7190-413a-a825-9530f9dfa0d0
If AR 32 != 'C' or 'W' and AR35='C' block = True
DECIDED
440b4010-0229-4d8a-bbf3-fd202672335d
If AR 32 != ‘C' or 'W’
 and AR35 = 'A’,
 block = False
If AR 32 = C or W, block = True
If AR 32 != 'C' or 'W' and AR35='C' block = True
If AR 32 != ‘C' or 'W’
 and AR35 = 'A’,
 block = False
Different payment type flags, not all used: ("A"ll, "C"redit cards, "D"ebit cards, "P"lastic (debit/credit), "E"checks, or "N"one - no payments allowed)
Char(1)
Account Record32 +
AccountRecord35
Customer Record
373
DisplayAccountNumber
Y
FALSE
Strip leading 0s from AccountRecord2 (both the value before and after the -)
YYYYY-ZZZZZ
varchar(22)
AccountRecord2
Customer Record
70
RowType
TRUE
Set by IC - Always ‘ID’
Invoice Detail
Adjustment/Daily Balance File
File Summary/Purpose: This file is created by IC based on whether or not the invoice exists in IC. If the InvoiceNumber exists, IC will add a record to the adjustment file for balance update.
File Extension:  .fullDelta
File Naming Convention: CX20200313170449271650116.fulldelta
File Delimiter:  '|'
Specification: 
Sample File: 
SFTP File Path:
File Transfer Frequency:  Daily
Field Mapping
IC FileSpecID
IC Field Name
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Description
Record Type
305
RowType
N
TRUE
Set by IC, Always ‘AH’
File Header
306
BillerGuid
N
TRUE
Set by IC
File Header
308
FileCreationDate
N
TRUE
Set by IC
File Header
309
AdjustmentCount
N
TRUE
Set by IC
File Header
310
TotalAdjustmentAmount
N
TRUE
Set by IC
File Header
311
RowType
N
TRUE
Set by IC Always ‘AR’
Adjustment Record
312
InvoiceNumber
Y
FALSE
AccountNumber-StatementDate (field2-field55) or AccountNumber-Misc (field2-Misc) 
AccountNumber (AR2) +  '-' + StatementDate: (AR55)
Adjustment Record
313
AccountNumber
Y
TRUE
AccountNumber (AR2) 
AccountNumber (AR2) 
Adjustment Record
314
AdjustmentAmount
Y
TRUE
DueAmount
DueAmount (AR7)
Adjustment Record
316
AdjustmentTypeID
N
TRUE
2 = Balance differential
Adjustment Record
Invoice Update File
File Summary: 
File Extension:  .fullDelta
File Naming Convention: CX20200313170449271650116.fulldelta
File Delimiter:  '|'
Specification: 
Sample File: 
SFTP File Path:
File Transfer Frequency:  Daily
Field Mapping
IC FileSpecID
IC Field Name
In File (Y/N)
Required (T/F)
Partner Field Name
Partner Field Format
Partner Field Description
59
AccountNumber
Y
TRUE
AccountNumber (AR2) 
AccountNumber (AR2) 
10
InvoiceNumber
Y
TRUE
AccountNumber-StatementDate (field2-field55) or AccountNumber-Misc (field2-Misc) 
AccountNumber (AR2) +  '-' + StatementDate: (AR55)
407
Past Due
Y
TRUE
OverDueAmount
Decimal(8,2)
AccountRecord31
Customer Update File
File Summary/Purpose: 
File Extension: .CUF
File Naming Convention: N/A
File Delimiter:  '|'
Specification: Standard IC CUF
Sample File: N/A
SFTP File Path: N/A
File Transfer Frequency:  Daily
Field Mapping
IC FileSpecID
IC Field Name
Required (T/F)
Partner Field Name
Partner Field Description
Record Type
58
RowType
TRUE
Set by IC - Always CR
CustomerUpdateFile
59
AccountNumber
TRUE
AccountNumber
AR2
CustomerUpdateFile
356
BlockPaymentsCC
FALSE
If AR32 = C or W block
If AR32!=C or W, look to AR35 - 
If AR35=C, then block EFT
If AR35!=C, unblock EFT
CustomerUpdateFile
357
BlockPaymentsEFT
FALSE
If AR32 = C or W block
If AR32!=C or W, look to AR35 - 
If AR35=C, then block EFT
If AR35!=C, unblock EFT
CustomerUpdateFile
Payment/Lockbox File
File Summary/Purpose: The purpose of this file is transfer payment data from IC to the biller
File Extension: .txt
File Naming Convention: 
File Delimiter:  Fixed Position
Specification: No ACH Rejects, Credits or Chargebacks. 
Sample File:
SFTP File Path:
File Transfer Frequency: The biller has two options they can choose for the payment files:
Daily (after batch closure)
Twice per day (at specified times by the biller). Example: BID 2899 receives files for payments 12AM-3PM and 3PM-11:59PM EST)
Field Mapping
File Header
Field
Format
Values
RecordType
Position 1-1
Always 'H'
Batch Type
Position 2-2
Always 3 - Utilities (1= Real Estate, 2 = Personal Properties)
BatchID
Position 3-12
0
Payment Date
Position 13-20
Date of payment (mmddyyyy)
Batch Total
Position 21-32
Total amount of payments in batch (Lpadded with 0s, no commas or $)
Batch Line Count
Position 33-40
Number of payments in batch (Lpadded with 0s)
Filler
Position 41-80
Spaces
Detail Record
Field
Format
Values
Record Type
Position 1-1
Always 'D'
Line Number
Position 2-9
Line number, starts with 1 
OCR Scan Line
Position 10-41
For Utililty
:
Position 10: Always 3 
Position 11:  Always 0
Position 12-22 - BillAmountDue (lpadded with 0s)
Position 23-31 Customer Number (first half of account number)
Position 32-40 - LocationID (second half of account number after '-')
41 - Can always be set to 0
Payment Amount
Position 42-52
Payment Amount (Lpadded with 0s)
Filler
Position 53-80
Spaces
Change Log File
File Summary/Purpose: The purpose of this file is transfer change log data from IC to the biller
File Extension: 
File Naming Convention: 
File Delimiter: 
Comma separated (,)
Specification: 
Sample File:
SFTP File Path:
File Transfer Frequency: (Add note if DLS needs to be accounted for)
Field Mapping
Field
Data Type
Character Limits
Format
Values
Account Number
Varchar 
30 
Account Number from IC database
AP Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed enrollment in AutoPay
AP Un-Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed un - enrollment in AutoPay
Email
Varchar
100
Customer email address
Email Address change date
Datetime
MMDDYYYYHHMMSS
Date email address was change on IC
Phone Number
Varchar 
15
Phone number of the customer
Phone Number change date
Datetime
MMDDYYYYHHMMSS
Date phone number was changed on IC
Paperless Enrollment
Datetime
MMDDYYYYHHMMSS
Date customer completed enrollment in paperless
Paperless Un-enrollment
Datetime
MMDDYYYYHHMMSS
Date customer un-enrolled in paperless
Advanced Settings
Setting ID
Description
Value
OPTION 111 - update Past due when making a payment through IC should be turned on
BIF Customization's
Feature
BIF CUSTOMIZATIONS
AchServiceFee
Generally Not needed
AllowPartialPayments
Biller By Biller Basis
AutoPayCollectionDate
Biller By Biller Basis
BalanceForward
Should probably be set to yes for Utility (was for Stafford) Biller By Biller Basis but this integration was built with Balance Forward in mind so may not work
CreditCardServiceFee
Generally Not needed
FirstNotifyRequestedDate
Biller By Biller Basis
InvoiceDate
Set in Invoice File
InvoiceDueDate
Set in Invoice File
InvoiceFormatGuid
Set in Invoice File
InvoiceTypeID
Set in Invoice File
LateFeeDate
Biller By Biller Basis
LocationReference
Biller By Biller Basis
MinimumAmountDue
Biller By Biller Basis
PaymentExpirationDate
Biller By Biller Basis
PaymentExpirationMessage
Biller By Biller Basis
PromptPayExpirationDate
Biller By Biller Basis
RegistrationValue
Biller By Biller Basis
SecondNotifyRequestedDate
Biller By Biller Basis
ThirdNotifyRequestedDate
Biller By Biller Basis
User Interaction and Design
Data Flow - Invoice
att2188214304
2188083201
1
Chart1
IM
att2188738567
att2188148778
0
Data Flow - Adjustments
att2188902403
2188083201
1
Chart2
IM
att2188443687
att2188345349
0
Data Flow - Payment
att2187100209
2188083201
1
Chart3
IM
att2188640275
att2188345354
0
Data Flow - Change Log
att2188181520
2188083201
1
Chart4
IM
att2188574727
att2188279819
0
Data Flow - Bill Presentment
Bill presentment done through Data Prose (bill linking) (
https://app.getguru.com/card/zTLd66aT/DataProse-Implementation-Print-Vendor
). 
They receive standard changelog file format
Payer Experience
Payers will access Invoice Cloud from the Biller website (URL redirect). Payers will use the IC Virtual Site and Customer Portal.
Biller Experience
Biller Portal
Invoice Cloud Web Services
API Name
API Use/Purpose
Integration Modifications
Jira INT
Date Released
Previous Behavior
Desired Behavior
Business Case / Solution
INT-6254
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System JIRA
 
TBD
Update block CC and block ACH logic based on value AR32
Update block CC and block ACH logic based on value AR32 and AR35
When block is not being set by value in AR32, IC should look to secondary field AR35 for additional block information 
INT-4615
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System JIRA
 
8/29/2022
No value was being mapped to DisplayAccountNumber
Trim leading zeros from account number and store value in DisplayAccountNumber
Payers see their Account Number without leading zeros.
 URL:/spaces/IM/pages/2551250945/BID+2899+Stafford+County+-+Utility+-+Naviline+Central+Square+without+AMS+bridge+Technical+Design
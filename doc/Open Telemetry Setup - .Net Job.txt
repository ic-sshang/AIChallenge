Helm Chart Environment YAML Example
Supported Charts: 
keda-scaled-object
, 
cronjob
Add the below key value pair to your environment (DEV, IAT, QAR, XAT, PRD) Helm YAML files to enable the OTEL environment variable injection.
yaml
.
.
.
enableOpenTelemetry: true
.
# Also make note of these values
. serviceName: biller-report-generator
. instance: "main"
. environment: "dev"
Once deployed, the following 3 environment variables should be present in the deployed pod’s environment:
bash
OTEL_SERVICE_NAME # Defaults to = {serviceName}-{instance}-{environment}
OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
 
.Net 8 Job Example
You will need to add the following Nuget packages to your console project.
xml
<PackageReference Include="OpenTelemetry" />
<PackageReference Include="OpenTelemetry.Exporter.Console" />
<PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol" />
<PackageReference Include="OpenTelemetry.Extensions.Hosting" />

<!-- For Event Driven Jobs Using Rebus -->
<PackageReference Include="Rebus.OpenTelemetry" />
 Below is a example of the bootstrap code for adding OTEL to a console project.
c#
var builder = Host.CreateDefaultBuilder(args);

builder.ConfigureServices( (hostContext, services) => {
     
// read the otel settings from environment variables
// these values are injected via the deployment pipeline
  var serviceName = hostContext.Configuration.GetValue<string>("OTEL_SERVICE_NAME") ?? "BillerReportGenerator";
  var tracingOtlpEndpoint = hostContext.Configuration.GetValue<string>("OTEL_EXPORTER_OTLP_TRACES_ENDPOINT");
  var metricsOtlpEndpoint = hostContext.Configuration.GetValue<string>("OTEL_EXPORTER_OTLP_METRICS_ENDPOINT");

  var resourceBuilder = ResourceBuilder
                          .CreateDefault()
                          .AddService(
                              serviceName: serviceName!,
                              serviceInstanceId: Environment.MachineName)
                          .AddAttributes(new Dictionary<string, object>
                          {
                            ["deployment.environment"] = hostContext.HostingEnvironment.EnvironmentName
                          });

     // Add Open Telemetry Configuration.
     services.AddOpenTelemetry()
         .WithTracing(tracing => {
             tracing
              .SetResourceBuilder(resourceBuilder)
              .AddSource(serviceName!)
              .SetSampler(new AlwaysOnSampler());

             // If using the Rebus.OpenTelemetry package
             // add this to the call chain to get custom Rebus traces
             // .AddRebusInstrumentation();

             if (string.IsNullOrEmpty(tracingOtlpEndpoint))
                 tracing.AddConsoleExporter(); // For testing purposes
             else
                 tracing.AddOtlpExporter(options =>
                 {
                     options.Endpoint = new Uri(tracingOtlpEndpoint);
                     // IMPORTANT - this must be set unless GRPC is explicitly enabled.
                     options.Protocol = OpenTelemetry.Exporter.OtlpExportProtocol.HttpProtobuf;
                 });
         })
         .WithMetrics(metrics => {
             metrics
               .SetResourceBuilder(resourceBuilder)
               .AddMeter(serviceName!);

            // If using the Rebus.OpenTelemetry package
             // add this to the call chain to get custom Rebus metrics
             // .AddRebusInstrumentation();

           
             if (string.IsNullOrEmpty(metricsOtlpEndpoint))
                 metrics.AddConsoleExporter(); // For testing purposes
             else
                 metrics.AddOtlpExporter(options =>
                 {
                     options.Endpoint = new Uri(metricsOtlpEndpoint);
                     // IMPORTANT - this must be set unless GRPC is explicitly enabled.
                     options.Protocol = OpenTelemetry.Exporter.OtlpExportProtocol.HttpProtobuf;
                 });
         });
 });

 
 URL:/spaces/PMK/pages/4451205134/Open+Telemetry+Setup+-+.Net+Job
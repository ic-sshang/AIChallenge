Overview
IC.API.Middleware is an .Net  Core middleware library that provides 
centralized exception handling
 and 
authentication token management
.
It standardizes error responses across your APIs and simplifies authentication integration by converting cookie-based tokens into 
Authorization headers
.
Features
Centralized Exception Handling
Captures unhandled exceptions globally.
Returns structured JSON error responses.
Custom Exception Mapping
Maps 
ICAppException
 to specific HTTP status codes and error details.
Allows developers to define meaningful error responses.
Status Code Pages
Provides consistent JSON responses for 
401 (Unauthorized)
 and 
403 (Forbidden)
.
Cookie Token → Authorization Header
Automatically reads a token from a cookie (e.g., 
"session"
) and sets it as the 
Authorization
 header.
Environment Awareness
Includes stack traces in error responses 
only in Development
.
Ensures secure, production-friendly responses.
Exception Handling
Exception Types
ICAppException
Custom exception with:
Configurable 
status code
Human-readable 
title
Detailed 
message
Unhandled Exceptions
Any other exception is mapped to:
500 Internal Server Error
Standardized JSON response
Installation
Add the NuGet package to your project:
dotnet add package IC.API.Middleware

Usage
1. Register Exception Handler in DI
builder.Services.AddICExceptionHandler();

2. Add Exception Handling Middleware
app.UseICExceptionHandler();

3. Enable Status Code Pages for 401/403
app.UseICStatusCodePages();

4. Enable Cookie Token → Authorization Header Middleware
app.UseCookieTokenToAuthHeader("AuthToken"); 
// "AuthToken" is the default cookie name

Example
var builder = WebApplication.CreateBuilder(args);

// Register exception handler
builder.Services.AddICExceptionHandler();

var app = builder.Build();

// Add middlewares
app.UseCookieTokenToAuthHeader("AuthToken");
app.UseICExceptionHandler();
app.UseICStatusCodePages();

app.MapGet("/error", () =>
{
    // Throws a custom application exception
    throw new ICAppException("Invalid operation", "Operation_Error", 400);
});

app.Run();

Sample Error Response
{
  "status": 400,
  "title": "Operation Error",
  "detail": "Invalid operation",
  "type": "https://httpstatuses.com/400",
  "stackTrace": "..." // Only in Development
}

 URL:/spaces/PE/pages/4607803426/IC.API.Middleware
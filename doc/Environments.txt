none
üß≠ Environments
To support effective and reliable application development, testing, and release, 
InvoiceCloud
 defines a structured set of environments for infrastructure resources. These environments follow a progression chain, each serving a distinct purpose in the software delivery lifecycle.
üîß Sandbox (
sbx
)
Azure Resource Specifier
: 
-sbx
Subscription
: Sandbox
PCI Scope
: NonProd
Audience
: All Engineering Teams
Application Instances
: Ephemeral
URL Patterns
:
sbx.invoicecloud-beta.com
sbx{N}.invoicecloud-beta.com
Purpose
:
Used for initial development of infrastructure and CI/CD pipeline code, as well as Proof of Concept (PoC) implementations. Developers may use manual methods (Portal, CLI, Terraform) to prototype changes. Once validated, changes must be codified in a repo and redeployed via CI/CD. Manually created resources should be removed to reduce clutter, cost, and security risks.
üõ†Ô∏è Development (
dev
)
Azure Resource Specifier
: 
-dev
Subscription
: Enterprise Dev/Test
PCI Scope
: NonProd
Audience
: Application and QA Teams
Application Instances
: Multiple per application
URL Patterns
:
devtest.invoicecloud.com
devtest{N}.invoicecloud.com
dev.invoicecloud-beta.com
dev{N}.invoicecloud-beta.com
Purpose
:
Supports active application development and testing. All infrastructure must be deployed via codified Infrastructure as Code (IaC) through CI/CD pipelines to ensure consistency and prevent breaking changes from reaching production.
üß™ Internal User Acceptance Testing (
iat
)
Azure Resource Specifier
: 
-iat
Subscription
: Enterprise Dev/Test
PCI Scope
: NonProd
Audience
: Product Owners, PSN, Internal Stakeholders
Application Instances
: One per application
URL Patterns
:
cert.invoicecloud.com
iat.invoicecloud-beta.com
Purpose
:
Used for internal feature validation. Feedback determines whether a feature proceeds to QA or returns to development for refinement.
‚úÖ Quality Assurance Regression Testing (
qar
)
Azure Resource Specifier
: 
-qar
Subscription
: Enterprise Dev/Test
PCI Scope
: NonProd
Audience
: Quality Engineering (QE) Team
Application Instances
: One per application
URL Patterns
:
regression.invoicecloud.com
qar.invoicecloud-beta.com
Purpose
:
Validates that application code targeted for release behaves as expected and does not introduce regressions or break dependencies.
üåê External User Acceptance Testing (
xat
)
Azure Resource Specifier
: 
-xat
Subscription
: Enterprise Prod
PCI Scope
: Production
Audience
: Customers (Billers) and Partners
Application Instances
: One per application
URL Patterns
:
preview.invoicecloud.com
www.invoicecloud-beta.com
Purpose
:
Provides a controlled environment for customers and partners to preview and test new features before release. Also used for product demos.
üöÄ Production (
prd
)
Azure Resource Specifier
:
Pre-2024
: 
(unspecified)
2024 and beyond
: 
-prd
Subscription
: Enterprise Prod
PCI Scope
: Production
Audience
: End Users
Application Instances
: One per application
URL Patterns
:
www.invoicecloud.com
Purpose
:
Hosts live applications and workloads that process sensitive Biller and Payer data. Access is tightly controlled and requires Privileged Identity Management (PIM) activation for internal users.
 Environment Flow Diagram
2
1
0
0
3012689980
3007315987
1
Untitled Diagram-1706797059065.drawio
27
27
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1706797059065.drawio
0
1641
1169
Diagram Key:
The Environment blocks represent the Resources managed by the Infrastructure and Platform Teams
Application Hosting
Azure VM
AKS Cluster (K8s)
Azure Function
Azure Batch
Document Storage
Azure Storage Accounts
Secret, App Config, Connection String Storage
Azure Key Vault
App Cache
Redis Cache
 Environment Decisions
Expand the section below to view the decisioning registry.
Environment Decisions
Hub level components: 
Done
Kong must have a one-to-one modeling between Palo because Palo forwards traffic by port and all traffic is expected to come into Palo on Port 443. 
Done
Hub Level components will never be considered as potentially ephemeral. 
Done
In the near future the NonProd Hub with Palo and Kong should be moved to the DevTest Subscription and in the Sandbox Subscription there should be a Hub Network for use in Spoke IaC Modeling, but no Firewall (or scaled down Firewall) is needed because outside traffic is never intended to be routed to the Sandbox Environment Resources. 
Done
Do we still need 
SBX,
 
DEV
, and PRD Kong instances?  
No, we will use just DEV Kong to match our desired final state.  SBX Kong will be ephemeral for early development and POC work when needed. We will we use `npd` as a Suffix for Network Lane.
ADDS Must be used for Virtual Machine Login in Lower Environments and some Virtual Machine configurations to match Production:  
Done
Do we want to update ADDS to support Private Endpoints for both NonProd and Prod Resources using Conditional Forwarding? 
Yes
To be able to resolve to both NonProd and Prod from ADDS, we will need a new set of Private DNS Zones that house Private DNS records for both NonProd and Prod Resources.
AVD must use the System Assigned Managed Identity to model the Users Identity due to limitations in the 
IC.ApplicationAuthService
 Repo/DLL. 
Done
SQL Server: access to the Legacy SQL Server should use the 
terraform-azuread-ic-db-access
 module to IaC AVD MI access to make the access process smoother and approval must come from 
 and/or someone from his group
. 
Done
Key Vault: access to the Legacy KeyVault should use a similar IaC module model.  
Done
Environment lifecycle - sbx/dev/int-uat/qa/ext-uat/prod: 
Done
Subscriptions for Each Environment:
Sandbox (SBX): Sandbox
Development (DEV): DevTest
Internal UAT (IAT): DevTest
QA Regression (QAR): DevTest
External UAT (XAT): DevTest
Production (PRD): Primary (Legacy) and Production (NextGen)
Hubs for Each Environment:
SBX: NonProd (eventually since this will go to SBX Hub in the next iteration of Hub Dev Cycles)
DEV: NonProd
IAT: NonProd
QAR: NonProd
XAT: NonProd
PRD: Prod
Dev environment workings i.e. how will it work for multiple teams, multiple feature branches (concept of Application Instances):
 
Open
DEV Environment: 
Open
main
 and 
2 Team specific Application Instances of Infrastructure representing the Apps the Teams manage. 
Done
Web App Teams 
Get Application Instances for 
Web VM (or Azure App Services)
App Setting Key Vaults
Storage Account
Use 
main
 Application Instance for
Backend Application Services VM
Proxy VM
Redis
Proxy App Team
Get Application Instances for 
Web VM
Proxy VM
App Setting Key Vaults
Storage Account
Use 
main
 Application Instance for
Backend Application Services VM
Redis
Backend Application Service Teams
Get Application Instances for 
Backend Application Services VM (or Azure Function or Azure Batch)
App Setting Key Vaults
Storage Account
Use 
main
 Application Instance for
Web VM
Proxy VM
Redis
Internal UAT: 
Open
main
 and 1 Team specific Application Instances of Infrastructure representing the Apps the Teams manage. 
Done
QAR:  Only 
main
 Application Instance for Web and Proxy 
Done
External UAT:  Only 
main
 Application Instance 
Done
Production: Only 
main
 Application Instance 
Done
DB: 
Done
Biller Shard: Shared DevTest SQL Server in NonProd and then Prod SQL Server 
Done
Gateway: Single SQL Server (except DEV) per Environment (excluding Sandbox) 
Done
Which Environment should a developer target from Local Development for dependencies?: 
Open
Local Development means Development from AVD?
Which Environments should be Non-Ephemeral vs. Ephemeral (excluding Shared hub level components)?: 
Open
Which Environment should a developer target from Development Environment for dependencies? 
Open
Which Environments will be exposed Publicly thru Cloudflare? 
Open
Based on developer flow below, all environments are exposed publicly thru Cloudflare. This is correct , because this will keep parity between Cloudflare WAF traffic path for lower environments , same as production path. Measures should be taken to secure lower environments to narrow set of source IP addresses.
VM Config management approach - Ansible vs images 
Open
It seems we are leaning towards Ansible as a config tool. Expertise for this tool within out team is new. Some of the unknowns which can be expected are , stability and idempotency of apis for various components being configured on VM (e.g. IIS, CrowdStrike, NewRelic ‚Ä¶)
External expectations need to be set of this unknown and possible delay and/or change of course , if significant unknowns found.
 URL:/spaces/platform/pages/3007315987/Environments
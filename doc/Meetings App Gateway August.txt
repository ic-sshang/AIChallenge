1
6
false
default
list
true
8/7/2024
Observing Large File Again
AGWAccessLogs
| where TimeGenerated between (todatetime("8/7/2024, 1:30:00.000 PM") .. todatetime("8/7/2024, 1:35:00.000 PM"))
| order by ReceivedBytes
| project TimeGenerated, Host, RequestUri, UserAgent, ReceivedBytes, SentBytes, ServerStatus, TimeTaken
 to reach back out to 
 and 
 concerning seeing this large file every 15 minutes that is causing the Stratus Web Service to 302 and taking up Thruput.
New Relic showing low Traffic Volume in Dashboard
Looks like the Primary Web Backend Settings samples are coming into NewRelic.  
 to investigate and work with 
 and 
 to figure out why that sample is missing.
Failed Requests
AGWAccessLogs
|  where TimeGenerated between (todatetime("8/7/2024, 1:30:00.000 PM") .. todatetime("8/7/2024, 2:00:00.000 PM"))
| where HttpStatus > 499
| project TimeGenerated, Host, RequestUri, UserAgent, ReceivedBytes, SentBytes, HttpStatus, ServerStatus, TimeTaken
| summarize count()  by Host, RequestUri, HttpStatus, ServerStatus
All Failed Requests due to Server Status.
Spike in Total Time
AGWAccessLogs
| where TimeGenerated between (todatetime("8/7/2024, 1:46:00.000 PM") .. todatetime("8/7/2024, 1:49:00.000 PM"))
| where TimeTaken > 2
| project TimeTaken, ServerResponseLatency, Host, RequestUri, ReceivedBytes, SentBytes, ServerRouted, ServerStatus, TimeGenerated
| order by TimeTaken desc 
Stop Using 
nsp.
AGWAccessLogs
| where Host startswith "nsp."
| summarize count()
Result for last 24 hours: 1,019,175
 Reach out to Wicked Tendies to use 
www.
 instead of 
nsp.
 Reach out to Karthic and Jesse to ask them to use 
www.
 instead of 
nsp.
Schedule time with 
 
 
 to investigate what is happening with these 
nsp.
 and RTDR related requests that give 400.
All the 400s are coming from IP 
48.216.163.58
 which is a Microsoft Data Center IP so likely due to the Batch Job calling the endpoint.
8/21/2024
Large Stratus File No Longer Being Sent Again!
SELECT timestamp, properties.host, properties.requestUri, properties.userAgent, properties.receivedBytes, properties.sentBytes, properties.serverStatus, properties.timeTaken 
FROM Log 
WHERE plugin.type = 'azure' AND metadata.resourceGroup = 'rg-pri-appgateway0-prd' and properties.requestUri = '/stratuswebservices/stratus.asmx' and properties.serverStatus = '302' 
LIMIT MAX 
SINCE 7 DAYS AGO
ORDER BY properties.receivedBytes DESC
Last seen on 8/18/2024.  FYI 
 and 
 
Loss of Metrics from Main Backend Server Pool
As noted last meeting, we are seeing that one of the Backend Settings Pool is sporadically showing up in the Metrics pull.
Not as Expected
SELECT `totalRequests.Average`, `totalRequests.Total`, `totalRequests.Maximum`, `totalRequests.Minimum`, backendSettingsPool 
FROM AzureApplicationGatewaySample 
WHERE ((`provider` = 'AzureApplicationGateway') AND (entityGuid = 'MTQ5OTcwNHxJTkZSQXxOQXwtMTA0NjkwMjc0MjMxMjY4ODI4NQ')) and backendSettingsPool = 'backend-pool-invoicecloud-web~backend-settings-invoicecloud-web-https'
Limit MAX 
SINCE 30 minutes ago
Closer to Expected
SELECT `totalRequests.Average`, `totalRequests.Total`, `totalRequests.Maximum`, `totalRequests.Minimum`, backendSettingsPool 
FROM AzureApplicationGatewaySample 
WHERE ((`provider` = 'AzureApplicationGateway') AND (entityGuid = 'MTQ5OTcwNHxJTkZSQXxOQXwtMTA0NjkwMjc0MjMxMjY4ODI4NQ')) and backendSettingsPool = 'backend-pool-regression~backend-settings-regression-https'
Limit MAX 
SINCE 30 minutes ago
Created New Relic Support Case: 
00219899
Failed Requests
Failed requests average is currently very low, below 6 for last 3 hours.  All related to backend server statuses
SELECT timestamp, properties.host, properties.requestUri, properties.userAgent, properties.receivedBytes, properties.sentBytes, properties.serverStatus, properties.timeTaken 
FROM Log 
WHERE plugin.type = 'azure' AND metadata.resourceGroup = 'rg-pri-appgateway0-prd' AND numeric(properties.httpStatus) > 499 
LIMIT MAX 
SINCE 7 days AGO 
ORDER BY properties.receivedBytes desc
Total Time Taken in Acceptable Range Driven by Backend Server Time Taken
Hostname Usage Summary
SELECT count(*)
FROM Log 
WHERE plugin.type = 'azure' AND metadata.resourceGroup = 'rg-pri-appgateway0-prd'
FACET properties.host
LIMIT MAX 
SINCE 1 days AGO 
Sent email concerning the deprecation of 
nsp.invoicecloud.com
 URL:/spaces/platform/pages/3461021697/Meetings+App+Gateway+August
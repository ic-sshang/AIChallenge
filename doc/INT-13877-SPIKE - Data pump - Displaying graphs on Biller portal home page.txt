Description
This spike aims to analyze the existing graphs displayed on the Biller Portal home page, identify necessary changes for adding new graphs, and outline the steps for incorporating new graphs as part of the DataPump enhancements.
UI Workflow for Biller Portal Graphs
Step-by-Step Flow
Biller Portal Home Page
:
When you navigate to the Biller Portal home page, it displays graphs based on the user's selection in the Biller Portal dashboard.
Adding Graphs
:
All available graphs are listed in the Biller Portal dashboard.
To add new graphs, click the 
Add
 button on the BillerWelcome page.
Redirect to Biller Dashboard Settings
:
Clicking the 
Add
 button redirects you to the Biller Dashboard Settings page.
Here, you can see all available graphs.
Selecting Graphs
:
Select the desired graphs by clicking the corresponding checkboxes.
Saving Changes
:
After selecting the graphs, click 
Save Changes
.
This action saves your selections and redirects you back to the BillerWelcome page.
Rendering Selected Charts
:
The BillerWelcome page then renders all the selected charts based on your choices.
Backend Workflow for Biller Portal Graphs
Step-by-Step Flow
Login to Biller Portal
:
After logging into the Biller Portal, you can navigate to the Biller Dashboard Settings to select new graphs.
Selecting a New Graph
:
For example, if you select Chart 10 to be displayed on the home page, the system will interact with the web service 
WSChartInfo.vb
.
Loading Data
:
The web service 
WSChartInfo.vb
 loads the data based on the switch case logic written for the chart ID.
This ensures that the correct data is fetched for the selected chart.
Rendering Chart Data
:
To render the chart data on the Biller Portal home page, the web service needs to be called within the JavaScript functions on both 
BillerDashboardSettings.aspx
 and 
BillerWelcome.aspx
.
JavaScript Integration
:
The JavaScript function calls the web service to fetch the data.
The main JavaScript function then processes this data and prepares it for display.
HTML Code for Rendering
:
Add the necessary HTML code to render the new chart.
Based on the span data, the chart data is rendered on the BillerWelcome home page.
Adding New Charts to the Biller Portal Using Existing Code Flow
Modify 
WSChartInfo.vb
Purpose
: Add new data loading functions and summary classes to support additional chart types.
Steps
:
Add New Web Method: like 
LoadErrorRateChartData
This function prepares error rate data (e.g., daily, weekly, monthly, quarterly) and returns it in a structured format.
as of now calculation will be done by using stored procedures.
Example:
 Return New ErrorRateSummary With {
     .TotalVolume = errorRates.Sum(),
     .TotalTransactions = errorRates.Count,
     .RegistrationStats = "10|ChartErrorRateActivity|5|Error Rate, time Period|Daily,Weekly,Monthly,Quarterly|6.88,88.5,6.99,88.8"
 }

Update 
GetRegistrationChartTotals
Add a case for 
db_chart_id = 10
 to call 
LoadErrorRateChartData
.
Create Summary Classes
Add 
ErrorRateSummary
 and other classes (e.g., 
TenDaysSummary
, 
CustomersActivity
) to structure the data returned by the functions.
Enhance 
BillerDashboardSettings.aspx
Purpose
: Add new setup functions and HTML elements to display the new charts.
Steps
:
Add HTML for Error Rate Chart
Include a new 
<canvas>
 element for the error rate chart:
 <canvas id="myChart10"></canvas>

Add JavaScript Setup Function
Create 
setupErrorRate
 to fetch and render the error rate chart:
 function setupErrorRate() {
     get_chart_info("myChart10", 10, 1);
 }

Update Chart Initialization
Call 
setupErrorRate
 in the 
$(document).ready
 block to initialize the chart on page load.
Update JavaScript
Purpose
: Enhance JavaScript to handle new chart types and data.
Steps
:
Add 
ErrorRateChart
 Function
This function renders the error rate chart as a vertical bar chart:
 function ErrorRateChart(chart_id, chart_data) {
     var ctx = document.getElementById(chart_id).getContext('2d');
     var errorRates = chart_data[3].split(',').map(Number);
     var errorRateLabels = chart_data[4].split(',');
     var barColors = errorRateLabels.map(() => getRandomColor());
     var data = {
         labels: errorRateLabels,
         datasets: [{
             data: errorRates,
             label: 'Error Rate (%)',
             backgroundColor: barColors,
             borderColor: barColors,
             borderWidth: 1
         }]
     };
     new Chart(ctx, {
         type: 'bar',
         data: data,
         options: {
             responsive: true,
             scales: {
                 x: { title: { display: true, text: 'Time Period' } },
                 y: { beginAtZero: true, title: { display: true, text: 'Error Rate (%)' } }
             }
         }
     });
 }

Integrate with 
get_chart_info
Update the logic to call 
ErrorRateChart
 when 
db_chart_id = 10
.
Adjust 
BillerWelcome.aspx
Purpose
: Update the page to handle error rate data.
Steps
:
Add Chart Handling
Update the JavaScript main function that web service called , logic to call 
setupErrorRateActivity
 for error rate data:
 if (chart_id.indexOf("ChartErrorRateActivity") >= 0) {
     setupErrorRateActivity(chart_id, chart_info_array);
 }

Ensure Data Parsing
Verify that 
chart_info_array
 correctly splits the 
RegistrationStats
 string for error rate data.
Summary
WSChartInfo.vb
: Add data loading functions and summary classes for new charts.
BillerDashboardSettings.aspx
: Enhance with new HTML elements and setup functions for charts.
JavaScript
: Update to handle new chart types (e.g., vertical bar chart for error rates).
BillerWelcome.aspx
: Adjust to process and display error rate data.
 
Rendering the charts to the biller portal by calling  Api directly on web page classes:
Step-by-Step Guide to Render Charts via API
Changes in 
BillerDashboardSettings.aspx.vb
Add Function to Fetch Chart Data
:
Create a function to call the API and fetch chart data using 
HttpClient
.
Example:
 Public Async Function FetchChartDataAsync(chartId As Integer) As Task(Of ChartData)
     Using client As New HttpClient()
         Dim response As HttpResponseMessage = Await client.GetAsync($"https://api.example.com/charts/{chartId}")
         response.EnsureSuccessStatusCode()
         Dim data As String = Await response.Content.ReadAsStringAsync()
         Return JsonConvert.DeserializeObject(Of ChartData)(data)
     End Using
 End Function

Call the Function on Button Click
:
Modify the code to call this function when the user saves their graph selections.
Example: 
visualbasic Protected Async Sub SaveChanges_Click(sender As Object, e As EventArgs) Handles SaveChanges.Click Dim chartData As ChartData = Await FetchChartDataAsync(10) ' Process and store chartData for rendering End Sub
Changes in 
BillerDashboardSettings.aspx
Add HTML Elements for New Charts
:
Include new 
<canvas>
 elements for the charts you want to add.
Example:
     <div class="chart-data" id="ten-days-data">
        <asp:Literal ID="Literal2" runat="server"></asp:Literal>
    </div>
             <h2>Average Response Time</h2>
 <table style="width: 100%; border: 1px solid #ccc;">
     <tr>
         <td style="width: 50%; vertical-align: top;">
             <h3>Average Response Time (ms)</h3>
             <ul id="responseTimeList"></ul>
         </td>
         <td style="width: 50%; vertical-align: top;">
             <h3>Response Time Graph</h3>
             <canvas id="responseTimeChart" width="400" height="200"></canvas>
         </td>
     </tr>
</div>
    <div style="text-align:center;">
        <telerik:RadButton runat="server" ID="btnSave" CssClass="ic-btn-round-theme" ButtonType="SkinnedButton"
            EnableBrowserButtonStyle="true" SingleClick="true" Text="Save Changes" />
    </div>

Add JavaScript Functions to Fetch and Render Chart Data
:
Create JavaScript functions to call the API and render the chart data.
Example:
 async function fetchChartData(chartId) {
     const response = await fetch(`https://api.example.com/charts/${chartId}`);
     const data = await response.json();
     return data;
 }

 function renderChart(chartId, data) {
     var ctx = document.getElementById(chartId).getContext('2d');
     var errorRates = data.errorRates;
     var errorRateLabels = data.errorRateLabels;
     var barColors = errorRateLabels.map(() => getRandomColor());
     var chartData = {
         labels: errorRateLabels,
         datasets: [{
             data: errorRates,
             label: 'Error Rate (%)',
             backgroundColor: barColors,
             borderColor: barColors,
             borderWidth: 1
         }]
     };
     new Chart(ctx, {
         type: 'bar',
         data: chartData,
         options: {
             responsive: true,
             scales: {
                 x: { title: { display: true, text: 'Time Period' } },
                 y: { beginAtZero: true, title: { display: true, text: 'Error Rate (%)' } }
             }
         }
     });
 }

 function setupErrorRate() {
     fetchChartData(10).then(data => {
         document.getElementById('avgErrorRateValue').innerText = calculateAverageErrorRate(data.errorRates);
         renderChart('myChart10', data);
     });
 }

 function calculateAverageErrorRate(errorRates) {
     const total = errorRates.reduce((sum, rate) => sum + rate, 0);
     return (total / errorRates.length).toFixed(2) + '%';
 }

 $(document).ready(function() {
     setupErrorRate();
 });

Changes in 
BillerWelcome.aspx.vb
Add Function to Fetch Chart Data
:
Similar to 
BillerDashboardSettings.aspx.vb
, create a function to call the API and fetch chart data.
Example:
 Public Async Function FetchChartDataAsync(chartId As Integer) As Task(Of ChartData)
     Using client As New HttpClient()
         Dim response As HttpResponseMessage = Await client.GetAsync($"https://api.example.com/charts/{chartId}")
         response.EnsureSuccessStatusCode()
         Dim data As String = Await response.Content.ReadAsStringAsync()
         Return JsonConvert.DeserializeObject(Of ChartData)(data)
     End Using
 End Function

Call the Function on Page Load
:
Modify the code to call this function when the page loads to render the selected charts and display the average error rate.
Example:
 Protected Async Sub Page_Load(sender As Object, e As EventArgs) Handles Me.Load
     Dim chartData As ChartData = Await FetchChartDataAsync(10)
     ' Process and display chartData
     avgErrorRateValue.InnerText = CalculateAverageErrorRate(chartData.ErrorRates)
 End Sub

 Private Function CalculateAverageErrorRate(errorRates As List(Of Double)) As String
     Dim total As Double = errorRates.Sum()
     Dim average As Double = total / errorRates.Count
     Return average.ToString("F2") & "%"
 End Function

Changes in 
BillerWelcome.aspx
Add HTML Elements for New Charts
:
Include new 
<canvas>
 elements for the charts you want to add.
Example:
 <table>
     <tr>
         <td>
             <div id="avgErrorRate">
                 <label>Average Error Rate:</label>
                 <span id="avgErrorRateValue"></span>
             </div>
         </td>
         <td>
             <canvas id="myChart10"></canvas>
         </td>
     </tr>
 </table>

Add JavaScript Functions to Fetch and Render Chart Data
:
Create JavaScript functions to call the API and render the chart data.
Example:
 async function fetchChartData(chartId) {
     const response = await fetch(`https://api.example.com/charts/${chartId}`);
     const data = await response.json();
     return data;
 }

 function renderChart(chartId, data) {
     var ctx = document.getElementById(chartId).getContext('2d');
     var errorRates = data.errorRates;
     var errorRateLabels = data.errorRateLabels;
     var barColors = errorRateLabels.map(() => getRandomColor());
     var chartData = {
         labels: errorRateLabels,
         datasets: [{
             data: errorRates,
             label: 'Error Rate (%)',
             backgroundColor: barColors,
             borderColor: barColors,
             borderWidth: 1
         }]
     };
     new Chart(ctx, {
         type: 'bar',
         data: chartData,
         options: {
             responsive: true,
             scales: {
                 x: { title: { display: true, text: 'Time Period' } },
                 y: { beginAtZero: true, title: { display: true, text: 'Error Rate (%)' } }
             }
         }
     });
 }

 function setupErrorRate() {
     fetchChartData(10).then(data => {
         document.getElementById('avgErrorRateValue').innerText = calculateAverageErrorRate(data.errorRates);
         renderChart('myChart10', data);
     });
 }

 function calculateAverageErrorRate(errorRates) {
     const total = errorRates.reduce((sum, rate) => sum + rate, 0);
     return (total / errorRates.length).toFixed(2) + '%';
 }

 $(document).ready(function() {
     setupErrorRate();
 });

Summary of Changes
BillerDashboardSettings.aspx.vb
:
Add a function to fetch chart data via API.
Call this function when the user saves their graph selections.
BillerDashboardSettings.aspx
:
Add a table with two columns for the chart title ,summary and the graph.
Create JavaScript functions to fetch and render chart data.
Initialize these functions on page load.
BillerWelcome.aspx.vb
:
Add a function to fetch chart data via API.
Call this function on page load to render the selected charts and display the average error rate.
BillerWelcome.aspx
:
Add a table with two columns for the average error rate and the graph.
Create JavaScript functions to fetch and render chart data.
Initialize these functions on page load.
Sample Graphs:
 URL:/spaces/PE/pages/4218945599/INT-13877-SPIKE+-+Data+pump+-+Displaying+graphs+on+Biller+portal+home+page
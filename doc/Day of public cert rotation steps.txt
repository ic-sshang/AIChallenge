Remove IC-Webs 1 - 5  and IC-Gateway1 from the prod app gateway on Saturday evening and patch IC-Webs 1 - 5
Install certificate on IC-Web 1 - 5 and IC-Gateway1 on Sunday at 4:30 am
Install the new cert on the production web servers(including IC-Gateway servers) and activate on IIS sites
In IIS give the IIS USR local user read access to the certificate
Search for certificates on the main windows screen and choose Computer Certificate Management
Open the Personal folder and find the new certificate and right click on it
Choose private key management
Add the IIS USR local user, and when you click ok make sure only read permission is checked
Put 
www.invoicecloud.com and my.invoicecloud.com
  into maintenance mode in GoDaddy by updating CNAME record from 
www.invoicecloud.com.cdn.cloudflare.net
. to 
http://icmaintenance.azurewebsites.net
   (Rob C, 5 minutes)
At 5 am put the IC-Web 1 - 5 and IC-Gateway1 in production, and remove IC-Webs 6 - 10 from the app gateway pool
Import the file into the certificates area on the key vaults (kv-glb-vault1, kv-glb-vault1-npd) from the AVD of that lane
Upload the new PFX and PEM files to the kv-glb-vault1-npd per these:
Key vault cert name File to upload
star-invoicecloud-com-pfx PFX File
Refresh the cert on the agw-pri-appgateway0-npd app gateways
Refresh the cert on the app gateway:
Open the app gateway in the Azure portal
Go to Listeners
Open the first https listener
Check the box Renew or edit selected certificate, and click save and follow the instructions
Open the key vault from an AVD in the correct lane for prod or dev, go to certificates, open the star-invoicecloud-com certificate and upload the new one, and disable the old one
Kubernetes will auto refresh the certificate
Key vault cert name File to upload
star-invoicecloud-com PEM File
Activate new cert on App Gateway (Rob C, 10 minutes)
Install and activate new cert on Cloudflare (Rob C, 10 minutes)
Run SSLChecker against 
www2.invoicecloud.com
 and invoicecloud.com 
https://www.sslshopper.com/ssl-checker.html
 
Push update for SSO (Sean, 10 minutes)
Have Salesforce team upload the PEM to production
In parallel
Kick off QA runs (Chad Johnson, 60 minutes)
Test SSO (Sean/Eddie, 10 minutes )
IVR routes (Karthic, 10 minutes)
Run ApplePay verifications (Adrian, 30 minutes)
Copy apple-developer-merchantid-domain-association.txt to Web1 desktop folder and run CopyAppleVerify.bat to copy file to all web servers
Update cert on Salesforce (Lauren, 10 minutes)
Update the cert on the MIIS pipeline (Adrian)
Run manual functional tests on www2.invoicecloud.com
For successful testing remove maintenance window from www.invoicecloud.com
Run smoke test against www.invoicecloud.com
Rollback
Switch to old cert or install old cert on Cloudflare
Switch to old cert on Barracuda on port 443 (optionally)
Revert code change for SSO
IVR reverts changes
Run ApplePay verifications on old cert (Adrian, 30 minutes)
Copy apple-developer-merchantid-domain-association.txt to Web1 desktop folder and run CopyAppleVerify.bat to copy file to all web servers
Remove maintenance window from 
http://www.invoicecloud.com
 
 URL:/spaces/icinfradoc/pages/3097001990/Day+of+public+cert+rotation+steps
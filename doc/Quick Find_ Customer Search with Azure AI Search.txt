Summary
The 
SearchAsync
 method executes customer searches against 
Azure Cognitive Search
 (ACS) using prepared search terms and structured search options.
The method improves consistency, user experience, and support for type-ahead queries, while also handling email-specific searches differently for precision.
Key Components
1. Search Term Preparation
A dedicated helper method 
PrepareSearch(string term)
 normalizes and expands user-entered terms before passing them to ACS.
Rules
Tokenization
If the term contains special characters (
@ . - _
 etc.), split on 
non-alphanumeric
 characters.
If the term only contains letters/digits and spaces, split on 
spaces
.
Wildcard Handling
Append 
*
 to any token with length ≥ 3.
Always append 
*
 to the 
last token
, regardless of length (to support type-ahead).
If no usable tokens remain, return an empty string (e.g., input 
"!!!"
).
Examples
Input
Output
@tes
tes*
user@test.com
user* test* com*
john s
john* s*
jo smith
jo smith*
util-10
util* 10*
!!!
""
 (no search)
This ensures predictable, uniform handling of all terms.
2. Search Options
The ACS 
SearchOptions
 object is explicitly configured:
Size = 1000
 → fetches up to the ACS max page size. (
Change size to 50, the max number of results returned from API will be 50
)
IncludeTotalCount = true
 → enables result count reporting.
SearchMode = All (default)
 → requires all tokens to appear somewhere.
QueryType = Simple
 → uses ACS’s simple syntax.
Example – SearchMode.All
Search: 
"john smith"
✅ 
"John Smith"
 → matches
✅ 
"Smith, John"
 → matches
❌ 
"John only"
 → no match
❌ 
"Smith only"
 → no match
Example – Wildcards
Search: 
"smi*"
✅ 
"Smith"
 → matches
✅ 
"Smiley"
 → matches
✅ 
"Smiles"
 → matches
❌ 
"Jones"
 → no match
Partition Filtering:
If a 
BillerGuid
 is provided, results are filtered:
wide
760
options.Filter = $"PartitionKey eq '{search.BillerGuid}'";

3. Email-Aware Search Handling
Search behavior changes when the input resembles an email address.
Full email (regex match):
When the input 
looks like a complete email address
, the search:
Restricts results to the 
EmailAddress
 field only.
Forces the query text to lowercase.
Wraps the entire query in quotes (
"..."
) for 
exact matching
.
Examples
Input
Transformed Query
Search Scope
Behavior
John.Smith@Gmail.com
"john.smith@gmail.com"
EmailAddress
 only
Matches only exact entries with that email. Case-insensitive.
USER@Test.org
"user@test.org"
EmailAddress
 only
Matches 
user@test.org
, ignores case.
a@company.net
"a@company.net"
EmailAddress
 only
Matches exactly 
a@company.net
.
wrong@email
(not matched by regex, treated as normal)
Multiple fields
Treated as a regular keyword search, not email-specific.
✅ Good for 
full user login lookups
.
❌ Will not return partials like 
smith@...
 unless the full string matches.
Full Email Regex Examples:
Input
Regex Match?
Transformed Query
Search Scope
Behavior
John.Smith@Gmail.com
✅ Yes
"john.smith@gmail.com"
EmailAddress
Matches exactly this email, case-insensitive.
USER@Test.org
✅ Yes
"user@test.org"
EmailAddress
Matches exactly this email.
a@company.net
✅ Yes
"a@company.net"
EmailAddress
Matches exactly this email.
wrong@email
❌ No
wrong* email*
 (via PrepareSearch)
Multiple fields
Falls back to regular search behavior.
john.smith@company.co
❌ No (TLD not listed)
john* smith* company* co*
Multiple fields
Treated as normal search, not email-specific.
Email-like indicator (e.g., starts with 
@
):
Search field: 
EmailAddress
.
SearchMode switched to 
Any
 (at least one token must match).
Example – SearchMode.Any
Search: 
"john smith"
✅ 
"John only"
 → matches
✅ 
"Smith only"
 → matches
✅ 
"John Smith"
 → matches
✅ 
"Smith, John"
 → matches
4. Results Streaming
Results are enumerated asynchronously using 
IAsyncEnumerable<Customer>
:
wide
760
await foreach (var result in results.GetResultsAsync())
    yield return result.Document;

This streams up to 
1000 customers
 efficiently without loading all results at once.
Benefits
Consistency
 – Uniform handling of all search terms, including numeric and special characters.
Type-Ahead Support
 – Always appends 
*
 to the final token for progressive search.
Improved UX
 – Handles special characters and email formats intelligently.
Scalability
 – Supports up to ACS’s maximum page size (1000).
Efficiency
 – Uses asynchronous streaming for better performance.
Considerations
Queries returning more than 1000 results will be 
truncated
. Consider pagination.
Overuse of wildcards (
*
) can increase ACS query cost—performance testing is recommended.
Email-only searches intentionally bypass multi-field searching. Validate if this matches business needs.
 URL:/spaces/ED/pages/4607836175/Quick+Find+Customer+Search+with+Azure+AI+Search
Page
Stacktrace
Frequency/Impact
Steps to reproduce
Root cause
What/how to fix/effort
CustomerLocator.aspx.vb
System.Web.HttpUnhandledException (0x80004005): Exception of type 'System.Web.HttpUnhandledException' was thrown. ---> System.NullReferenceException: Object reference not set to an instance of an object.
   at _2_CustomerLocator.ValidInput() in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocator.aspx.vb:line 323
   at _2_CustomerLocator.btnSearch_Click(Object sender, EventArgs e) in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocator.aspx.vb:line 369
   at System.Web.UI.WebControls.LinkButton.OnClick(EventArgs e)
   at System.Web.UI.WebControls.LinkButton.RaisePostBackEvent(String eventArgument)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.HandleError(Exception e)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest()
   at System.Web.UI.Page.ProcessRequest(HttpContext context)
   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)
Frequency: 4 in the last 24 hours; 64 in the last 7 days (2021-10-21)
Was unable to reproduce, but inferred that the cause is due to a lack of HTPP Referer information.
The line that throws the exception uses Request.UrlReferrer.AbsoluteUri to get the page name that called reCAPTCHA, for tracking purposes. The lack of an HTTP_REFERER value in the exception emails and NR logs leads us to think this is the cause.
A check for whether Request.UrlReferrer is null/Nothing or not would be required on every spot where this method is called.
Low effort.
Probably not worth the effort to create a story for this, since resolving EBPP-2875 would get rid of this error.
CustomerLocator.aspx
System Date/Time : 10/20/2021 10:12:40 PM
Application      : InvoiceCloud
Remote IP Addr   : 207.46.13.48
Error Message    : System.Web.HttpUnhandledException (0x80004005): Exception of type 'System.Web.HttpUnhandledException' was thrown. ---> System.Exception: No required parameters found!
   at _2_CustomerLocator.Page_Load(Object sender, EventArgs e) in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocator.aspx.vb:line 180
   at System.Web.UI.Control.OnLoad(EventArgs e)
   at System.Web.UI.Control.LoadRecursive()
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.HandleError(Exception e)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest()
   at System.Web.UI.Page.ProcessRequest(HttpContext context)
   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)
Using Query strings from the exceptions. There seems to not be a genuine way to reproduce these errors.
From research, it seems that there isn’t one central reason for this error popping up. It’s been determined that this errors is being thrown from billers that are using both Site.aspx and Site2.aspx for different query string issues. 
The primary reason for this error is the Query string that is being passed to customer locator either contains invalid InvoiceTypeID (iti = -1) and invalid VirtualSiteItemID (vsii=-1). 
Or
No ITI or VSII are passed but neither is a VSGG.
Or 
There are either or missing from the query string.
I’ve noticed that there are user_agents in the exceptions that have the signatures of bots calling to our page. This could also be a potential reason for these exceptions. A bot trying out multiple query strings on our page to look for who knows what. 
I’m not sure if there’s a way to fix all these issues with one change. I believe it’s the cause of multiple vastly different underlying issues that’s causing this volume of exceptions.
CustomerLocator.aspx
System.Web.HttpUnhandledException (0x80004005): Exception of type 'System.Web.HttpUnhandledException' was thrown. ---> System.Data.SqlClient.SqlException (0x80131904): @InputParam is not a parameter for procedure spVirtualSiteQueryShoppingCartV6.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at IC.Database.DatabaseBase.GET_DATASET(DatabaseName Database, String SQL, Int32 CommandTimeout)
   at IC.Common.clsDatabaseAzure._Closure$__3-0._Lambda$__0(DatabaseBase client) in C:\agent\_work\420\s\IC.Common\clsDatabaseAzure.vb:line 14
   at IC.Database.DatabaseProxy.CallService[TResult](Int32 BillerID, String LastSql, Func`2 MethodCall)
   at IC.Common.clsDatabaseAzure.GET_DATASET(String SQL, Int32 CommandTimeout, Int32 BillerID) in C:\agent\_work\420\s\IC.Common\clsDatabaseAzure.vb:line 14
   at IC.Common.clsDatabase._Closure$__8-0._Lambda$__0() in C:\agent\_work\420\s\IC.Common\clsDatabase.vb:line 164
   at IC.Common.clsDatabase.LogSqlCall[TReturn](Int32 billerid, String sql, Func`1 methodCall) in C:\agent\_work\420\s\IC.Common\clsDatabase.vb:line 103
   at IC.Common.clsDatabase.GET_DATASET_PRIVATE(String SQL, DatabaseNames dbName, Int32 BillerID) in C:\agent\_work\420\s\IC.Common\clsDatabase.vb:line 164
   at IC.Common.clsDatabase.GET_DATASET(String SQL, Int32 BillerID) in C:\agent\_work\420\s\IC.Common\clsDatabase.vb:line 263
   at _2_CustomerLocator.GetDatasetForSearch() in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocator.aspx.vb:line 475
   at _2_CustomerLocator.btnSearch_Click(Object sender, EventArgs e) in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocator.aspx.vb:line 371
   at System.Web.UI.WebControls.LinkButton.OnClick(EventArgs e)
   at System.Web.UI.WebControls.LinkButton.RaisePostBackEvent(String eventArgument)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
ClientConnectionId:21d0f1c8-b1d8-4746-bca4-461081f5cd61
Error Number:8145,State:1,Class:16
ClientConnectionId before routing:1483dfb8-96fa-42af-a216-5e13f6d5f67e
Routing Destination:dd65483112a3.HS3.tr8885.eastus1-a.worker.database.windows.net,11009
   at System.Web.UI.Page.HandleError(Exception e)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)
   at System.Web.UI.Page.ProcessRequest()
   at System.Web.UI.Page.ProcessRequest(HttpContext context)
   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   at System.Web.HttpApplication.ExecuteStepImpl(IExecutionStep step)
   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)
4 in the last 24 hrs,
30 in the last 7 days,
We were unable to reproduce this error.
During our research, we noticed these exceptions were coming from a specific IP, all within the time frame of 1:03 AM to 1:04 AM, and using the same User Agent: python-requests/2.26.0
We believe a web crawler to be the root cause of these exceptions.
The IP triggering these exceptions has been blocked, and as of 2021-10-25 we have not received any new instances of this error.
CustomerLocatorResults
System Date/Time : 10/21/2021 11:08:30 AM
Application      : InvoiceCloud
Remote IP Addr   : 4.71.176.253
Error Message    : System.Web.HttpUnhandledException (0x80004005): Exception of type 'System.Web.HttpUnhandledException' was thrown. ---> System.Exception: No required parameters found!
   at _2_CustomerLocatorResults.Page_Load(Object sender, EventArgs e) in C:\Users\ICService\AppData\Local\Temp\WebSitePublish\MyIIS--1115421205\obj\debug\AspnetCompileMerge\Source\2\CustomerLocatorResults.aspx.vb:line 341
Selected Form Data (none)
Session Data
init: 0
StaleBalances: True
 URL:/spaces/PE/pages/2046296067/CustomerLocator+research+results+EBPP-2791
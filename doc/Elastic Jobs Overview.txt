Elastic Jobs in Azure SQL Database
Elastic Jobs in Azure SQL Database is a feature designed to automate and manage tasks across multiple databases. This document provides an overview of Elastic Jobs, its components, use cases, configuration steps, monitoring options, and more.
Overview
Elastic Jobs allow you to execute Transact-SQL (T-SQL) scripts across one or more Azure SQL databases.
They are ideal for automating maintenance tasks, deploying schema changes, collecting performance data, or aggregating data for reporting.
You can:
Define target databases or groups of databases for job execution.
Set schedules to run jobs periodically or on-demand.
Note
: All dates and times in Elastic Jobs are in the 
UTC time zone
.
Elastic Jobs log execution status and automatically retry operations upon failure.
Key Features
Define target databases or groups of databases for job execution.
Schedule jobs to run periodically or on-demand.
Automatically log execution status and retry operations in case of failure.
Execute jobs across databases in different subscriptions, servers, or elastic pools.
Use Cases
Automate Management Tasks
: Updating reference data or loading data from Azure Blob storage.
Collect Query Results
: Gather data from multiple databases into a central table.
ETL Processes
: Perform Extract, Transform, and Load tasks across databases.
When to Use Elastic Jobs
Elastic Jobs are useful when:
A task must be run regularly on a schedule, targeting one or more databases.
A task must be executed once but across multiple databases.
Tasks must be run against any combination of databases (individual databases, servers, elastic pools, or across subscriptions).
The environment is dynamic (e.g., SaaS scenarios) where databases are added or deleted dynamically.
Elastic Jobs can dynamically enumerate target databases, a feature that differentiates them from SQL Agent.
Components of Elastic Jobs
Elastic Job Agent
:
The central service that manages and executes jobs across databases.
Job Database
:
Stores metadata about jobs, including definitions, schedules, and execution history.
Job
:
A collection of tasks (steps) to execute. Each job can have multiple steps.
Job Steps
:
Individual tasks with T-SQL scripts for actions like data updates or metrics collection.
Target Groups
:
Defines databases or groups of databases for job execution (e.g., elastic pools, servers).
Schedules
:
Automates recurring tasks by defining execution times and intervals.
Credentials
:
Used to authenticate the Elastic Job Agent with target databases.
Monitor Elastic Jobs
Job Execution Logs
:
View job execution history in the job database by querying the 
jobs.job_executions
 table.
Azure Portal Monitoring
:
Recent job executions are displayed on the Elastic Job Agent 
Overview
 page.
Azure Alerts
:
Use Azure Monitor Alerts to be notified of job execution status (e.g., failures).
Create alert rules for the 
Failed Elastic Jobs
 metric and configure actions (e.g., email/SMS notifications).
Create and Configure Elastic Jobs
Step 1: Create the Elastic Job Agent
Sign in to the 
Azure Portal
.
Search for "Elastic Job Agent" and click 
Create
.
Provide details:
Agent Name
: Unique name for the agent.
Subscription
: Azure subscription.
Resource Group
: Existing or new.
Region
: Hosting region.
Job Database
: Choose or create a database (S1 or higher tier).
Step 2: Configure Authentication
Authentication Methods
:
Microsoft Entra Authentication
 (formerly Azure Active Directory) using a User-Assigned Managed Identity (UMI).
Database-Scoped Credentials
.
Assign the identity to the Elastic Job Agent for secure authentication.
Step 3: Define Target Databases
Navigate to the 
Target Groups
 section in the agent.
Add a new target group with databases or elastic pools as members.
Step 4: Create a Job
Go to the 
Jobs
 section in the Elastic Job Agent.
Click 
Add Job
 and:
Provide a name for the job.
Add job steps with T-SQL scripts and specify target groups.
Step 5: Schedule the Job
Navigate to the 
Schedules
 section.
Create a schedule with:
Start Time
: Define when the job runs.
Interval
: Specify recurrence (e.g., daily, weekly).
Associate the schedule with the job.
Create Alerts for Elastic Jobs
Configure Azure Monitor Alerts to get notifications on job status:
Step 1: Navigate to Azure Monitor
Sign in to the 
Azure Portal
.
Search for 
Azure Monitor
.
Step 2: Create Alert Rules
In Azure Monitor, go to 
Alerts
 and click 
+ New Alert Rule
.
Select the Elastic Job Agent as the target resource.
Step 3: Define Alert Conditions
Choose signal types (e.g., 
Failed Elastic Jobs
 metric or 
Activity Logs
).
Set conditions (e.g., thresholds for failures).
Step 4: Configure Notifications
Create or use an 
Action Group
 for notifications (e.g., email, SMS, Logic Apps).
Provide details like email addresses or phone numbers.
Step 5: Finalize and Test
Name the alert rule, set severity levels, and review the settings.
Test the alert to ensure it works as intended.
Job Output and History
Job Output
: Results of job steps can be saved to a specified table.
Job History
:
Query 
jobs.job_executions
 for execution history.
Remove history older than 45 days using: 
EXEC sp_purge_jobhistory @job_name = 'YourJobName';

Example to check existing job:
1.Search for Elastic Job Agent: Type "Elastic Job Agent" in the search bar.
2.Select Elastic Job Agent**: Click on the Elastic Job Agent from the search result.
3.
Choose an Existing Job
: Select any existing job by clicking on it.
4.Choose any one existing job and click on the job.
5.
Access Target Groups
: On the left-hand side, click on 
Target Groups
.
 URL:/spaces/DS/pages/4270129229/Elastic+Jobs+Overview
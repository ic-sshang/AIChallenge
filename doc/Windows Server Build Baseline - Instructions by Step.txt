Create VM
Image based on the most up-to-date version and builds of Windows
Server: 2019/2022
Workstation: 11
Create Backup
From the Azure portal open the page for the server
Create Replication
Create Delete Lock
Add Storage Drive Keep under 300GB
Change time zone to central
Join VM to Domain
Set powershell execution policy
Open an administrator Powershell prompt
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope CurrentUser
Set timezone to Central
Set-TimeZone -Name 'Central Standard Time' -PassThru
Install Crowdstrike Anti-Virus
Open command prompt under administrator
Navigate to where the CrowdStrike install is located
./CrowdStrike-WindowsSensor.exe /install /quiet CID=EF3C6D5DB9B242DAABCF19C7A126C2DD-C4
Turn off Windows Defender
Remove-WindowsFeature Windows-Defender, Windows-Defender-GUI
Turn off Windows Firewall
Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False
Run Script to Disable Windows Defender
Uninstall-WindowsFeature -Name Windows-Defender
Use IISCrypto software to remove old SSL and TLS ciphers
Add to EventSentry if the server will be in PCI scope
Run AlienVault agent install
Open Powershell ISE under admin
Open Alienvault Agent Install v2.ps1
Run Alienvault Agent Install v2.ps1 in PowerShell ISE
Run New Relic Infrastructure agent
Run newrelic-infra.msi, then replace the existing newrelic-infra.yml file with the one from the install folder
Add to PCI Group in AlienVault if needed
Setup no auto-update policy
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" -Name NoAutoUpdate -Value 1
Create Scheduled Task to Lower Defender Priority
Copy Tools directory to the C: drive
Create scheduled task pointing to SetMSSensAuto.bat, and have it run starting after midnight and running every hour as system
Apply Windows Security Patches
Install-Module -Name PSWindowsUpdate -Force
Get-WindowsUpdate -AcceptAll -Install -AutoReboot
Setup in WSUS and Windows Update Manager (if automated patching)
Force Group Policy Update to ensure GPOs are applied
Invoke-GPUpdate -Force
Prior to releasing for use, scan the server and remediate found vulnerabilities
AlienVault for PCI systems
CrowdStrike for all others
Settings that need to be applied if server is not domain joined
 URL:/spaces/icinfradoc/pages/3162079269/Windows+Server+Build+Baseline+-+Instructions+by+Step
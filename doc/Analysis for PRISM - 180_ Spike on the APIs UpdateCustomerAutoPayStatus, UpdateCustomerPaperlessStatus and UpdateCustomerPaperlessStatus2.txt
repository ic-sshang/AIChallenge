SOAP API Analysis for Paperless and AutoPay Enrolment via Chatbot / IVR
Objective
To analyze the existing SOAP APIs and identify the need for a single unified API to support AutoPay and/or Paperless enrolment via AI ChatBot or IVR systems, leveraging the previously implemented PoC logic.
APIs Analyzed:
UpdateCustomerAutoPayStatus
UpdateCustomerPaperlessStatus
UpdateCustomerPaperlessStatus2
Purpose of Existing SOAP APIs
API Name
Purpose Description
UpdateCustomerAutoPayStatus
Updates AutoPay ON/OFF flag — assumes payment info already exists
UpdateCustomerPaperlessStatus
Updates Paperless ON/OFF flag — does not check if email exists
UpdateCustomerPaperlessStatus2
Same as above, but validates email before proceeding
Business Logic Summary
UpdateCustomerAutoPayStatus
Authenticates biller using 
BillerGUID
 and 
WebServiceKey
Retrieves or inserts record in 
CustomerAutoPay
 table
Sends email notification if configured
Assumes:
Customer already exists
Payment method is already stored
Only toggles AutoPay flag
UpdateCustomerPaperlessStatus
Authenticates biller
Updates or inserts record in 
CustomerPaperless
 table
Does not check if customer has email
Syncs status and optionally sends email
UpdateCustomerPaperlessStatus2
Same as above but includes an email presence check
Fails if no valid email found for customer
More robust for IVR / Chatbot systems
Difference Between PaperlessStatus APIs
Feature
UpdateCustomerPaperlessStatus
UpdateCustomerPaperlessStatus2
Email validation present?
No
Yes
Use-case safety
Works even if no email is present
Fails without valid email
Suitable for IVR/Chatbot flows?
Possibly
Yes (Recommended)
Gap Analysis – Why a New API Is Needed
Limitations of Existing APIs
They only toggle Paperless or AutoPay status
Assume customer and payment method already exist
Lack control and validations required for stateless IVR/Chatbot flows
Cannot combine both enrolments in a single flow
New API Proposal for Paperless and AutoPay enrolment through IVR
EnrollInAutoPayAndPaperless API
Request Model:
{
  "AutoPay_PaperlessEnrollment_Request": {
    "PaymentGUID": "String",
    "BillerGUID": "String",
    "PartnerGUID": "String",
    "PartnerKey": "String"
  }
}

Response Model:
{
  "AutoPay_PaperlessEnrollment_Response": {
    "EnrollmentSuccessful": true,
    "Message": "String",
    "ErrorCode": 0
  }
}

Business Logic:
This API handles the enrolment of a customer into AutoPay and optionally Paperless billing.
It validates the partner credentials, loads the biller and customer details, and processes the payment method.
If the customer is not already enrolled in AutoPay or pending AutoPay, it proceeds with the enrolment.
If the biller forces paperless enrolment, it also enrols the customer in paperless billing.
EnrollInPaperless API
Request Model:
{
  "PaperlessEnrollment_Request": {
    "PaymentGUID": "String",
    "BillerGUID": "String",
    "PartnerGUID": "String",
    "PartnerKey": "String"
  }
}

Response Model:
{
  "PaperlessEnrollment_Response": {
    "EnrollmentSuccessful": true,
    "Message": "String",
    "ErrorCode": 0
  }
}

Business Logic:
This API handles the enrolment of a customer into Paperless billing.
It validates the partner credentials, loads the biller and customer details, and processes the paperless enrolment.
If the customer is not already enrolled in Paperless or pending Paperless, it proceeds with the enrolment.
Overview of Technical Flow in Each API
EnrollInAutoPayAndPaperless API
Request Validation:
Validate the partner credentials using 
clsUtilities.ValidateIvrPartner
.
Load the biller using 
ValidateBillerAndProduct
.
Fetch Payment Details:
Execute the SQL query to fetch payment details using 
selPayments
.
Load Invoice and Customer:
Load the invoice using 
LoadInvoiceByID
.
Load the customer using 
LoadCustomerByCustomerID
.
Process Payment Method:
Decrypt and store the payment method (credit card or ACH) as the default payment method.
Enrol in AutoPay:
Check if the customer is already on AutoPay or pending AutoPay.
If not, enrol the customer in AutoPay using 
StartAutoPayRegistrationForCustomer
.
Force Paperless Enrolment:
If the biller forces paperless enrolment, enrol the customer in paperless billing.
Response:
Return the response with the enrolment status and message.
EnrollInPaperless API
Request Validation:
Validate the partner credentials using 
clsUtilities.ValidateIvrPartner
.
Load the biller using 
ValidateBillerAndProduct
.
Fetch Payment Details:
Execute the SQL query to fetch payment details using 
selPayments
.
Load Invoice and Customer:
Load the invoice using 
LoadInvoiceByID
.
Load the customer using 
LoadCustomerByCustomerID
.
Enrol in Paperless:
Check if the customer is already on Paperless or pending Paperless.
If not, enrol the customer in Paperless using 
StartPaperlessRegistrationForCustomer
.
Response:
Return the response with the enrolment status and message.
New API Proposal for Paperless and AutoPay Enrolment through Chatbot Agent
Introduction
This document outlines a proposal for implementing APIs to enable Paperless and AutoPay enrollment via a chatbot interface. The proposed approaches offer three distinct options, each with unique benefits and use cases.
Approach 1: Use Existing REST-based APIs
Leverage the existing REST-based APIs to facilitate Paperless and AutoPay enrollment.
Flow Details:
CustomerPortalController.vb - Line 2262
CustomerPortalV2Controller.vb - Line 2874
Approach 2: Create New SOAP-based APIs
Develop new SOAP-based APIs to replicate the logic of the existing REST APIs. These APIs will be dedicated specifically to chatbot enrollment processes.
Approach 3: Use APIs for IVR-based Enrollment
Adopt the APIs currently used for IVR-based enrolment, adding a parameter to distinguish the request source. Depending on the channel, user authentication or IVR partner validation can be incorporated into the logic.
Request Model Example:
vb
full-width
Public Class EnrollRequest
    Public PaymentGUID As String
    Public BillerGUID As String
    Public PartnerGUID As String
    Public PartnerKey As String
    Public EnrollPaperless As Boolean
    Public EnrollAutoPay As Boolean
    Public Channel As String //NEW REQUEST PARAMETER
End Class

 URL:/spaces/PE/pages/4178477218/Analysis+for+PRISM+-+180+Spike+on+the+APIs+UpdateCustomerAutoPayStatus+UpdateCustomerPaperlessStatus+and+UpdateCustomerPaperlessStatus2
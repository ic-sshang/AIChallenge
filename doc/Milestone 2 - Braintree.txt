Release runbook: 
 
Summary: 
 
A release of development work related to the Braintree milestone 2 cohort is planned for the week of October 30, 2023. 
This functionality is the foundation to migrate Braintree biller cohort 1 (submitters, non-submitters without cost plus). 
Issues in this release:
 
BRAIN-842: 
https://invoicecloud.atlassian.net/browse/BRAIN-842
 Payment processing API
 
BRAIN-969: 
https://invoicecloud.atlassian.net/browse/BRAIN-969
  Hyperwallet and paypal chargeback processing; Boarding API 
BRAIN-397: 
https://invoicecloud.atlassian.net/browse/BRAIN-397-
 
 BRAIN-556: 
https://invoicecloud.atlassian.net/browse/BRAIN-556
 
BRAIN-52: 
https://invoicecloud.atlassian.net/browse/BRAIN-52
 
Improvements implemented after 11/2 rollback: 
Added additional test cases
Have deeply examined the areas of issue in CTP – and found more and held part of the release to resolve.
Deeper integration of the payment process into our testing
Improved communication with other teams releasing to ensure testing can be done in preview environment before pushing to production.
 
New processes:
QA regression of all code updates must happen 48 hours prior to release to production.  This helps resolve the issue of multiple teams working in the same code repos and releasing at the same time to ensure all changes work nicely together.
Preview is then the last chance to look at everything before going to prod – happens right before release.
 
Timeline:
 Deployment for 11/7/23 and 11/9/23
11/7 deployment potential: everything but CTP (brain-52 held). If Jonathan decides to hold CRM release then he’ll hold it all til Thursday.
Thursday deployment: include CTP
Jonathan is OOO Friday and Monday
Action
 
Time
 
Person responsible
 
Status
Commit Merge 
Night before
Jonathan 
Complete
Queue Deployment 
Night before
Jonathan 
Complete
Run pre-deployment advanced smoke tests 
Morning of 
Quality Engineering Team
Complete
Begin deployment 
9:45pm CT/10:45pm ET 
Jonathan 
Complete health checks 
10pm CT/11pm ET 
Jonathan/Martin 
UAT testing begins (see test plan below)
10:30pm CT/11:30pm ET 
Ryan
Risks:
 
UAT must be done in production. 
Note: QA has been successfully run for all of these issues – it is only the UAT step (which is part of the new business validation process) that is not currently set up in a pre-production environment. Efforts to create a pre-production environment to address this and allow end to end testing for future migrations are in progress. 
Unable to deploy HyperwalletFileProcessing to App_Test due to an issue connecting to the PayPal SFTP server from that environment.  As a result the deployment to production is riskier than it would have otherwise been.  This applies to 
BRAIN-969
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System JIRA
Risk mitigation plan:
 
Engineering and business stakeholders on for deployment to run testing immediately after deployment 
Test plans for each issue will be outlined – leverage what QA team can provide as a starting point (Outstanding as of 3pm 10/27) 
Deployment includes health check gates, and in many cases testing gates.  These do not eliminate but do help to mitigate the risk of deploying unhealthy code.
Team members online for deployments:
 
Jonathan - Engineering (lead)
Martin - Engineering
Vinay - Engineering
Rene - Engineering
Ryan - UAT testing 
Team members on call:
 
Someone from QA (for QA approval gate) for rollback or roll forward:  Michael Rawlins
Michael - Data Engineering
Roll forward plan:
 
Jonathan, Rene, and Vinay will be online in the event of a roll forward scenario.
Roll forward can happen in two different ways.
Immediate Roll Forward - changes made immediately to emergency patch a problem. Fixing on the fly such as this is rare and usually only if there is no rollback option.  This may however come in the form of a configuration change instead of a code change, in this case it’s more common.
Delayed Roll Forward - changes are made as soon as reasonably possible.  This will typically be next day or next release day.  This is more common, but if the issue is severe enough the rollback plan will be executed instead.
Rollback plan:
 
Revert to previous release - redeploy the last build that was deployed to production prior to the failed release.
Need to have someone from QA online for the QA approval gate. (QA will have already approved the deployment approval gate earlier in the day) 
Smoke tests would be rerun 
Deployments:
IC Payment Processing API
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109148&view=results
Paypal Chargeback Processing
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109160&view=results
Boarding API
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109155&view=results
CTP
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109159&view=results
ICCRM
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109158&view=results
HyperWalletFileProcessing
https://dev.azure.com/invoicecloud/Src/_build/results?buildId=109149&view=logs&s=b19fcfe0-474e-5ac6-748f-948c7cce220b&j=f96063cc-98d7-5129-9fed-2bdfa73241ac
(FAILED due to a network issue related to machines being migrated to go through Palo Alto)
UAT testing plan:
Process Transactions
BID
DBA
Type
Method
Acct
Amt
Fee
Tot
Result
IC Auth
BT Auth
Voided?
Refunded?
2768
AlaCOMP
Payment
Card
18957
$1.00
$1.00
Didn’t need to run test payments on live billers as a real payment came in naturally while I was processing the test payments below. -RJP
NO
2768
AlaCOMP
Payment
Check
18957
$1.01
$1.01
NO
574
Schererville
Payment
Card
650013502
$1.02
$1.02
NO
574
Schererville
Payment
Check
650013502
$1.03
$1.03
NO
1062
Wellsville
Payment
Card
110087.04MCS
$1.04
$1.04
NO
1062
Wellsville
Payment
Check
110087.04MCS
$1.05
$1.05
NO
1803
Test Biller 1
Refund
Card
163578306
$3.06
$0.06
$3.12
APPROVED
773444
038213311
NO
1803
Test Biller 1
Refund
Card
154346301
$3.08
$0.06
$3.14
APPROVED
633671
038213196
NO
1803
Test Biller 1
Refund
Check
154460304
$1.07
$1.05
$2.12
APPROVED
123841
038213235
NO
1803
Test Biller 1
Payment
Card
213873308
$1.07
$0.02
$1.09
APPROVED
412622
038213519
NO
1803
Test Biller 1
Payment
PayPal
213873308
$1.15
$0.03
$1.18
APPROVED
251437
038213519
NO
1803
Test Biller 1
Payment
Check
213873308
$1.19
$1.05
$2.24
APPROVED
662683
038213519
NO
BRAIN-842
https://invoicecloud.atlassian.net/browse/BRAIN-842
Testing Description
Validate that the API has these new methods as a smoke test.  There is not much more that can be done to validate this story until it is being utilized.
BRAIN-969
https://invoicecloud.atlassian.net/browse/BRAIN-969
Testing Description
Testing for this item can be performed using the CRM user interface, to make a change and then using the ICGW_Master database on the IC-Gateway server to validate the change flowed through to the ICGateway.
This will confirm the flag is changing in the gateway as expected.  It will not validate the values being processed by the existing code, only that the targeted change of toggling the gateway will work.
The full process was tested by the QE Team in development.
Test Step
Expected Result
Actual Result
Pass/Fail
Tested By
Check the ICGW_Master database and validate the current value of the 
RepayModeId
 column on the 
Terminals
 table with the 
UniqueIdentifier
 
1803|IC-LiveTestBiller-1
Current Value is 1
In CRM navigate to biller 
1803
 (Product Test Biller 1) and select Terminals.  Select edit on the PayPal terminal with the mid 
InvoiceCloudINC_instant_2
.  Do not change any values, simply click save.
Current Value is Gross
Check the ICGW_Master database as described in step1 and confirm the value remains 
1
Current Value is 1
In CRM with click to edit the same terminal described in step 2.  Change the Settlement Mode to 
Net
 and click Save
Current Value is Net
Check the ICGW_Master database as described in step1 and confirm the value has changed to 
2
Current Value is 2
In CRM with click to edit the same terminal described in step 2.  Change the Settlement Mode to 
Gross
and click Save
Current Value is Gross
Check the ICGW_Master database as described in step1 and confirm the value has changed to 
1
Current Value is 1
BRAIN-397
https://invoicecloud.atlassian.net/browse/BRAIN-397
Testing Description
In order to confirm this story, at a minimum we should be able to load the ACH Rejects Report in the CRM and validate that the PaymentID column has been added to the report and is populated.
Test Step
Expected Result
Actual Result
Pass/Fail
Tested By
Navigate to the ACH Rejects Report in the CRM and search with the following criteria:
Environment: Production
Subscriber: Invoice Cloud
Transaction Status: Recovered
Terminal Status: Biller
Terminal Type: PayPal
Start Date: 11/1/2023
End Date 11/2/2023
Data exists for the criteria and the Payment ID column exists on the report, and has data.
Payment ID column exists, and is populated
PASS
Green
 
 
Navigate to the ACH Rejects Report in the CRM and search with the following criteria:
Environment: Production
Subscriber: PSN
Transaction Status: Recovered
Terminal Status: Biller
Terminal Type: PayPal
Start Date: 11/1/2023
End Date 11/2/2023
If data exists (it did not at the time of test prep) the Biller DBA column should have a valid value, and the Payment ID column exists on the report, and has data.
Payment ID column exists, but there are no records.
n/a
Yellow
 
 
BRAIN-556
https://invoicecloud.atlassian.net/browse/BRAIN-556
Testing Description
For this story the testing will be limited as we do not want to generate an ACH Sale.  However, we can confirm that the button is there, and that the new recovery failed status is present.  
Test Step
Expected Result
Actual Result
Pass/Fail
Tested By
While still on the ACH Reject Report screen, confirm the 
Retry
 option is present to trigger the ACH sale.
The new retry option exists.
Navigate to the ACH Rejects Report in the CRM and confirm the 
recovery failed
 transaction status exists.
The new transaction status exists.
While still on the ACH Rejects Report in the CRM and search with the following criteria:
Environment: Production
Subscriber: Invoice Cloud
Transaction Status: Recovery Failed
Terminal Status: Internal
Terminal Type: PayPal
Start Date: 04/01/2023
End Date 04/04/2023
A record is returned (based on a data query of current production values) with an amount of -10.95 (or maybe -11.90) 
BRAIN-52
https://invoicecloud.atlassian.net/browse/BRAIN-52
Testing Description
For this story the testing will require setting up a payment that splits the fee and principal amount and issuing a refund or finding a payment that can be refunded.
Test Step
Expected Result
Actual Result
Pass/Fail
Tested By
Process a refund on a split fee transaction for an amount that exceeds the total payment amount.
Expected outcome is error msg and no refund.
Unable to test due to batch on BID 1803 not being closed
Process a refund on a split fee transaction for an amount that equals the total payment amount.
Expected outcome is successful full refund.
Process a refund on a split fee transaction for an amount that less than the total payment amount.
Expected outcome is successful partial refund.
 URL:/spaces/ED/pages/2878111787/Milestone+2+-+Braintree
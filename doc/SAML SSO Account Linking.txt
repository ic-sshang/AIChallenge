This document outlines the process for handling SAML SSO (Single Sign-On) account linking scenarios. It details the steps for linking or creating new logins based on the validity and type of login provided in the SAML response. The document also includes conditions for promoting temporary logins, setting login types, and registering customers if they are not already registered. Its purpose is to ensure secure and accurate account management during the SSO process.
References:
SAML SSO Documentation
 
Account Linking Cases in SAML SSO
The SAML response must set the login type as Account Owner or Group Oversight
Valid Login
 = Email address and password or username and password
Target Customer
 = Customer associated with account number provided in the SAML response
Account Owner
 = A login type that represents the account owner of the target Customer’s account
Scenario 1 - SAML Response’s LoginType is an Account Owner and Has a Valid Login 
1-a. Valid login but not linked to any accounts
(1-i-b) 
Account owner has valid login
If the account owner has a valid login, then we will link the incoming login with the target customer’s account and set the LoginType as the co-owner if the Biller allows and the co-owner limit has not been reached. Otherwise, we set the login type as the account oversight.
Code Link
(1-ii-b) 
Account owner has a temporary login
If the account owner has a temporary login, then we will promote the temporary account owner to an account owner by updating the temporary login with the login passed in the SAML response.
Code Link
(1-iii-b) 
Account owner has no login
If the account owner has no login, then we will simply link the incoming login as the login type passed in the SAML response.
Code Link
2-a. Valid login that is linked to an account
(2-i-b) 
Allow user to log in but log to New Relic if an attempt to update the login to account guest or group oversight is made. These updates are not supported.
Code Link
Note: At this point for all these scenarios if the customer is not registered, we will do so now.
2
1
0
0
4220125187
4198039678
1
Untitled Diagram-1744731005985.drawio
5
5
https://invoicecloud.atlassian.net/wiki
Untitled Diagram-1744731005985.drawio
0
1087.0000000000002
1200
Scenario 2 - SAML Response’s LoginType is an Account Owner but Does Not Have a Valid Login
 
1-a. Account owner is a temporary login
(1-i-b) 
There is only one account owner linked to the target customer
If the target customer has exactly one account owner login, t
hen we will promote the temporary account owner to an account owner
 by updating the login with the login passed in the SAML response. 
Code Link
 
(1-ii-b) 
There is multiple or there is no account owners linked to the target customer 
If the target customer has more than one account owner login or none, then we will create a new login instead and set the login and login type provided in the SAML response to it
Code Link
2-a. Account owner is not a temporary login (Login not found)
(2-i-b) 
Account Owner has a valid login
If the account owner has a valid login, then we will set the login type as either a co-owner if the biller allows and the co-owner limit has not been reached, or we will set the login type has account oversight by default. We then will create a new login with this login type and set it with the login passed in the SAML response.
Code Link
(2-ii-b) 
Account owner does not have a valid login
If the account owner does not have a valid login, then we will create a new login and set its values to what is passed in the SAML response. 
Code Link
Note: At this point for all these scenarios if the customer is not registered, we will do so now.
2
1
0
0
4220682275
4198039678
1
Scenario2-1744741705294.drawio
4
4
https://invoicecloud.atlassian.net/wiki
Scenario2-1744741705294.drawio
0
832.8699999999999
794
Scenario 3 - SAML Response’s LoginType is NOT an Account Owner
1-a. Response’s Login type is either Group Oversight or the Account Owner has a Valid Login
(1-i-b) 
SAML response has a valid login 
(1-i-c) 
Login has no linked accounts
If there are no accounts linked to the login, then we will link the login and login type provided by the SAML response.
Code Link
 
(1-ii-c)
 Login has linked accounts
We will not link anything and proceed normally. We will also check the login types match otherwise we will log an error that we do not support updating login types.
Code Link
 
(1-ii-b) 
SAML response does not have a valid login
We will create a new login and set it with the login and login type passed in the SAML response.
Code Link
2-a. Response’s Login type is not Group Oversight and the Account Owner does not have a Valid Login
Log an error as we cannot proceed
2
1
0
0
4220551220
4198039678
1
Scenario31744743122014.drawio
9
9
https://invoicecloud.atlassian.net/wiki
Scenario31744743122014.drawio
0
530.54
919.9999999999999
 URL:/spaces/PE/pages/4198039678/SAML+SSO+Account+Linking
This page contains a full list of all dependencies specified in each of our projects. These references were obtained by running a code search to find every 
csproj
, 
vbproj
, or 
packages.config
 file, then parsing them to extract the references. It contains only direct references, i.e. if your project uses an internal library, which in turn uses a third-party library, only the internal library would show here.
 
Here’s the script you can run to generate this report. It could be a good idea to update this to run in Airflow and publish this data to Snowflake daily so that we could work with live data without needing to run any manual processes.
# dependency formats
# packages.config:    <package id="IC.Database" version="2.0.3" targetFramework="net48" />
# csproj/vbproj:      <Reference Include="IC.Database, Version=2.0.3.0, Culture=neutral, processorArchitecture=MSIL">
# also csproj/vbproj: <PackageReference Include="Selenium.WebDriver" Version="4.11.0" />
# also need to account for nested version:
# <PackageReference Include="IC.Database">
#   <Version>1.0.8223.39595</Version>
# </PackageReference>

from bs4 import BeautifulSoup    
from os import environ
from azure.devops.connection import Connection
from msrest.authentication import BasicAuthentication
import azure.devops.v7_1.search.models
from azure.devops.v7_1.search.models import CodeSearchRequest
import re

personal_access_token = environ['AZURE_DEVOPS_PAT']
organization_url = 'https://dev.azure.com/InvoiceCloud'
credentials = BasicAuthentication('', personal_access_token)
connection = Connection(base_url=organization_url, creds=credentials) 

search_client = connection.clients_v7_1.get_search_client()
git_client = connection.clients_v7_1.get_git_client()

def search_ado_for(search_text):
    results = search_client.fetch_code_search_results(CodeSearchRequest(search_text=f"file: {search_text}", top=1000)).results
    # skip can only be 1000 at max, so if there are more than 2k results, throw an error
    if len(results) == 1000: 
        results += search_client.fetch_code_search_results(CodeSearchRequest(search_text="file: {search_text}", top=1000, skip=1000)).results
    if len(results) == 2000:
        raise Exception(f"More than 2000 results for {search_text}")
    return results

# search azure devops for packages.config, csproj, vbproj
dependency_files = search_ado_for("packages.config") + search_ado_for("*.csproj") + search_ado_for("*.vbproj")

files = [f for f in dependency_files if f.file_name.endswith(".csproj") or f.file_name.endswith(".vbproj") or f.file_name == "packages.config"]

# parse the files to retrieve references

reference = re.compile('^reference$', re.IGNORECASE)
package_reference = re.compile('^packageReference$', re.IGNORECASE)
package = re.compile('^package$', re.IGNORECASE)
version_regex = re.compile('^version$', re.IGNORECASE)

print("Project, Repository, Path, ID, Version")
for f in files:
    content = git_client.get_item(repository_id=f.repository.id, path=f.path, project=f.project.id, include_content=True).content
    xml = BeautifulSoup(content, 'xml')
    
    for ref in xml.find_all(reference) + xml.find_all(package_reference) + xml.find_all(package):
        lowered_ref = {key.lower(): value for key, value in ref.attrs.items()}
        id = ref.get('id')
        version = lowered_ref.get('version')
        include = lowered_ref.get('include')
        if not id:
            id = include.split(',')[0] if ',' in include else include
        if not version: # if version is not in the reference, try to get it from the include
            match = re.search(r'version=(\b\d+\.\d+\.\d+\.\d+\b)', include, re.IGNORECASE)
            version = match.group(1) if match else None
        if not version: # if we still don't have version, see if it's a child of the reference
            version_tag = ref.find(version_regex)
            version = version_tag.text if version_tag else None
        print(f"{f.project.name}, {f.repository.name}, {f.path}, {id}, {version}")
 URL:/spaces/ED/pages/3572236292/Project+Dependencies
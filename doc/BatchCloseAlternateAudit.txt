Skybot Jobs - BatchCloseAlternateAudit
This document outlines the purpose, execution details, and technical workflows of the 
three Skybot jobs
 managed under the BatchCloseAlternateAudit repository. These jobs are designed to automate batch audits, late-night batch closures, and rollback operations for negative batches.
üîß Repository
Repo Name
: BatchCloseAlternateAudit
Executable
: BatchCloseAlternateAudit\BatchCloseAlternateAudit.exe
Environment
: STAGING
üß© Job Summary
Skybot Job Name
Command
Frequency
STAGING-BatchCloseAlternateAudit-1
BatchCloseAlternateAudit.exe 1
Every 10 minutes
STAGING-BatchCloseAlternateAudit-2
BatchCloseAlternateAudit.exe 2 1
Daily at 11:06 PM, 12:06 AM, 1:06 AM, 2:06 AM
STAGING-BatchCloseAlternateAudit-3
BatchCloseAlternateAudit.exe 3
Hourly at 15 minutes past the hour
üìò Job Details
### 1Ô∏è‚É£ STAGING-BatchCloseAlternateAudit-1 ‚Äì Audit Report Generator
Purpose
:
Generates audit reports of unsettled batches for a specific biller and posts the report to a Slack channel.
Workflow
:
Executes stored procedure: rptBillerUnsettledBatches
Generates a report of 
unsettled payment batches
, including terminal and settlement history.
Posts the audit data as a file to the Slack channel.
Slack Configuration
:
Channel Name
: batchblose-audit
Configured via App.config:
Webhook URL
OAuth token
Managed by administrators
### 2Ô∏è‚É£ STAGING-BatchCloseAlternateAudit-2 ‚Äì Late Night Batch Audit & Closure
Purpose
:
Performs nightly audits of unsettled or missed batches and attempts to re-close them based on custom close times.
Workflow
:
Executes stored procedure: rptCheckBillerSettledBatches
Evaluates 
settlement status
 based on AutoCloseHour or CustomCloseTime.
For any unsettled batches, a rerun of batch close is attempted.
Based on ModuleID, the appropriate processor is invoked:
sage, bluefin, icgtest, chase
For 
Chase
, the chaseclient is used to perform batch close.
API Endpoint Used (for Chase)
:
https://nsp.invoicecloud.com/tunnelapi/v1/chase/endofday
Manual Override
:
Manual rerun option available in 
ICCRM Portal
.
### 3Ô∏è‚É£ STAGING-BatchCloseAlternateAudit-3 ‚Äì Negative Batch Rollback Handler
Purpose
:
Identifies and rolls back batches with 
negative SettledBatchIDs
, indicating failed or incomplete batch assignments.
Workflow
:
Executes multishard query: selNegativeSettledBatches
Identifies payments with negative batch assignments.
For each record, rollback is performed using:
exec spRollbackBillerBatchByPaymentTypes
¬†¬†¬† @BillerID = {billerID},
¬†¬†¬† @TerminalID = {terminalID},
¬†¬†¬† @PaymentTypeID = {paymentTypeID}
This resets the SettledBatchID to 0 (unsettled).
Logs are:
Posted to Slack channel.
Sent via email.
Log File Naming Convention
:
batchclosealternateaudit_checkbillernegativesettledbatchesprocessor_YYYY_MM_DD
Example Log Entry
:
Starting RetrieveNegativeSettledBatches...
_*BatchCloseAlternateAudit, CheckBillerNegativeSettledBatchesProcessor:*_ Picked up and Rolled back billers 2002
BillerID 2002 | BillerDBA Invoice Cloud - QA1 | TerminalID 402749 | PaymentTypeID 1 | PaymentCount 1
BillerID 2002 | BillerDBA Invoice Cloud - QA1 | TerminalID 402750 | PaymentTypeID 1 | PaymentCount 1
channel_not_found
Date Time : 5/25/2025 11:45:38 AM
Machine¬†¬† : avd-Gnaidu1
BillerID¬† : 2002
Finished RetrieveNegativeSettledBatches...
Manual Recovery
:
ICCRM Portal ‚Üí Negative Batch Reset screen
‚úÖ Summary
Job
Function
Key Stored Procs / APIs
Output / Action
Audit-1
Audit and Slack report
rptBillerUnsettledBatches
File to Slack
Audit-2
Late-night closure retry
rptCheckBillerSettledBatches, chaseclient, TunnelAPI
Batch re-closure
Audit-3
Negative batch rollback
selNegativeSettledBatches, spRollbackBillerBatchByPaymentTypes
Slack & email logs, batch rollback
¬†
 URL:/spaces/PE/pages/4350902377/BatchCloseAlternateAudit
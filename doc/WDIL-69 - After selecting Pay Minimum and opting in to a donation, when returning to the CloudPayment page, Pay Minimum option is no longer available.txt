Item link: 
WDIL-69
2278e126-27dc-36c8-aef9-a32d91bc7ad7
System Jira
 
Fault:
 When the Pay Minimum Amount option is selected in the payment route and the payer opts to make a donation, if the payer returns to the CloudPayment page, the Pay Minimum option is no longer available. 
The donation invoice is treated as a regular invoice, which causes the Pay Minimum option to not display since all invoices must have a minimum amount and donation invoices are not created with a minimum amount.
The Pay In Full Amount is also adding in the PAC Donation amount, which is confusing to the payer as it’s not their correct Invoice Amount Due.
Steps To Reproduce:
 
Enable donations. 
Select Pay Minimum in the CloudPayment page of the payment route.
Opt in to make a donation.
 Choose edit payment options or edit payment method to return to the CloudPayment page. Pay Minimum should then not be available.
Findings:
The logic is failing in the following area - 
code to update
. We will need to update the logic to bypass donation invoices in the invoice collection, add additional properties that check for similar logic 
allowpartialpayments
, 
minimumamountdue
 and 
balancedue > 0
, but exclude the donation invoices in context, or remove the donation invoices from the invoice collection at this point.
When going back the PAC Donation is added to the total amount due, which does not reflect the payers original invoice amount.
Check property on how it’s being called- Invoice Group Type
Update Invoice Amount on the Pay In Full option so it’s not including the PAC donation
Testing scenarios:
A PAC donation payment
CPv2
Agent Connect
A non-PAC donation payment
CPv2
Agent Connect
A regular payment without donations
CPv2
Agent Connect
Virtual Site
Customer Portal
Note: 
We’ll need to test both scenarios/entry points (
shown
 
in the screenshots below
).
From the Cloud Payment Method page:
From the Cloud Payment Review page:
 URL:/spaces/PE/pages/4662132751/WDIL-69+-+After+selecting+Pay+Minimum+and+opting+in+to+a+donation+when+returning+to+the+CloudPayment+page+Pay+Minimum+option+is+no+longer+available